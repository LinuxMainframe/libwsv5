\hypertarget{library_8c_source}{}\doxysection{library.\+c}
\mbox{\hyperlink{library_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00001}\mbox{\hyperlink{library_8c_a3024ccd4a9af5109d24e6c57565d74a1}{00001}} \textcolor{preprocessor}{\#define \_POSIX\_C\_SOURCE 200809L}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00003}00003 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{library_8h}{library.h}}"{}}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00004}00004 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00005}00005 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00006}00006 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00007}00007 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00008}00008 \textcolor{preprocessor}{\#include <time.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00009}00009 \textcolor{preprocessor}{\#include <pthread.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00010}00010 \textcolor{preprocessor}{\#include <unistd.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00011}00011 \textcolor{preprocessor}{\#include <stdarg.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00012}00012 \textcolor{preprocessor}{\#include <sys/socket.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00013}00013 \textcolor{preprocessor}{\#include <sys/select.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00014}00014 \textcolor{preprocessor}{\#include <netinet/in.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00015}00015 \textcolor{preprocessor}{\#include <arpa/inet.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00016}00016 \textcolor{preprocessor}{\#include <netdb.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00017}00017 \textcolor{preprocessor}{\#include <errno.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00018}00018 \textcolor{preprocessor}{\#include <poll.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00019}00019 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00020}00020 \textcolor{comment}{/* Third-\/party dependencies */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00021}00021 \textcolor{preprocessor}{\#include <libwebsockets.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00022}00022 \textcolor{preprocessor}{\#include <openssl/sha.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00023}00023 \textcolor{preprocessor}{\#include <openssl/evp.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00024}00024 \textcolor{preprocessor}{\#include <openssl/bio.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00025}00025 \textcolor{preprocessor}{\#include <openssl/buffer.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00026}00026 \textcolor{preprocessor}{\#include <cjson/cJSON.h>}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00028}00028 \textcolor{comment}{/* ============================================================================}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00029}00029 \textcolor{comment}{ * Constants and Macros}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00030}00030 \textcolor{comment}{ * ============================================================================ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00031}00031 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00032}\mbox{\hyperlink{library_8c_ad27c3919151c76f6e69c502c7ece4065}{00032}} \textcolor{preprocessor}{\#define OBSWS\_VERSION "{}1.0.0"{}}                   \textcolor{comment}{/* Library version string */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00033}\mbox{\hyperlink{library_8c_af132d6e679351e32e25e03f0446b9a79}{00033}} \textcolor{preprocessor}{\#define OBSWS\_PROTOCOL\_VERSION 1                }\textcolor{comment}{/* OBS WebSocket protocol version (v5 uses RPC version 1) */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00034}00034 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00035}00035 \textcolor{comment}{/* Buffer sizing: 64KB is large enough for most OBS messages. Larger messages}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00036}00036 \textcolor{comment}{   (like scene lists with many scenes) might need bigger buffers, but this is}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00037}00037 \textcolor{comment}{   a reasonable default. We could make it dynamic, but that adds complexity.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00038}00038 \textcolor{comment}{   The protocol itself doesn't define a max message size, so we have to choose. */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00039}\mbox{\hyperlink{library_8c_a665c5272405e81329a26d2db1a7d5d97}{00039}} \textcolor{preprocessor}{\#define OBSWS\_DEFAULT\_BUFFER\_SIZE 65536         }\textcolor{comment}{/* 64KB buffer for WebSocket messages */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00040}00040 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00041}00041 \textcolor{comment}{/* Pending requests tracking: We use a linked list to track requests waiting for}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00042}00042 \textcolor{comment}{   responses. 256 is a reasonable limit -\/ you can have up to 256 requests in-\/flight}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00043}00043 \textcolor{comment}{   at once. In practice, most apps will have way fewer. We chose a limit to prevent}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00044}00044 \textcolor{comment}{   unbounded memory growth if something goes wrong and requests never complete. */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00045}\mbox{\hyperlink{library_8c_ad466175cd00abd451ceb9a2c4c82a355}{00045}} \textcolor{preprocessor}{\#define OBSWS\_MAX\_PENDING\_REQUESTS 256}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00046}00046 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00047}00047 \textcolor{comment}{/* UUIDs are exactly 36 characters (8-\/4-\/4-\/4-\/12 hex digits with dashes) plus null terminator.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00048}00048 \textcolor{comment}{   We use these to match requests with their responses in the asynchronous protocol. */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00049}\mbox{\hyperlink{library_8c_a25b13264018fd1dc7b1f2bbd93bdc7cc}{00049}} \textcolor{preprocessor}{\#define OBSWS\_UUID\_LENGTH 37}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00050}00050 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00051}00051 \textcolor{comment}{/* OBS WebSocket v5 OpCodes -\/ message type identifiers in the protocol.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00052}00052 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00053}00053 \textcolor{comment}{   The OBS WebSocket v5 protocol uses opcodes to identify message types. The protocol}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00054}00054 \textcolor{comment}{   is based on a request-\/response model layered on top of WebSocket. Here's the flow:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00055}00055 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00056}00056 \textcolor{comment}{   1. Server sends HELLO (opcode 0) with auth challenge and salt}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00057}00057 \textcolor{comment}{   2. Client sends IDENTIFY (opcode 1) with auth response and client info}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00058}00058 \textcolor{comment}{   3. Server sends IDENTIFIED (opcode 2) if auth succeeded}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00059}00059 \textcolor{comment}{   4. Client can send REQUEST messages (opcode 6)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00060}00060 \textcolor{comment}{   5. Server responds with REQUEST\_RESPONSE (opcode 7)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00061}00061 \textcolor{comment}{   6. Server sends EVENT messages (opcode 5) for things happening in OBS}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00062}00062 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00063}00063 \textcolor{comment}{   Batch operations (opcodes 8-\/9) let you send multiple requests in one message,}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00064}00064 \textcolor{comment}{   but we don't use them in this library -\/ each request is sent individually.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00065}00065 \textcolor{comment}{   REIDENTIFY (opcode 3) is used if we lose connection and reconnect.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00066}00066 \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00067}00067 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00068}\mbox{\hyperlink{library_8c_a28228f50fc25972b87ebb3c5ca36104a}{00068}} \textcolor{preprocessor}{\#define OBSWS\_OPCODE\_HELLO 0                    }\textcolor{comment}{/* Server: Initial greeting with auth info */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00069}\mbox{\hyperlink{library_8c_a9ac9adf7323ec0e886fa7294ef8c387c}{00069}} \textcolor{preprocessor}{\#define OBSWS\_OPCODE\_IDENTIFY 1                 }\textcolor{comment}{/* Client: Authentication and protocol agreement */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00070}\mbox{\hyperlink{library_8c_a35815ef87e52f4956dcc02be7a3a7d95}{00070}} \textcolor{preprocessor}{\#define OBSWS\_OPCODE\_IDENTIFIED 2               }\textcolor{comment}{/* Server: Auth successful, ready for commands */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00071}\mbox{\hyperlink{library_8c_aca6d50cc88d56174d2cd1ba02b98a02e}{00071}} \textcolor{preprocessor}{\#define OBSWS\_OPCODE\_REIDENTIFY 3               }\textcolor{comment}{/* Client: Re-\/authenticate after reconnect */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00072}\mbox{\hyperlink{library_8c_a60741575bd0daca62cfc088a7d3908c6}{00072}} \textcolor{preprocessor}{\#define OBSWS\_OPCODE\_EVENT 5                    }\textcolor{comment}{/* Server: Something happened in OBS */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00073}\mbox{\hyperlink{library_8c_a6c2c324c3b2c49b7febe0b376d6c1045}{00073}} \textcolor{preprocessor}{\#define OBSWS\_OPCODE\_REQUEST 6                  }\textcolor{comment}{/* Client: Execute an operation in OBS */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00074}\mbox{\hyperlink{library_8c_ae6ce9e236045c545c7786292abb8bed2}{00074}} \textcolor{preprocessor}{\#define OBSWS\_OPCODE\_REQUEST\_RESPONSE 7         }\textcolor{comment}{/* Server: Result of a client request */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00075}\mbox{\hyperlink{library_8c_ae139b9522240dea875467adad42804ed}{00075}} \textcolor{preprocessor}{\#define OBSWS\_OPCODE\_REQUEST\_BATCH 8            }\textcolor{comment}{/* Client: Multiple requests at once (unused) */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00076}\mbox{\hyperlink{library_8c_a4d2cda5fb13a230acc6a977ec4f1b99c}{00076}} \textcolor{preprocessor}{\#define OBSWS\_OPCODE\_REQUEST\_BATCH\_RESPONSE 9   }\textcolor{comment}{/* Server: Responses to batch (unused) */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00077}00077 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00078}00078 \textcolor{comment}{/* Event subscription flags -\/ bitmask for which OBS event categories we subscribe to.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00079}00079 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00080}00080 \textcolor{comment}{   The OBS WebSocket protocol lets you specify which events you want to receive. This}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00081}00081 \textcolor{comment}{   avoids bandwidth waste -\/ if you don't care about media playback events, don't subscribe.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00082}00082 \textcolor{comment}{   We subscribe to most categories by default (using a bitmask), but you could modify}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00083}00083 \textcolor{comment}{   this to be more selective if needed.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00084}00084 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00085}00085 \textcolor{comment}{   We chose a bitmask (0x7FF for all) rather than subscribing/unsubscribing individually}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00086}00086 \textcolor{comment}{   because it's more efficient -\/ one subscription message at connect-\/time instead of}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00087}00087 \textcolor{comment}{   many individual subscribe/unsubscribe messages.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00088}00088 \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00089}00089 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00090}\mbox{\hyperlink{library_8c_af3122cbbc4a26632925db9b9ed14de9d}{00090}} \textcolor{preprocessor}{\#define OBSWS\_EVENT\_GENERAL (1 << 0)        }\textcolor{comment}{/* General OBS events (startup, shutdown) */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00091}\mbox{\hyperlink{library_8c_ac8ac38fd80c288fe304251a707957d43}{00091}} \textcolor{preprocessor}{\#define OBSWS\_EVENT\_CONFIG (1 << 1)         }\textcolor{comment}{/* Configuration change events */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00092}\mbox{\hyperlink{library_8c_abcabd4a44ea5f015970b39563cb2f5d9}{00092}} \textcolor{preprocessor}{\#define OBSWS\_EVENT\_SCENES (1 << 2)         }\textcolor{comment}{/* Scene-\/related events (scene switched, etc) */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00093}\mbox{\hyperlink{library_8c_a34d42f737fdba0a16d9db361107d4ccf}{00093}} \textcolor{preprocessor}{\#define OBSWS\_EVENT\_INPUTS (1 << 3)         }\textcolor{comment}{/* Input source events (muted, volume changed) */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00094}\mbox{\hyperlink{library_8c_a6bb991cf70fbb060bbf2577c00a1e525}{00094}} \textcolor{preprocessor}{\#define OBSWS\_EVENT\_TRANSITIONS (1 << 4)    }\textcolor{comment}{/* Transition events (transition started) */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00095}\mbox{\hyperlink{library_8c_a845a57bdbd1f3308da42b51d1e0cc074}{00095}} \textcolor{preprocessor}{\#define OBSWS\_EVENT\_FILTERS (1 << 5)        }\textcolor{comment}{/* Filter events (filter added, removed) */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00096}\mbox{\hyperlink{library_8c_a4e2ef7f5c168273a4af4fc255189d007}{00096}} \textcolor{preprocessor}{\#define OBSWS\_EVENT\_OUTPUTS (1 << 6)        }\textcolor{comment}{/* Output events (recording started, streaming stopped) */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00097}\mbox{\hyperlink{library_8c_a968abe18bf7a7df97110b636dab78710}{00097}} \textcolor{preprocessor}{\#define OBSWS\_EVENT\_SCENE\_ITEMS (1 << 7)    }\textcolor{comment}{/* Scene item events (source added to scene) */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00098}\mbox{\hyperlink{library_8c_a9dd53c6b169bf03951321c0635a865a8}{00098}} \textcolor{preprocessor}{\#define OBSWS\_EVENT\_MEDIA\_INPUTS (1 << 8)   }\textcolor{comment}{/* Media playback events (media finished) */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00099}\mbox{\hyperlink{library_8c_af20dd880c769d5a295f408d7ba3a4878}{00099}} \textcolor{preprocessor}{\#define OBSWS\_EVENT\_VENDORS (1 << 9)        }\textcolor{comment}{/* Vendor-\/specific extensions */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00100}\mbox{\hyperlink{library_8c_a269a8756f372f31aab63847a67a1f448}{00100}} \textcolor{preprocessor}{\#define OBSWS\_EVENT\_UI (1 << 10)            }\textcolor{comment}{/* UI events (Studio Mode toggled) */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00101}\mbox{\hyperlink{library_8c_a22c0214b5dafa0c23d7c7fe4c0686f7c}{00101}} \textcolor{preprocessor}{\#define OBSWS\_EVENT\_ALL 0x7FF               }\textcolor{comment}{/* Subscribe to all event types */}\textcolor{preprocessor}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00102}00102 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00103}00103 \textcolor{comment}{/* ============================================================================}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00104}00104 \textcolor{comment}{ * Internal Structures}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00105}00105 \textcolor{comment}{ * ============================================================================ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00106}00106 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00107}00107 \textcolor{comment}{/* Pending request tracking -\/ manages asynchronous request/response pairs.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00108}00108 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00109}00109 \textcolor{comment}{   The OBS WebSocket protocol is asynchronous -\/ when you send a request, you don't}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00110}00110 \textcolor{comment}{   wait for the response before continuing. Instead, responses come back later with}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00111}00111 \textcolor{comment}{   a request ID matching them to the original request.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00112}00112 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00113}00113 \textcolor{comment}{   This struct tracks one in-\/flight request. We keep a linked list of these, one for}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00114}00114 \textcolor{comment}{   each request waiting for a response. When a response arrives, we find the matching}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00115}00115 \textcolor{comment}{   pending\_request by ID, populate the response field, and set completed=true. The}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00116}00116 \textcolor{comment}{   thread that sent the request is waiting on the condition variable, so it wakes up}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00117}00117 \textcolor{comment}{   and gets the response.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00118}00118 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00119}00119 \textcolor{comment}{   Why use a condition variable instead of polling? Because polling wastes CPU. A}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00120}00120 \textcolor{comment}{   thread waiting on a condition variable goes to sleep until the response arrives,}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00121}00121 \textcolor{comment}{   at which point it's woken up. Much more efficient.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00122}00122 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00123}00123 \textcolor{comment}{   Why use a timestamp? For timeout detection. If a response never arrives (OBS crashed,}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00124}00124 \textcolor{comment}{   network died, etc.), we detect it by checking if the request is older than the timeout.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00125}00125 \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00126}00126 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00127}\mbox{\hyperlink{structpending__request}{00127}} \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structpending__request}{pending\_request}} \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00128}\mbox{\hyperlink{structpending__request_ae33cc3402bf8463415de7e57eac346af}{00128}}     \textcolor{keywordtype}{char} \mbox{\hyperlink{structpending__request_ae33cc3402bf8463415de7e57eac346af}{request\_id}}[\mbox{\hyperlink{library_8c_a25b13264018fd1dc7b1f2bbd93bdc7cc}{OBSWS\_UUID\_LENGTH}}];     \textcolor{comment}{/* Unique ID matching request to response */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00129}\mbox{\hyperlink{structpending__request_a4b37104673cb81e3f2825c8f6df372ba}{00129}}     \mbox{\hyperlink{structobsws__response__t}{obsws\_response\_t}} *\mbox{\hyperlink{structpending__request_a4b37104673cb81e3f2825c8f6df372ba}{response}};             \textcolor{comment}{/* Response data populated when received */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00130}\mbox{\hyperlink{structpending__request_af74dd3c97a064175b9dcf3dbfe3665cc}{00130}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{structpending__request_af74dd3c97a064175b9dcf3dbfe3665cc}{completed}};                         \textcolor{comment}{/* Flag indicating response received */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00131}\mbox{\hyperlink{structpending__request_a30b4636ccd06e4f775ee0dcc29ba3a69}{00131}}     pthread\_mutex\_t \mbox{\hyperlink{structpending__request_a30b4636ccd06e4f775ee0dcc29ba3a69}{mutex}};                  \textcolor{comment}{/* Protects the response/completed fields */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00132}\mbox{\hyperlink{structpending__request_a619500d05293ec1f654ea803139941de}{00132}}     pthread\_cond\_t \mbox{\hyperlink{structpending__request_a619500d05293ec1f654ea803139941de}{cond}};                    \textcolor{comment}{/* Waiting thread sleeps here until response arrives */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00133}\mbox{\hyperlink{structpending__request_a0fab8de980618cc4e6cea21fbed2eef4}{00133}}     time\_t \mbox{\hyperlink{structpending__request_a0fab8de980618cc4e6cea21fbed2eef4}{timestamp}};                       \textcolor{comment}{/* When request was created -\/ used for timeout detection */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00134}\mbox{\hyperlink{structpending__request_a49161e43ef29129c11fe643e85338df2}{00134}}     \textcolor{keyword}{struct }\mbox{\hyperlink{structpending__request}{pending\_request}} *\mbox{\hyperlink{structpending__request_a49161e43ef29129c11fe643e85338df2}{next}};           \textcolor{comment}{/* Linked list pointer to next pending request */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00135}\mbox{\hyperlink{library_8c_ac1fd81bac0d2473d54e2c9a03e393453}{00135}} \} \mbox{\hyperlink{library_8c_ac1fd81bac0d2473d54e2c9a03e393453}{pending\_request\_t}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00136}00136 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00137}00137 \textcolor{comment}{/* Main connection structure -\/ holds all state for an OBS WebSocket connection.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00138}00138 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00139}00139 \textcolor{comment}{   This is the main opaque type that users interact with. It holds everything needed}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00140}00140 \textcolor{comment}{   to manage one connection to OBS:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00141}00141 \textcolor{comment}{   -\/ Configuration (where to connect, timeouts, callbacks)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00142}00142 \textcolor{comment}{   -\/ WebSocket instance (from libwebsockets)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00143}00143 \textcolor{comment}{   -\/ Threading state (the event thread runs in the background)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00144}00144 \textcolor{comment}{   -\/ Buffers for sending/receiving messages}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00145}00145 \textcolor{comment}{   -\/ Pending request tracking (for async request/response)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00146}00146 \textcolor{comment}{   -\/ Statistics (for monitoring)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00147}00147 \textcolor{comment}{   -\/ Authentication state (challenge/salt for password auth)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00148}00148 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00149}00149 \textcolor{comment}{   Why is it opaque (hidden in the .c file)? So we can change the internal structure}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00150}00150 \textcolor{comment}{   without breaking the API. Callers just use the pointer, they don't know what's inside.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00151}00151 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00152}00152 \textcolor{comment}{   Threading model: Each connection has one background thread (event\_thread) that}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00153}00153 \textcolor{comment}{   processes WebSocket events, calls callbacks, etc. The main application thread sends}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00154}00154 \textcolor{comment}{   requests and gets responses. This avoids the app freezing while waiting for responses.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00155}00155 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00156}00156 \textcolor{comment}{   Synchronization: We use many mutexes because different parts of the connection}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00157}00157 \textcolor{comment}{   are accessed from different threads:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00158}00158 \textcolor{comment}{   -\/ state\_mutex protects the connection state (so both threads see consistent state)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00159}00159 \textcolor{comment}{   -\/ send\_mutex protects sending (prevents two threads from sending at the same time)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00160}00160 \textcolor{comment}{   -\/ requests\_mutex protects the pending requests list}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00161}00161 \textcolor{comment}{   -\/ stats\_mutex protects the statistics counters}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00162}00162 \textcolor{comment}{   -\/ scene\_mutex protects the cached current scene name}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00163}00163 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00164}00164 \textcolor{comment}{   The scene cache is an optimization -\/ some operations need to know the current}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00165}00165 \textcolor{comment}{   scene. Instead of querying OBS every time, we cache it and update when we get}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00166}00166 \textcolor{comment}{   SceneChanged events.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00167}00167 \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00168}00168 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00169}\mbox{\hyperlink{structobsws__connection}{00169}} \textcolor{keyword}{struct }\mbox{\hyperlink{structobsws__connection}{obsws\_connection}} \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00170}00170     \textcolor{comment}{/* === Configuration and Setup === */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00171}\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{00171}}     \mbox{\hyperlink{structobsws__config__t}{obsws\_config\_t}} \mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}};                  \textcolor{comment}{/* User-\/provided config (copied at construction) */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00172}00172     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00173}00173     \textcolor{comment}{/* === Connection State === */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00174}\mbox{\hyperlink{structobsws__connection_adad7d0fb4880543b1f5b5e897010d814}{00174}}     \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991}{obsws\_state\_t}} \mbox{\hyperlink{structobsws__connection_adad7d0fb4880543b1f5b5e897010d814}{state}};                    \textcolor{comment}{/* Current state (CONNECTED, CONNECTING, etc) */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00175}\mbox{\hyperlink{structobsws__connection_aa2752abaf5b201277fae73b42c78c8e6}{00175}}     pthread\_mutex\_t \mbox{\hyperlink{structobsws__connection_aa2752abaf5b201277fae73b42c78c8e6}{state\_mutex}};            \textcolor{comment}{/* Protects state from concurrent access */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00176}00176     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00177}00177     \textcolor{comment}{/* === WebSocket Layer === */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00178}\mbox{\hyperlink{structobsws__connection_a2f876a0ab0ad0e5e012444a806aa3490}{00178}}     \textcolor{keyword}{struct }\mbox{\hyperlink{structobsws__connection_a2f876a0ab0ad0e5e012444a806aa3490}{lws\_context}} *\mbox{\hyperlink{structobsws__connection_a2f876a0ab0ad0e5e012444a806aa3490}{lws\_context}};        \textcolor{comment}{/* libwebsockets context (manages the WebSocket) */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00179}\mbox{\hyperlink{structobsws__connection_aaf49ac1578fc794ee4b01ccbf9edc35a}{00179}}     \textcolor{keyword}{struct }lws *\mbox{\hyperlink{structobsws__connection_aaf49ac1578fc794ee4b01ccbf9edc35a}{wsi}};                        \textcolor{comment}{/* WebSocket instance -\/ the actual connection */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00180}00180     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00181}00181     \textcolor{comment}{/* === Message Buffers ===}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00182}00182 \textcolor{comment}{       We keep persistent buffers instead of allocating for every message because}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00183}00183 \textcolor{comment}{       it's more efficient and avoids memory fragmentation. */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00184}\mbox{\hyperlink{structobsws__connection_a89f2bbc96729ab308290da8959534d18}{00184}}     \textcolor{keywordtype}{char} *\mbox{\hyperlink{structobsws__connection_a89f2bbc96729ab308290da8959534d18}{recv\_buffer}};                      \textcolor{comment}{/* Buffer for incoming messages from OBS */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00185}\mbox{\hyperlink{structobsws__connection_ac3cdc6c4de9ae6aed16d3aac13effe78}{00185}}     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{structobsws__connection_ac3cdc6c4de9ae6aed16d3aac13effe78}{recv\_buffer\_size}};                \textcolor{comment}{/* Total capacity of receive buffer */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00186}\mbox{\hyperlink{structobsws__connection_a74838edd16f7d8d3d75c772f85d9f7df}{00186}}     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{structobsws__connection_a74838edd16f7d8d3d75c772f85d9f7df}{recv\_buffer\_used}};                \textcolor{comment}{/* How many bytes are currently in the buffer */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00187}00187     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00188}\mbox{\hyperlink{structobsws__connection_a14a61d0e27a8cac772ce173dd31d4fb7}{00188}}     \textcolor{keywordtype}{char} *\mbox{\hyperlink{structobsws__connection_a14a61d0e27a8cac772ce173dd31d4fb7}{send\_buffer}};                      \textcolor{comment}{/* Buffer for outgoing messages to OBS */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00189}\mbox{\hyperlink{structobsws__connection_a60f4507eac7295e16ece7c2a97c910d6}{00189}}     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{structobsws__connection_a60f4507eac7295e16ece7c2a97c910d6}{send\_buffer\_size}};                \textcolor{comment}{/* Total capacity of send buffer */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00190}00190     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00191}00191     \textcolor{comment}{/* === Background Thread ===}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00192}00192 \textcolor{comment}{       The event thread continuously processes WebSocket events. This allows the}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00193}00193 \textcolor{comment}{       connection to receive messages and call callbacks without blocking the app. */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00194}\mbox{\hyperlink{structobsws__connection_a160a7f93e6caf0da1bc2f4dbe48fbb41}{00194}}     pthread\_t \mbox{\hyperlink{structobsws__connection_a160a7f93e6caf0da1bc2f4dbe48fbb41}{event\_thread}};                 \textcolor{comment}{/* ID of the background thread */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00195}\mbox{\hyperlink{structobsws__connection_afc665d5d6864f038f551e4e7d4aae679}{00195}}     pthread\_mutex\_t \mbox{\hyperlink{structobsws__connection_afc665d5d6864f038f551e4e7d4aae679}{send\_mutex}};             \textcolor{comment}{/* Prevents two threads from sending simultaneously */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00196}\mbox{\hyperlink{structobsws__connection_afbc2be09cbcbbe17561e400babd084e2}{00196}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{structobsws__connection_afbc2be09cbcbbe17561e400babd084e2}{thread\_running}};                    \textcolor{comment}{/* Is the thread currently running? */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00197}\mbox{\hyperlink{structobsws__connection_a6aa5a0ce7b42fc1cd72385181ca43454}{00197}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{structobsws__connection_a6aa5a0ce7b42fc1cd72385181ca43454}{should\_exit}};                       \textcolor{comment}{/* Signal to thread: time to stop */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00198}00198     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00199}00199     \textcolor{comment}{/* === Async Request/Response Handling ===}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00200}00200 \textcolor{comment}{       When you send a request, it returns immediately with a request ID. When the}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00201}00201 \textcolor{comment}{       response comes back, we find the pending\_request by ID and notify the waiter. */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00202}\mbox{\hyperlink{structobsws__connection_acc0664cafa773ffe211ffe993c6ac8af}{00202}}     \mbox{\hyperlink{structpending__request}{pending\_request\_t}} *\mbox{\hyperlink{structobsws__connection_acc0664cafa773ffe211ffe993c6ac8af}{pending\_requests}};    \textcolor{comment}{/* Linked list of in-\/flight requests */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00203}\mbox{\hyperlink{structobsws__connection_a5be49ce76c72f09948fdf9c520eb133c}{00203}}     pthread\_mutex\_t \mbox{\hyperlink{structobsws__connection_a5be49ce76c72f09948fdf9c520eb133c}{requests\_mutex}};         \textcolor{comment}{/* Protects the linked list */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00204}00204     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00205}00205     \textcolor{comment}{/* === Performance Monitoring === */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00206}\mbox{\hyperlink{structobsws__connection_a10b9da03b3a1cb3a6ee0e72387915740}{00206}}     \mbox{\hyperlink{structobsws__stats__t}{obsws\_stats\_t}} \mbox{\hyperlink{structobsws__connection_a10b9da03b3a1cb3a6ee0e72387915740}{stats}};                    \textcolor{comment}{/* Message counts, errors, latency, etc */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00207}\mbox{\hyperlink{structobsws__connection_ab29e2a357e95b536a2c79b0990614bc5}{00207}}     pthread\_mutex\_t \mbox{\hyperlink{structobsws__connection_ab29e2a357e95b536a2c79b0990614bc5}{stats\_mutex}};            \textcolor{comment}{/* Protects stats from concurrent access */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00208}00208     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00209}00209     \textcolor{comment}{/* === Keep-\/Alive / Health Monitoring ===}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00210}00210 \textcolor{comment}{       We send periodic pings to detect when the connection dies. If we don't get}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00211}00211 \textcolor{comment}{       a pong back within the timeout, we know something is wrong. */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00212}\mbox{\hyperlink{structobsws__connection_a940373a69db859ebc424eb555c86a24c}{00212}}     time\_t \mbox{\hyperlink{structobsws__connection_a940373a69db859ebc424eb555c86a24c}{last\_ping\_sent}};                  \textcolor{comment}{/* When we last sent a ping */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00213}\mbox{\hyperlink{structobsws__connection_a5d0b13417d98d699aac28ed7e2d543f6}{00213}}     time\_t \mbox{\hyperlink{structobsws__connection_a5d0b13417d98d699aac28ed7e2d543f6}{last\_pong\_received}};              \textcolor{comment}{/* When we last got a pong back */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00214}00214     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00215}00215     \textcolor{comment}{/* === Reconnection ===}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00216}00216 \textcolor{comment}{       If the connection drops and auto\_reconnect is enabled, we try to reconnect.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00217}00217 \textcolor{comment}{       We use exponential backoff -\/ each attempt waits longer, up to a maximum. */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00218}\mbox{\hyperlink{structobsws__connection_a3a5cd4d0f5a72d53df87306e5c697377}{00218}}     uint32\_t \mbox{\hyperlink{structobsws__connection_a3a5cd4d0f5a72d53df87306e5c697377}{reconnect\_attempts}};            \textcolor{comment}{/* How many times have we tried reconnecting */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00219}\mbox{\hyperlink{structobsws__connection_a32b971d76cdd4c2b166ff19135601776}{00219}}     uint32\_t \mbox{\hyperlink{structobsws__connection_a32b971d76cdd4c2b166ff19135601776}{current\_reconnect\_delay}};       \textcolor{comment}{/* How long we're waiting before next attempt */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00220}00220     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00221}00221     \textcolor{comment}{/* === Authentication State ===}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00222}00222 \textcolor{comment}{       OBS uses a challenge-\/response authentication scheme. The server sends a}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00223}00223 \textcolor{comment}{       challenge and salt, we compute a response using SHA256, and send it back. */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00224}\mbox{\hyperlink{structobsws__connection_a5ed1411f28d7eb3a4dfaff28096fb2fd}{00224}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{structobsws__connection_a5ed1411f28d7eb3a4dfaff28096fb2fd}{auth\_required}};                     \textcolor{comment}{/* Does OBS need authentication? */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00225}\mbox{\hyperlink{structobsws__connection_a99dd8596f842d976297c91a7e101b9f4}{00225}}     \textcolor{keywordtype}{char} *\mbox{\hyperlink{structobsws__connection_a99dd8596f842d976297c91a7e101b9f4}{challenge}};                        \textcolor{comment}{/* Challenge string from OBS HELLO */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00226}\mbox{\hyperlink{structobsws__connection_a172b9304975dc52f9c962e0592f20330}{00226}}     \textcolor{keywordtype}{char} *\mbox{\hyperlink{structobsws__connection_a172b9304975dc52f9c962e0592f20330}{salt}};                             \textcolor{comment}{/* Salt string from OBS HELLO */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00227}00227     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00228}00228     \textcolor{comment}{/* === Optimization Cache ===}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00229}00229 \textcolor{comment}{       We cache the current scene to avoid querying OBS unnecessarily. When we get}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00230}00230 \textcolor{comment}{       a SceneChanged event, we update the cache. */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00231}\mbox{\hyperlink{structobsws__connection_a887874891a0026e6ad2a2ee2c3c7390a}{00231}}     \textcolor{keywordtype}{char} *\mbox{\hyperlink{structobsws__connection_a887874891a0026e6ad2a2ee2c3c7390a}{current\_scene}};                    \textcolor{comment}{/* Cached name of active scene */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00232}\mbox{\hyperlink{structobsws__connection_a4343875c5de5530580e13fb1b528cf35}{00232}}     pthread\_mutex\_t \mbox{\hyperlink{structobsws__connection_a4343875c5de5530580e13fb1b528cf35}{scene\_mutex}};            \textcolor{comment}{/* Protects the cache */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00233}00233 \};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00234}00234 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00235}00235 \textcolor{comment}{/* ============================================================================}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00236}00236 \textcolor{comment}{ * Global State}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00237}00237 \textcolor{comment}{ * ============================================================================ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00238}00238 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00239}00239 \textcolor{comment}{/* Global initialization flag -\/ tracks whether obsws\_init() has been called.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00240}00240 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00241}00241 \textcolor{comment}{   Why have global state at all? Some underlying libraries (like libwebsockets}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00242}00242 \textcolor{comment}{   and OpenSSL) need one-\/time initialization. We do that in obsws\_init() and}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00243}00243 \textcolor{comment}{   make sure it only happens once, even if called multiple times. This flag}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00244}00244 \textcolor{comment}{   tracks whether we've done it.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00245}00245 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00246}00246 \textcolor{comment}{   We use a mutex to protect the flag because someone might call obsws\_init()}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00247}00247 \textcolor{comment}{   from multiple threads simultaneously. The mutex ensures only one thread does}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00248}00248 \textcolor{comment}{   the initialization.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00249}00249 \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00250}00250 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00251}\mbox{\hyperlink{library_8c_a5c573cf80a65ed908b966420c4a5d7d2}{00251}} \textcolor{keyword}{static} \textcolor{keywordtype}{bool} \mbox{\hyperlink{library_8c_a5c573cf80a65ed908b966420c4a5d7d2}{g\_library\_initialized}} = \textcolor{keyword}{false};      \textcolor{comment}{/* Have we called the init code yet? */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00252}\mbox{\hyperlink{library_8c_abaccf3944be55af2f72ebbb713c77706}{00252}} \textcolor{keyword}{static} \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9}{obsws\_log\_level\_t}} \mbox{\hyperlink{library_8c_abaccf3944be55af2f72ebbb713c77706}{g\_log\_level}} = \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9ae48017bf78390a3df8cd87a24782c421}{OBSWS\_LOG\_INFO}};  \textcolor{comment}{/* Global filtering level */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00253}\mbox{\hyperlink{library_8c_abf3a9f2c8c4082f1e6b67daddd8a5931}{00253}} \textcolor{keyword}{static} \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668}{obsws\_debug\_level\_t}} \mbox{\hyperlink{library_8c_abf3a9f2c8c4082f1e6b67daddd8a5931}{g\_debug\_level}} = \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668a0f96dd454f8efb9a755ebda2e81919aa}{OBSWS\_DEBUG\_NONE}};  \textcolor{comment}{/* Global debug verbosity */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00254}\mbox{\hyperlink{library_8c_ad5f633670e2eea3285c1867570a33cbc}{00254}} \textcolor{keyword}{static} pthread\_mutex\_t \mbox{\hyperlink{library_8c_ad5f633670e2eea3285c1867570a33cbc}{g\_init\_mutex}} = PTHREAD\_MUTEX\_INITIALIZER;  \textcolor{comment}{/* Thread-\/safe initialization */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00255}00255 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00256}00256 \textcolor{comment}{/* ============================================================================}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00257}00257 \textcolor{comment}{ * Logging}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00258}00258 \textcolor{comment}{ * ============================================================================ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00259}00259 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00260}00260 \textcolor{comment}{/* Internal logging function -\/ core logging infrastructure.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00261}00261 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00262}00262 \textcolor{comment}{   Design: We filter by log level (higher level = more verbose). If the message}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00263}00263 \textcolor{comment}{   is below the current level, we don't even format it (saves CPU). If there's a}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00264}00264 \textcolor{comment}{   user-\/provided callback, we use it; otherwise we print to stderr.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00265}00265 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00266}00266 \textcolor{comment}{   Why two parameters (conn and format)? So we can log from both the main thread}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00267}00267 \textcolor{comment}{   (with a connection object) and the global initialization code (without one).}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00268}00268 \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00269}00269 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00270}\mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{00270}} \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9}{obsws\_log\_level\_t}} level, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *format, ...) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00271}00271     \textcolor{comment}{/* Early exit if this message is too verbose */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00272}00272     \textcolor{keywordflow}{if} (level > \mbox{\hyperlink{library_8c_abaccf3944be55af2f72ebbb713c77706}{g\_log\_level}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00273}00273         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00274}00274     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00275}00275     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00276}00276     \textcolor{comment}{/* Format the message using printf-\/style arguments */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00277}00277     \textcolor{keywordtype}{char} message[1024];}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00278}00278     va\_list args;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00279}00279     va\_start(args, format);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00280}00280     vsnprintf(message, \textcolor{keyword}{sizeof}(message), format, args);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00281}00281     va\_end(args);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00282}00282     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00283}00283     \textcolor{comment}{/* Route to user callback or stderr. The callback lets the user handle logging}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00284}00284 \textcolor{comment}{       however they want -\/ write to file, send to logging service, etc. */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00285}00285     \textcolor{keywordflow}{if} (conn \&\& conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a14b921ef2d0ad722bd6020da6a708136}{log\_callback}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00286}00286         conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a14b921ef2d0ad722bd6020da6a708136}{log\_callback}}(level, message, conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_af272f38a8f4ca535939766cebacf0b8f}{user\_data}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00287}00287     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00288}00288         \textcolor{keyword}{const} \textcolor{keywordtype}{char} *level\_str[] = \{\textcolor{stringliteral}{"{}NONE"{}}, \textcolor{stringliteral}{"{}ERROR"{}}, \textcolor{stringliteral}{"{}WARN"{}}, \textcolor{stringliteral}{"{}INFO"{}}, \textcolor{stringliteral}{"{}DEBUG"{}}\};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00289}00289         fprintf(stderr, \textcolor{stringliteral}{"{}[OBSWS-\/\%s] \%s\(\backslash\)n"{}}, level\_str[level], message);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00290}00290     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00291}00291 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00292}00292 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00293}00293 \textcolor{comment}{/* Debug logging -\/ finer control for protocol-\/level troubleshooting.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00294}00294 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00295}00295 \textcolor{comment}{   Separate from regular logging because debug messages are very verbose and}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00296}00296 \textcolor{comment}{   developers typically only enable them when debugging specific issues. The}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00297}00297 \textcolor{comment}{   debug level goes 0-\/3, with higher levels including all output from lower levels.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00298}00298 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00299}00299 \textcolor{comment}{   We use a larger buffer (4KB) because debug messages can include JSON payloads.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00300}00300 \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00301}00301 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00302}\mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{00302}} \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{obsws\_debug}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668}{obsws\_debug\_level\_t}} min\_level, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *format, ...) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00303}00303     \textcolor{comment}{/* Only output if global debug level is at or above the minimum for this message */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00304}00304     \textcolor{keywordflow}{if} (\mbox{\hyperlink{library_8c_abf3a9f2c8c4082f1e6b67daddd8a5931}{g\_debug\_level}} < min\_level) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00305}00305         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00306}00306     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00307}00307     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00308}00308     \textcolor{comment}{/* Format with a larger buffer for JSON and other verbose output */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00309}00309     \textcolor{keywordtype}{char} message[4096];}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00310}00310     va\_list args;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00311}00311     va\_start(args, format);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00312}00312     vsnprintf(message, \textcolor{keyword}{sizeof}(message), format, args);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00313}00313     va\_end(args);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00314}00314     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00315}00315     \textcolor{comment}{/* Route through the callback as DEBUG-\/level logs */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00316}00316     \textcolor{keywordflow}{if} (conn \&\& conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a14b921ef2d0ad722bd6020da6a708136}{log\_callback}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00317}00317         conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a14b921ef2d0ad722bd6020da6a708136}{log\_callback}}(\mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9aa69cfac4b3acbd5968bfab9ef5759cd2}{OBSWS\_LOG\_DEBUG}}, message, conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_af272f38a8f4ca535939766cebacf0b8f}{user\_data}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00318}00318     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00319}00319         \textcolor{keyword}{const} \textcolor{keywordtype}{char} *debug\_level\_str[] = \{\textcolor{stringliteral}{"{}NONE"{}}, \textcolor{stringliteral}{"{}LOW"{}}, \textcolor{stringliteral}{"{}MED"{}}, \textcolor{stringliteral}{"{}HIGH"{}}\};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00320}00320         fprintf(stderr, \textcolor{stringliteral}{"{}[DEBUG-\/\%s] \%s\(\backslash\)n"{}}, debug\_level\_str[min\_level], message);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00321}00321     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00322}00322 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00323}00323 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00324}00324 \textcolor{comment}{/* ============================================================================}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00325}00325 \textcolor{comment}{ * Utility Functions}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00326}00326 \textcolor{comment}{ * ============================================================================ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00327}00327 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00328}00328 \textcolor{comment}{/* Generate a UUID v4 for request identification.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00329}00329 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00330}00330 \textcolor{comment}{   UUIDs uniquely identify each request, so when a response comes back, we can match}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00331}00331 \textcolor{comment}{   it to the original request. We use UUID v4 (random) because it's simple and the}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00332}00332 \textcolor{comment}{   uniqueness probability is astronomically high.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00333}00333 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00334}00334 \textcolor{comment}{   Note: This implementation uses rand() for simplicity. A production system might}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00335}00335 \textcolor{comment}{   use /dev/urandom for better randomness, but the current approach is fine for}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00336}00336 \textcolor{comment}{   most use cases. The protocol doesn't require cryptographically secure randomness.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00337}00337 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00338}00338 \textcolor{comment}{   Format: 8-\/4-\/4-\/4-\/12 hex digits with dashes, exactly 36 characters.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00339}00339 \textcolor{comment}{   Example: 550e8400-\/e29b-\/41d4-\/a716-\/446655440000}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00340}00340 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00341}00341 \textcolor{comment}{   The version bits (0x4) and variant bits (0x8-\/b) mark this as a v4 UUID.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00342}00342 \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00343}00343 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00344}\mbox{\hyperlink{library_8c_af79be0fed07182761c923170f4211089}{00344}} \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{library_8c_af79be0fed07182761c923170f4211089}{generate\_uuid}}(\textcolor{keywordtype}{char} *uuid\_out) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00345}00345     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} r1 = rand();}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00346}00346     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} r2 = rand();}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00347}00347     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} r3 = rand();}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00348}00348     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} r4 = rand();}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00349}00349     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00350}00350     sprintf(uuid\_out, \textcolor{stringliteral}{"{}\%08x-\/\%04x-\/\%04x-\/\%04x-\/\%04x\%08x"{}},}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00351}00351             r1,                          \textcolor{comment}{/* 8 hex digits */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00352}00352             r2 \& 0xFFFF,                \textcolor{comment}{/* 4 hex digits */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00353}00353             (r3 \& 0x0FFF) | 0x4000,     \textcolor{comment}{/* 4 hex digits (set version 4) */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00354}00354             (r4 \& 0x3FFF) | 0x8000,     \textcolor{comment}{/* 4 hex digits (set variant bits) */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00355}00355             rand() \& 0xFFFF,            \textcolor{comment}{/* 4 hex digits */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00356}00356             (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})rand());       \textcolor{comment}{/* 8 hex digits */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00357}00357 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00358}00358 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00359}00359 \textcolor{comment}{/* Base64 encode binary data using OpenSSL.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00360}00360 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00361}00361 \textcolor{comment}{   Why base64 and not hex? Hex would be twice as large. Base64 is a standard}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00362}00362 \textcolor{comment}{   encoding for binary data in text contexts (like WebSocket JSON messages).}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00363}00363 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00364}00364 \textcolor{comment}{   We use OpenSSL's BIO (Basic I/O) interface for encoding because it's robust}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00365}00365 \textcolor{comment}{   and well-\/tested. The BIO\_FLAGS\_BASE64\_NO\_NL flag removes newlines that OpenSSL}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00366}00366 \textcolor{comment}{   normally adds for readability -\/ we don't want those in JSON.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00367}00367 \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00368}00368 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00369}\mbox{\hyperlink{library_8c_aab5c2995d6518ef254538795c00afdbb}{00369}} \textcolor{keyword}{static} \textcolor{keywordtype}{char}* \mbox{\hyperlink{library_8c_aab5c2995d6518ef254538795c00afdbb}{base64\_encode}}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *input, \textcolor{keywordtype}{size\_t} length) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00370}00370     BIO *bio, *b64;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00371}00371     BUF\_MEM *buffer\_ptr;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00372}00372     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00373}00373     \textcolor{comment}{/* Set up OpenSSL base64 encoder: b64 filter pushing to memory buffer */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00374}00374     b64 = BIO\_new(BIO\_f\_base64());}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00375}00375     bio = BIO\_new(BIO\_s\_mem());}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00376}00376     bio = BIO\_push(b64, bio);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00377}00377     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00378}00378     \textcolor{comment}{/* Disable newlines in output (OpenSSL adds them by default for readability) */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00379}00379     BIO\_set\_flags(bio, BIO\_FLAGS\_BASE64\_NO\_NL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00380}00380     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00381}00381     \textcolor{comment}{/* Encode the data */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00382}00382     BIO\_write(bio, input, length);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00383}00383     BIO\_flush(bio);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00384}00384     BIO\_get\_mem\_ptr(bio, \&buffer\_ptr);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00385}00385     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00386}00386     \textcolor{comment}{/* Copy result to our own allocated buffer and null-\/terminate */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00387}00387     \textcolor{keywordtype}{char} *result = malloc(buffer\_ptr-\/>length + 1);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00388}00388     memcpy(result, buffer\_ptr-\/>data, buffer\_ptr-\/>length);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00389}00389     result[buffer\_ptr-\/>length] = \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00390}00390     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00391}00391     BIO\_free\_all(bio);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00392}00392     \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00393}00393 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00394}00394 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00395}00395 \textcolor{comment}{/* Compute SHA256 hash of a null-\/terminated string.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00396}00396 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00397}00397 \textcolor{comment}{   SHA256 is a cryptographic hash function. It's deterministic (same input always}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00398}00398 \textcolor{comment}{   produces same output) and has an avalanche property (changing one bit in the}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00399}00399 \textcolor{comment}{   input completely changes the output). This makes it perfect for authentication}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00400}00400 \textcolor{comment}{   protocols.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00401}00401 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00402}00402 \textcolor{comment}{   Why SHA256 instead of SHA1 or MD5? SHA256 is current-\/best-\/practice. SHA1 has}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00403}00403 \textcolor{comment}{   known collisions, and MD5 is even more broken. SHA256 is secure for the}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00404}00404 \textcolor{comment}{   foreseeable future.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00405}00405 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00406}00406 \textcolor{comment}{   Why use EVP (Envelope) API instead of raw SHA256 functions? EVP is higher-\/level}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00407}00407 \textcolor{comment}{   and more flexible -\/ if we ever need to support different hash algorithms, we}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00408}00408 \textcolor{comment}{   just change one line.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00409}00409 \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00410}00410 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00411}\mbox{\hyperlink{library_8c_aaaa872a3d93d0ce3d5d4346f4b1c763e}{00411}} \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{library_8c_aaaa872a3d93d0ce3d5d4346f4b1c763e}{sha256\_hash}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *input, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *output) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00412}00412     EVP\_MD\_CTX *ctx = EVP\_MD\_CTX\_new();}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00413}00413     EVP\_DigestInit\_ex(ctx, EVP\_sha256(), NULL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00414}00414     EVP\_DigestUpdate(ctx, input, strlen(input));}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00415}00415     EVP\_DigestFinal\_ex(ctx, output, NULL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00416}00416     EVP\_MD\_CTX\_free(ctx);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00417}00417 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00418}00418 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00419}00419 \textcolor{comment}{/* Generate OBS WebSocket v5 authentication response using challenge-\/response protocol.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00420}00420 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00421}00421 \textcolor{comment}{   OBS WebSocket v5 uses a two-\/step authentication protocol:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00422}00422 \textcolor{comment}{   1. Server sends challenge + salt}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00423}00423 \textcolor{comment}{   2. Client computes: secret = base64(sha256(password + salt))}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00424}00424 \textcolor{comment}{   3. Client computes: response = base64(sha256(secret + challenge))}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00425}00425 \textcolor{comment}{   4. Client sends response}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00426}00426 \textcolor{comment}{   5. Server verifies by computing the same thing}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00427}00427 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00428}00428 \textcolor{comment}{   Why this design? The password never travels over the network. Instead, a hash}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00429}00429 \textcolor{comment}{   derived from the password (the secret) is combined with a fresh challenge each}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00430}00430 \textcolor{comment}{   time, preventing replay attacks. This is similar to HTTP Digest Authentication.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00431}00431 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00432}00432 \textcolor{comment}{   Why not use the password directly? That would be incredibly insecure. The}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00433}00433 \textcolor{comment}{   two-\/step approach means an eavesdropper who sees the response can't use it}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00434}00434 \textcolor{comment}{   again -\/ the challenge was random and won't repeat.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00435}00435 \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00436}00436 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00437}\mbox{\hyperlink{library_8c_acab761db577bf6b074b4e9be8be845b5}{00437}} \textcolor{keyword}{static} \textcolor{keywordtype}{char}* \mbox{\hyperlink{library_8c_acab761db577bf6b074b4e9be8be845b5}{generate\_auth\_response}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *password, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *salt, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *challenge) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00438}00438     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} secret\_hash[SHA256\_DIGEST\_LENGTH];}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00439}00439     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} auth\_hash[SHA256\_DIGEST\_LENGTH];}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00440}00440     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00441}00441     \textcolor{comment}{/* Step 1: Compute secret = base64(sha256(password + salt)) */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00442}00442     \textcolor{keywordtype}{char} *password\_salt = malloc(strlen(password) + strlen(salt) + 1);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00443}00443     sprintf(password\_salt, \textcolor{stringliteral}{"{}\%s\%s"{}}, password, salt);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00444}00444     \mbox{\hyperlink{library_8c_aaaa872a3d93d0ce3d5d4346f4b1c763e}{sha256\_hash}}(password\_salt, secret\_hash);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00445}00445     free(password\_salt);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00446}00446     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00447}00447     \textcolor{keywordtype}{char} *secret = \mbox{\hyperlink{library_8c_aab5c2995d6518ef254538795c00afdbb}{base64\_encode}}(secret\_hash, SHA256\_DIGEST\_LENGTH);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00448}00448     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00449}00449     \textcolor{comment}{/* Step 2: Compute auth response = base64(sha256(secret + challenge)) */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00450}00450     \textcolor{keywordtype}{char} *secret\_challenge = malloc(strlen(secret) + strlen(challenge) + 1);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00451}00451     sprintf(secret\_challenge, \textcolor{stringliteral}{"{}\%s\%s"{}}, secret, challenge);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00452}00452     \mbox{\hyperlink{library_8c_aaaa872a3d93d0ce3d5d4346f4b1c763e}{sha256\_hash}}(secret\_challenge, auth\_hash);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00453}00453     free(secret\_challenge);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00454}00454     free(secret);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00455}00455     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00456}00456     \textcolor{comment}{/* Return the final response, base64-\/encoded */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00457}00457     \textcolor{keywordtype}{char} *auth\_response = \mbox{\hyperlink{library_8c_aab5c2995d6518ef254538795c00afdbb}{base64\_encode}}(auth\_hash, SHA256\_DIGEST\_LENGTH);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00458}00458     \textcolor{keywordflow}{return} auth\_response;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00459}00459 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00460}00460 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00461}00461 \textcolor{comment}{/* ============================================================================}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00462}00462 \textcolor{comment}{ * State Management}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00463}00463 \textcolor{comment}{ * ============================================================================ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00464}00464 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00465}00465 \textcolor{comment}{/* Update connection state and notify callback if state changed.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00466}00466 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00467}00467 \textcolor{comment}{   This function is responsible for state transitions and notifying the user.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00468}00468 \textcolor{comment}{   We lock the mutex, make the change, unlock it, then call the callback without}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00469}00469 \textcolor{comment}{   holding the lock. Why release the lock before calling the callback? Because}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00470}00470 \textcolor{comment}{   the callback might take a long time, and we don't want to hold a lock during}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00471}00471 \textcolor{comment}{   that time -\/ it would prevent other threads from checking the state.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00472}00472 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00473}00473 \textcolor{comment}{   We only call the callback if the state actually changed. This prevents spurious}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00474}00474 \textcolor{comment}{   notifications if something tries to set the same state again.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00475}00475 \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00476}00476 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00477}\mbox{\hyperlink{library_8c_a2f13308e49322d01e479cbe14da7b575}{00477}} \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{library_8c_a2f13308e49322d01e479cbe14da7b575}{set\_connection\_state}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991}{obsws\_state\_t}} new\_state) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00478}00478     \textcolor{comment}{/* Acquire lock, save old state, set new state, release lock */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00479}00479     pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_aa2752abaf5b201277fae73b42c78c8e6}{state\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00480}00480     \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991}{obsws\_state\_t}} old\_state = conn-\/>\mbox{\hyperlink{structobsws__connection_adad7d0fb4880543b1f5b5e897010d814}{state}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00481}00481     conn-\/>\mbox{\hyperlink{structobsws__connection_adad7d0fb4880543b1f5b5e897010d814}{state}} = new\_state;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00482}00482     pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_aa2752abaf5b201277fae73b42c78c8e6}{state\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00483}00483     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00484}00484     \textcolor{comment}{/* Call callback only if state actually changed (not a duplicate) */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00485}00485     \textcolor{keywordflow}{if} (old\_state != new\_state \&\& conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a580a2daf514e79022b6d488c4933845e}{state\_callback}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00486}00486         conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a580a2daf514e79022b6d488c4933845e}{state\_callback}}(conn, old\_state, new\_state, conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_af272f38a8f4ca535939766cebacf0b8f}{user\_data}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00487}00487     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00488}00488     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00489}00489     \textcolor{comment}{/* Log the transition for debugging/monitoring */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00490}00490     \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9ae48017bf78390a3df8cd87a24782c421}{OBSWS\_LOG\_INFO}}, \textcolor{stringliteral}{"{}State changed: \%s -\/> \%s"{}}, }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00491}00491               \mbox{\hyperlink{library_8c_a69f8fcc1732533a2ebe573ac65effa04}{obsws\_state\_string}}(old\_state), \mbox{\hyperlink{library_8c_a69f8fcc1732533a2ebe573ac65effa04}{obsws\_state\_string}}(new\_state));}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00492}00492 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00493}00493 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00494}00494 \textcolor{comment}{/* ============================================================================}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00495}00495 \textcolor{comment}{ * Request Management}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00496}00496 \textcolor{comment}{ * ============================================================================ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00497}00497 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00498}00498 \textcolor{comment}{/* Create a new pending request and add it to the tracking list.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00499}00499 \textcolor{comment}{   }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00500}00500 \textcolor{comment}{   When we send a request to OBS, we need to track it so we can match the response}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00501}00501 \textcolor{comment}{   when it arrives. This function creates a pending\_request\_t struct and adds it}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00502}00502 \textcolor{comment}{   to the linked list. The request is initialized with the ID, a condition variable}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00503}00503 \textcolor{comment}{   for waiting, and a current timestamp for timeout detection.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00504}00504 \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00505}00505 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00506}\mbox{\hyperlink{library_8c_aafc3d1ce3debddcb8e3888c9806e044a}{00506}} \textcolor{keyword}{static} \mbox{\hyperlink{structpending__request}{pending\_request\_t}}* \mbox{\hyperlink{library_8c_aafc3d1ce3debddcb8e3888c9806e044a}{create\_pending\_request}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *request\_id) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00507}00507     \mbox{\hyperlink{structpending__request}{pending\_request\_t}} *req = calloc(1, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structpending__request}{pending\_request\_t}}));}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00508}00508     \textcolor{keywordflow}{if} (!req) \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00509}00509     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00510}00510     \textcolor{comment}{/* Copy request ID and ensure null termination */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00511}00511     strncpy(req-\/>\mbox{\hyperlink{structpending__request_ae33cc3402bf8463415de7e57eac346af}{request\_id}}, request\_id, \mbox{\hyperlink{library_8c_a25b13264018fd1dc7b1f2bbd93bdc7cc}{OBSWS\_UUID\_LENGTH}} -\/ 1);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00512}00512     req-\/>\mbox{\hyperlink{structpending__request_ae33cc3402bf8463415de7e57eac346af}{request\_id}}[\mbox{\hyperlink{library_8c_a25b13264018fd1dc7b1f2bbd93bdc7cc}{OBSWS\_UUID\_LENGTH}} -\/ 1] = \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00513}00513     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00514}00514     \textcolor{comment}{/* Initialize request structure */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00515}00515     req-\/>\mbox{\hyperlink{structpending__request_a4b37104673cb81e3f2825c8f6df372ba}{response}} = calloc(1, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structobsws__response__t}{obsws\_response\_t}}));}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00516}00516     req-\/>\mbox{\hyperlink{structpending__request_af74dd3c97a064175b9dcf3dbfe3665cc}{completed}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00517}00517     req-\/>\mbox{\hyperlink{structpending__request_a0fab8de980618cc4e6cea21fbed2eef4}{timestamp}} = time(NULL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00518}00518     pthread\_mutex\_init(\&req-\/>\mbox{\hyperlink{structpending__request_a30b4636ccd06e4f775ee0dcc29ba3a69}{mutex}}, NULL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00519}00519     pthread\_cond\_init(\&req-\/>\mbox{\hyperlink{structpending__request_a619500d05293ec1f654ea803139941de}{cond}}, NULL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00520}00520     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00521}00521     \textcolor{comment}{/* Add to linked list of pending requests */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00522}00522     pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a5be49ce76c72f09948fdf9c520eb133c}{requests\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00523}00523     req-\/>\mbox{\hyperlink{structpending__request_a49161e43ef29129c11fe643e85338df2}{next}} = conn-\/>\mbox{\hyperlink{structobsws__connection_acc0664cafa773ffe211ffe993c6ac8af}{pending\_requests}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00524}00524     conn-\/>\mbox{\hyperlink{structobsws__connection_acc0664cafa773ffe211ffe993c6ac8af}{pending\_requests}} = req;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00525}00525     pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a5be49ce76c72f09948fdf9c520eb133c}{requests\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00526}00526     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00527}00527     \textcolor{keywordflow}{return} req;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00528}00528 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00529}00529 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00530}00530 \textcolor{comment}{/* Find a pending request by its UUID */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00531}\mbox{\hyperlink{library_8c_a6f7f5f47389b537c9dce9f1b328b7f06}{00531}} \textcolor{keyword}{static} \mbox{\hyperlink{structpending__request}{pending\_request\_t}}* \mbox{\hyperlink{library_8c_a6f7f5f47389b537c9dce9f1b328b7f06}{find\_pending\_request}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *request\_id) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00532}00532     pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a5be49ce76c72f09948fdf9c520eb133c}{requests\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00533}00533     \mbox{\hyperlink{structpending__request}{pending\_request\_t}} *req = conn-\/>\mbox{\hyperlink{structobsws__connection_acc0664cafa773ffe211ffe993c6ac8af}{pending\_requests}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00534}00534     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00535}00535     \textcolor{comment}{/* Search linked list for matching request ID */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00536}00536     \textcolor{keywordflow}{while} (req) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00537}00537         \textcolor{keywordflow}{if} (strcmp(req-\/>\mbox{\hyperlink{structpending__request_ae33cc3402bf8463415de7e57eac346af}{request\_id}}, request\_id) == 0) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00538}00538             pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a5be49ce76c72f09948fdf9c520eb133c}{requests\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00539}00539             \textcolor{keywordflow}{return} req;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00540}00540         \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00541}00541         req = req-\/>\mbox{\hyperlink{structpending__request_a49161e43ef29129c11fe643e85338df2}{next}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00542}00542     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00543}00543     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00544}00544     pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a5be49ce76c72f09948fdf9c520eb133c}{requests\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00545}00545     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00546}00546 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00547}00547 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00548}00548 \textcolor{comment}{/* Remove a pending request from the tracking list and free it */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00549}\mbox{\hyperlink{library_8c_a700c8a9baa87a3827b399776e811f328}{00549}} \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{library_8c_a700c8a9baa87a3827b399776e811f328}{remove\_pending\_request}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, \mbox{\hyperlink{structpending__request}{pending\_request\_t}} *target) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00550}00550     pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a5be49ce76c72f09948fdf9c520eb133c}{requests\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00551}00551     \mbox{\hyperlink{structpending__request}{pending\_request\_t}} **req = \&conn-\/>\mbox{\hyperlink{structobsws__connection_acc0664cafa773ffe211ffe993c6ac8af}{pending\_requests}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00552}00552     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00553}00553     \textcolor{comment}{/* Find and remove from linked list */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00554}00554     \textcolor{keywordflow}{while} (*req) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00555}00555         \textcolor{keywordflow}{if} (*req == target) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00556}00556             *req = target-\/>\mbox{\hyperlink{structpending__request_a49161e43ef29129c11fe643e85338df2}{next}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00557}00557             pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a5be49ce76c72f09948fdf9c520eb133c}{requests\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00558}00558             }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00559}00559             \textcolor{comment}{/* Clean up request resources */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00560}00560             pthread\_mutex\_destroy(\&target-\/>\mbox{\hyperlink{structpending__request_a30b4636ccd06e4f775ee0dcc29ba3a69}{mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00561}00561             pthread\_cond\_destroy(\&target-\/>\mbox{\hyperlink{structpending__request_a619500d05293ec1f654ea803139941de}{cond}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00562}00562             free(target);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00563}00563             \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00564}00564         \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00565}00565         req = \&(*req)-\/>\mbox{\hyperlink{structpending__request_a49161e43ef29129c11fe643e85338df2}{next}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00566}00566     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00567}00567     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00568}00568     pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a5be49ce76c72f09948fdf9c520eb133c}{requests\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00569}00569 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00570}00570 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00571}00571 \textcolor{comment}{/* Clean up requests that have exceeded the timeout period */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00572}\mbox{\hyperlink{library_8c_a885f22656ee8ca3170a50df0e0d85a4d}{00572}} \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{library_8c_a885f22656ee8ca3170a50df0e0d85a4d}{cleanup\_old\_requests}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00573}00573     time\_t now = time(NULL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00574}00574     pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a5be49ce76c72f09948fdf9c520eb133c}{requests\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00575}00575     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00576}00576     \mbox{\hyperlink{structpending__request}{pending\_request\_t}} **req = \&conn-\/>\mbox{\hyperlink{structobsws__connection_acc0664cafa773ffe211ffe993c6ac8af}{pending\_requests}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00577}00577     \textcolor{keywordflow}{while} (*req) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00578}00578         \textcolor{comment}{/* Check if request has timed out (30 seconds) */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00579}00579         \textcolor{keywordflow}{if} (now -\/ (*req)-\/>timestamp > 30) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00580}00580             \mbox{\hyperlink{structpending__request}{pending\_request\_t}} *old = *req;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00581}00581             *req = old-\/>\mbox{\hyperlink{structpending__request_a49161e43ef29129c11fe643e85338df2}{next}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00582}00582             }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00583}00583             \textcolor{comment}{/* Mark as completed with timeout error */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00584}00584             pthread\_mutex\_lock(\&old-\/>\mbox{\hyperlink{structpending__request_a30b4636ccd06e4f775ee0dcc29ba3a69}{mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00585}00585             old-\/>\mbox{\hyperlink{structpending__request_af74dd3c97a064175b9dcf3dbfe3665cc}{completed}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00586}00586             old-\/>\mbox{\hyperlink{structpending__request_a4b37104673cb81e3f2825c8f6df372ba}{response}}-\/>\mbox{\hyperlink{structobsws__response__t_abbf2e99faa8fdef1c94bbd174470c821}{success}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00587}00587             old-\/>\mbox{\hyperlink{structpending__request_a4b37104673cb81e3f2825c8f6df372ba}{response}}-\/>\mbox{\hyperlink{structobsws__response__t_ab2b3055a84989889d3de28c2ccfd0dac}{error\_message}} = strdup(\textcolor{stringliteral}{"{}Request timeout"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00588}00588             pthread\_cond\_broadcast(\&old-\/>\mbox{\hyperlink{structpending__request_a619500d05293ec1f654ea803139941de}{cond}});  \textcolor{comment}{/* Wake waiting threads */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00589}00589             pthread\_mutex\_unlock(\&old-\/>\mbox{\hyperlink{structpending__request_a30b4636ccd06e4f775ee0dcc29ba3a69}{mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00590}00590         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00591}00591             req = \&(*req)-\/>\mbox{\hyperlink{structpending__request_a49161e43ef29129c11fe643e85338df2}{next}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00592}00592         \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00593}00593     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00594}00594     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00595}00595     pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a5be49ce76c72f09948fdf9c520eb133c}{requests\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00596}00596 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00597}00597 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00598}00598 \textcolor{comment}{/* ============================================================================}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00599}00599 \textcolor{comment}{ * WebSocket Protocol Handling}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00600}00600 \textcolor{comment}{ * ============================================================================ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00601}00601 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00602}00602 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00603}00603 \textcolor{comment}{ * @brief Handle the initial HELLO handshake message from OBS.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00604}00604 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00605}00605 \textcolor{comment}{ * When we first connect to OBS, the server sends a HELLO message containing}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00606}00606 \textcolor{comment}{ * protocol version information and, if required, an authentication challenge}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00607}00607 \textcolor{comment}{ * and salt. This function extracts that information and immediately responds}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00608}00608 \textcolor{comment}{ * with an IDENTIFY message.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00609}00609 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00610}00610 \textcolor{comment}{ * The authentication flow (if enabled) works as follows:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00611}00611 \textcolor{comment}{ * 1. Server sends HELLO with a random challenge string and a salt}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00612}00612 \textcolor{comment}{ * 2. We compute: secret = base64(SHA256(password + salt))}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00613}00613 \textcolor{comment}{ * 3. We compute: response = base64(SHA256(secret + challenge))}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00614}00614 \textcolor{comment}{ * 4. We send this response in the IDENTIFY message}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00615}00615 \textcolor{comment}{ * 5. If it matches what the server computed, auth succeeds}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00616}00616 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00617}00617 \textcolor{comment}{ * This challenge-\/response approach has several advantages over sending the}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00618}00618 \textcolor{comment}{ * raw password:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00619}00619 \textcolor{comment}{ * -\/ Password never travels across the network (only the computed response)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00620}00620 \textcolor{comment}{ * -\/ If someone captures the network traffic, they can't replay the captured}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00621}00621 \textcolor{comment}{ *   response because it's specific to this challenge (which was random)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00622}00622 \textcolor{comment}{ * -\/ Similar to HTTP Digest Authentication (RFC 2617) but simpler}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00623}00623 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00624}00624 \textcolor{comment}{ * The function transitions the connection state from CONNECTING to AUTHENTICATING,}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00625}00625 \textcolor{comment}{ * sends the IDENTIFY message, and logs any authentication requirements.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00626}00626 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00627}00627 \textcolor{comment}{ * @param conn The connection structure containing buffers, config, and state}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00628}00628 \textcolor{comment}{ * @param data The parsed JSON "{}d"{} field from the HELLO message, containing}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00629}00629 \textcolor{comment}{ *             authentication info if auth is required}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00630}00630 \textcolor{comment}{ * @return 0 on success, -\/1 on error (though errors are logged and connection}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00631}00631 \textcolor{comment}{ *         continues -\/ failure to authenticate will be detected by the server}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00632}00632 \textcolor{comment}{ *         refusing to transition to IDENTIFIED state)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00633}00633 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00634}00634 \textcolor{comment}{ * @internal}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00635}00635 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00636}\mbox{\hyperlink{library_8c_af183411517ec69b1d59f875fbb0245bd}{00636}} \textcolor{keyword}{static} \textcolor{keywordtype}{int} \mbox{\hyperlink{library_8c_af183411517ec69b1d59f875fbb0245bd}{handle\_hello\_message}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, cJSON *data) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00637}00637     \textcolor{comment}{/* DEBUG\_LOW: Basic connection event */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00638}00638     \mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{obsws\_debug}}(conn, \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668a50fd66057e634b5bd51441ba3fdeaf50}{OBSWS\_DEBUG\_LOW}}, \textcolor{stringliteral}{"{}Received Hello message from OBS"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00639}00639     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00640}00640     cJSON *auth = cJSON\_GetObjectItem(data, \textcolor{stringliteral}{"{}authentication"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00641}00641     \textcolor{keywordflow}{if} (auth) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00642}00642         conn-\/>\mbox{\hyperlink{structobsws__connection_a5ed1411f28d7eb3a4dfaff28096fb2fd}{auth\_required}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00643}00643         }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00644}00644         cJSON *challenge = cJSON\_GetObjectItem(auth, \textcolor{stringliteral}{"{}challenge"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00645}00645         cJSON *salt = cJSON\_GetObjectItem(auth, \textcolor{stringliteral}{"{}salt"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00646}00646         }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00647}00647         \textcolor{keywordflow}{if} (challenge \&\& salt) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00648}00648             conn-\/>\mbox{\hyperlink{structobsws__connection_a99dd8596f842d976297c91a7e101b9f4}{challenge}} = strdup(challenge-\/>valuestring);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00649}00649             conn-\/>\mbox{\hyperlink{structobsws__connection_a172b9304975dc52f9c962e0592f20330}{salt}} = strdup(salt-\/>valuestring);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00650}00650             \textcolor{comment}{/* DEBUG\_MEDIUM: Show auth parameters */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00651}00651             \mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{obsws\_debug}}(conn, \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668aa6c8d9d070b4d69beeadf605bc03eee1}{OBSWS\_DEBUG\_MEDIUM}}, \textcolor{stringliteral}{"{}Authentication required -\/ salt: \%s, challenge: \%s"{}}, }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00652}00652                      conn-\/>\mbox{\hyperlink{structobsws__connection_a172b9304975dc52f9c962e0592f20330}{salt}}, conn-\/>\mbox{\hyperlink{structobsws__connection_a99dd8596f842d976297c91a7e101b9f4}{challenge}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00653}00653         \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00654}00654     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00655}00655         conn-\/>\mbox{\hyperlink{structobsws__connection_a5ed1411f28d7eb3a4dfaff28096fb2fd}{auth\_required}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00656}00656         \mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{obsws\_debug}}(conn, \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668a50fd66057e634b5bd51441ba3fdeaf50}{OBSWS\_DEBUG\_LOW}}, \textcolor{stringliteral}{"{}No authentication required"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00657}00657     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00658}00658     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00659}00659     \textcolor{comment}{/* Send Identify message */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00660}00660     \mbox{\hyperlink{library_8c_a2f13308e49322d01e479cbe14da7b575}{set\_connection\_state}}(conn, \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991ac9c5d9c3aab50d7e6d1d38b1bb7d6d0f}{OBSWS\_STATE\_AUTHENTICATING}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00661}00661     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00662}00662     cJSON *identify = cJSON\_CreateObject();}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00663}00663     cJSON\_AddNumberToObject(identify, \textcolor{stringliteral}{"{}op"{}}, \mbox{\hyperlink{library_8c_a9ac9adf7323ec0e886fa7294ef8c387c}{OBSWS\_OPCODE\_IDENTIFY}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00664}00664     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00665}00665     cJSON *identify\_data = cJSON\_CreateObject();}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00666}00666     cJSON\_AddNumberToObject(identify\_data, \textcolor{stringliteral}{"{}rpcVersion"{}}, \mbox{\hyperlink{library_8c_af132d6e679351e32e25e03f0446b9a79}{OBSWS\_PROTOCOL\_VERSION}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00667}00667     cJSON\_AddNumberToObject(identify\_data, \textcolor{stringliteral}{"{}eventSubscriptions"{}}, \mbox{\hyperlink{library_8c_a22c0214b5dafa0c23d7c7fe4c0686f7c}{OBSWS\_EVENT\_ALL}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00668}00668     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00669}00669     \textcolor{keywordflow}{if} (conn-\/>\mbox{\hyperlink{structobsws__connection_a5ed1411f28d7eb3a4dfaff28096fb2fd}{auth\_required}} \&\& conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a53ed762a113bb2a27b3ffab06a5c02ee}{password}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00670}00670         \textcolor{comment}{/* DEBUG\_HIGH: Show password being used */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00671}00671         \mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{obsws\_debug}}(conn, \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668aceb0431d743cdecf0848564f388d51bd}{OBSWS\_DEBUG\_HIGH}}, \textcolor{stringliteral}{"{}Generating auth response with password: '\%s'"{}}, conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a53ed762a113bb2a27b3ffab06a5c02ee}{password}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00672}00672         \textcolor{keywordtype}{char} *auth\_response = \mbox{\hyperlink{library_8c_acab761db577bf6b074b4e9be8be845b5}{generate\_auth\_response}}(conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a53ed762a113bb2a27b3ffab06a5c02ee}{password}}, conn-\/>\mbox{\hyperlink{structobsws__connection_a172b9304975dc52f9c962e0592f20330}{salt}}, conn-\/>\mbox{\hyperlink{structobsws__connection_a99dd8596f842d976297c91a7e101b9f4}{challenge}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00673}00673         \textcolor{comment}{/* DEBUG\_MEDIUM: Show generated auth string */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00674}00674         \mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{obsws\_debug}}(conn, \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668aa6c8d9d070b4d69beeadf605bc03eee1}{OBSWS\_DEBUG\_MEDIUM}}, \textcolor{stringliteral}{"{}Generated auth response: '\%s'"{}}, auth\_response);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00675}00675         cJSON\_AddStringToObject(identify\_data, \textcolor{stringliteral}{"{}authentication"{}}, auth\_response);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00676}00676         free(auth\_response);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00677}00677     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00678}00678         \textcolor{keywordflow}{if} (conn-\/>\mbox{\hyperlink{structobsws__connection_a5ed1411f28d7eb3a4dfaff28096fb2fd}{auth\_required}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00679}00679             \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9a6a2a374e4af0446011df30bfd09e329e}{OBSWS\_LOG\_ERROR}}, \textcolor{stringliteral}{"{}Authentication required but no password provided!"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00680}00680         \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00681}00681     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00682}00682     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00683}00683     cJSON\_AddItemToObject(identify, \textcolor{stringliteral}{"{}d"{}}, identify\_data);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00684}00684     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00685}00685     \textcolor{keywordtype}{char} *message = cJSON\_PrintUnformatted(identify);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00686}00686     cJSON\_Delete(identify);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00687}00687     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00688}00688     \textcolor{comment}{/* DEBUG\_HIGH: Show full Identify message */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00689}00689     \mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{obsws\_debug}}(conn, \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668aceb0431d743cdecf0848564f388d51bd}{OBSWS\_DEBUG\_HIGH}}, \textcolor{stringliteral}{"{}Sending Identify message: \%s"{}}, message);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00690}00690     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00691}00691     pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_afc665d5d6864f038f551e4e7d4aae679}{send\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00692}00692     \textcolor{keywordtype}{size\_t} len = strlen(message);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00693}00693     \textcolor{keywordflow}{if} (len < conn-\/>send\_buffer\_size -\/ LWS\_PRE) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00694}00694         memcpy(conn-\/>\mbox{\hyperlink{structobsws__connection_a14a61d0e27a8cac772ce173dd31d4fb7}{send\_buffer}} + LWS\_PRE, message, len);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00695}00695         \textcolor{keywordtype}{int} written = lws\_write(conn-\/>\mbox{\hyperlink{structobsws__connection_aaf49ac1578fc794ee4b01ccbf9edc35a}{wsi}}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *)(conn-\/>\mbox{\hyperlink{structobsws__connection_a14a61d0e27a8cac772ce173dd31d4fb7}{send\_buffer}} + LWS\_PRE), len, LWS\_WRITE\_TEXT);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00696}00696         \textcolor{comment}{/* DEBUG\_HIGH: Show bytes sent */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00697}00697         \mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{obsws\_debug}}(conn, \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668aceb0431d743cdecf0848564f388d51bd}{OBSWS\_DEBUG\_HIGH}}, \textcolor{stringliteral}{"{}Sent \%d bytes (requested \%zu)"{}}, written, len);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00698}00698     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00699}00699         \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9a6a2a374e4af0446011df30bfd09e329e}{OBSWS\_LOG\_ERROR}}, \textcolor{stringliteral}{"{}Message too large for send buffer: \%zu bytes"{}}, len);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00700}00700     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00701}00701     pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_afc665d5d6864f038f551e4e7d4aae679}{send\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00702}00702     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00703}00703     free(message);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00704}00704     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00705}00705 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00706}00706 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00707}00707 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00708}00708 \textcolor{comment}{ * @brief Handle the IDENTIFIED confirmation message from OBS.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00709}00709 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00710}00710 \textcolor{comment}{ * After we send an IDENTIFY message with authentication (or without if auth}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00711}00711 \textcolor{comment}{ * isn't required), OBS responds with an IDENTIFIED message to confirm that}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00712}00712 \textcolor{comment}{ * the connection is established and ready for commands. This function marks}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00713}00713 \textcolor{comment}{ * the connection as fully established, records connection statistics, and}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00714}00714 \textcolor{comment}{ * resets the reconnection state.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00715}00715 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00716}00716 \textcolor{comment}{ * Receiving this message means:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00717}00717 \textcolor{comment}{ * -\/ Authentication succeeded (if it was required)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00718}00718 \textcolor{comment}{ * -\/ The server has accepted our protocol version}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00719}00719 \textcolor{comment}{ * -\/ We can now send REQUEST messages and receive EVENT messages}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00720}00720 \textcolor{comment}{ * -\/ The connection is in a healthy state}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00721}00721 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00722}00722 \textcolor{comment}{ * We take this opportunity to:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00723}00723 \textcolor{comment}{ * 1. Log successful authentication}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00724}00724 \textcolor{comment}{ * 2. Transition state to CONNECTED (the only valid way to enter this state)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00725}00725 \textcolor{comment}{ * 3. Record the timestamp of successful connection (for statistics)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00726}00726 \textcolor{comment}{ * 4. Reset the reconnection attempt counter and delay (we're connected!)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00727}00727 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00728}00728 \textcolor{comment}{ * @param conn The connection structure to mark as identified}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00729}00729 \textcolor{comment}{ * @param data Unused (the IDENTIFIED message typically has no data payload)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00730}00730 \textcolor{comment}{ * @return Always 0 (this message type should never fail)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00731}00731 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00732}00732 \textcolor{comment}{ * @internal}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00733}00733 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00734}\mbox{\hyperlink{library_8c_aad4174fe2c4665d21ae49896fc25be9e}{00734}} \textcolor{keyword}{static} \textcolor{keywordtype}{int} \mbox{\hyperlink{library_8c_aad4174fe2c4665d21ae49896fc25be9e}{handle\_identified\_message}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, cJSON *data) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00735}00735     (void)data;  \textcolor{comment}{/* Unused parameter */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00736}00736     \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9ae48017bf78390a3df8cd87a24782c421}{OBSWS\_LOG\_INFO}}, \textcolor{stringliteral}{"{}Successfully authenticated with OBS"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00737}00737     \textcolor{comment}{/* DEBUG\_LOW: Authentication success */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00738}00738     \mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{obsws\_debug}}(conn, \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668a50fd66057e634b5bd51441ba3fdeaf50}{OBSWS\_DEBUG\_LOW}}, \textcolor{stringliteral}{"{}Identified message received -\/ authentication successful"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00739}00739     \mbox{\hyperlink{library_8c_a2f13308e49322d01e479cbe14da7b575}{set\_connection\_state}}(conn, \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991adbaae08035175b470fb9f543414672b8}{OBSWS\_STATE\_CONNECTED}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00740}00740     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00741}00741     pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_ab29e2a357e95b536a2c79b0990614bc5}{stats\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00742}00742     conn-\/>\mbox{\hyperlink{structobsws__connection_a10b9da03b3a1cb3a6ee0e72387915740}{stats}}.\mbox{\hyperlink{structobsws__stats__t_a7beeb77349c34e8aee20d09df550f8fb}{connected\_since}} = time(NULL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00743}00743     conn-\/>\mbox{\hyperlink{structobsws__connection_a10b9da03b3a1cb3a6ee0e72387915740}{stats}}.\mbox{\hyperlink{structobsws__stats__t_a156bc64dad480c853539be79f2276654}{reconnect\_count}} = conn-\/>\mbox{\hyperlink{structobsws__connection_a3a5cd4d0f5a72d53df87306e5c697377}{reconnect\_attempts}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00744}00744     pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_ab29e2a357e95b536a2c79b0990614bc5}{stats\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00745}00745     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00746}00746     conn-\/>\mbox{\hyperlink{structobsws__connection_a3a5cd4d0f5a72d53df87306e5c697377}{reconnect\_attempts}} = 0;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00747}00747     conn-\/>\mbox{\hyperlink{structobsws__connection_a32b971d76cdd4c2b166ff19135601776}{current\_reconnect\_delay}} = conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a5ccd3a828a3fcad6d6ebedc0324c4aee}{reconnect\_delay\_ms}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00748}00748     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00749}00749     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00750}00750 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00751}00751 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00752}00752 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00753}00753 \textcolor{comment}{ * @brief Handle EVENT messages from OBS (real-\/time notifications).}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00754}00754 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00755}00755 \textcolor{comment}{ * OBS continuously sends EVENT messages whenever something happens in the}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00756}00756 \textcolor{comment}{ * application (scene changes, source muted/unmuted, recording started, etc.).}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00757}00757 \textcolor{comment}{ * These events are only delivered if we subscribed to them in the IDENTIFY}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00758}00758 \textcolor{comment}{ * message using the eventSubscriptions bitmask.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00759}00759 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00760}00760 \textcolor{comment}{ * This function:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00761}00761 \textcolor{comment}{ * 1. Extracts the event type and event data from the JSON}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00762}00762 \textcolor{comment}{ * 2. Calls the user's event\_callback if one was configured (async event loop)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00763}00763 \textcolor{comment}{ * 3. Updates internal caches (e.g., current scene name on SceneChanged)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00764}00764 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00765}00765 \textcolor{comment}{ * Important threading note: This is called from the background event\_thread,}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00766}00766 \textcolor{comment}{ * NOT from the main application thread. Therefore:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00767}00767 \textcolor{comment}{ * -\/ The event\_callback is executed in the event thread context}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00768}00768 \textcolor{comment}{ * -\/ The callback should not block (keep processing fast)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00769}00769 \textcolor{comment}{ * -\/ The callback should not make blocking library calls}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00770}00770 \textcolor{comment}{ * -\/ The event\_data\_str parameter is temporary and freed after callback returns}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00771}00771 \textcolor{comment}{ * -\/ If the callback needs to keep the data, it must copy it}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00772}00772 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00773}00773 \textcolor{comment}{ * Scene caching optimization:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00774}00774 \textcolor{comment}{ * We maintain a cache of the currently active scene name in the connection}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00775}00775 \textcolor{comment}{ * structure. When we see a CurrentProgramSceneChanged event, we update this}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00776}00776 \textcolor{comment}{ * cache immediately. This avoids the need for the application to call}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00777}00777 \textcolor{comment}{ * obsws\_send\_request(..., "{}GetCurrentProgramScene"{}, ...) repeatedly.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00778}00778 \textcolor{comment}{ * The cache is protected by scene\_mutex for thread safety.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00779}00779 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00780}00780 \textcolor{comment}{ * @param conn The connection that received the event}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00781}00781 \textcolor{comment}{ * @param data The parsed JSON "{}d"{} field containing eventType and eventData}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00782}00782 \textcolor{comment}{ * @return 0 on success, -\/1 if the event data is malformed}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00783}00783 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00784}00784 \textcolor{comment}{ * @internal}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00785}00785 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00786}\mbox{\hyperlink{library_8c_ac7c18bfa245d7a8582c6e5536cf46532}{00786}} \textcolor{keyword}{static} \textcolor{keywordtype}{int} \mbox{\hyperlink{library_8c_ac7c18bfa245d7a8582c6e5536cf46532}{handle\_event\_message}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, cJSON *data) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00787}00787     cJSON *event\_type = cJSON\_GetObjectItem(data, \textcolor{stringliteral}{"{}eventType"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00788}00788     cJSON *event\_data = cJSON\_GetObjectItem(data, \textcolor{stringliteral}{"{}eventData"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00789}00789     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00790}00790     \textcolor{comment}{/* DEBUG\_MEDIUM: Show event type */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00791}00791     \textcolor{keywordflow}{if} (event\_type) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00792}00792         \mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{obsws\_debug}}(conn, \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668aa6c8d9d070b4d69beeadf605bc03eee1}{OBSWS\_DEBUG\_MEDIUM}}, \textcolor{stringliteral}{"{}Event received: \%s"{}}, event\_type-\/>valuestring);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00793}00793     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00794}00794     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00795}00795     \textcolor{keywordflow}{if} (event\_type \&\& conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a11caeff695d6174de08bd0ff0e196cd3}{event\_callback}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00796}00796         \textcolor{keywordtype}{char} *event\_data\_str = event\_data ? cJSON\_PrintUnformatted(event\_data) : NULL;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00797}00797         \textcolor{comment}{/* DEBUG\_HIGH: Show full event data */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00798}00798         \textcolor{keywordflow}{if} (event\_data\_str) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00799}00799             \mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{obsws\_debug}}(conn, \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668aceb0431d743cdecf0848564f388d51bd}{OBSWS\_DEBUG\_HIGH}}, \textcolor{stringliteral}{"{}Event data: \%s"{}}, event\_data\_str);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00800}00800         \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00801}00801         conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a11caeff695d6174de08bd0ff0e196cd3}{event\_callback}}(conn, event\_type-\/>valuestring, event\_data\_str, conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_af272f38a8f4ca535939766cebacf0b8f}{user\_data}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00802}00802         \textcolor{keywordflow}{if} (event\_data\_str) free(event\_data\_str);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00803}00803     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00804}00804     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00805}00805     \textcolor{comment}{/* Update current scene cache if scene changed */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00806}00806     \textcolor{keywordflow}{if} (event\_type \&\& strcmp(event\_type-\/>valuestring, \textcolor{stringliteral}{"{}CurrentProgramSceneChanged"{}}) == 0) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00807}00807         cJSON *scene\_name = cJSON\_GetObjectItem(event\_data, \textcolor{stringliteral}{"{}sceneName"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00808}00808         \textcolor{keywordflow}{if} (scene\_name) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00809}00809             pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a4343875c5de5530580e13fb1b528cf35}{scene\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00810}00810             free(conn-\/>\mbox{\hyperlink{structobsws__connection_a887874891a0026e6ad2a2ee2c3c7390a}{current\_scene}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00811}00811             conn-\/>\mbox{\hyperlink{structobsws__connection_a887874891a0026e6ad2a2ee2c3c7390a}{current\_scene}} = strdup(scene\_name-\/>valuestring);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00812}00812             pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a4343875c5de5530580e13fb1b528cf35}{scene\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00813}00813             \textcolor{comment}{/* DEBUG\_LOW: Scene changes are important */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00814}00814             \mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{obsws\_debug}}(conn, \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668a50fd66057e634b5bd51441ba3fdeaf50}{OBSWS\_DEBUG\_LOW}}, \textcolor{stringliteral}{"{}Scene changed to: \%s"{}}, scene\_name-\/>valuestring);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00815}00815         \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00816}00816     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00817}00817     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00818}00818     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00819}00819 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00820}00820 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00821}00821 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00822}00822 \textcolor{comment}{ * @brief Handle REQUEST\_RESPONSE messages from OBS (responses to our commands).}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00823}00823 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00824}00824 \textcolor{comment}{ * When we send a REQUEST message (via obsws\_send\_request), OBS processes it}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00825}00825 \textcolor{comment}{ * and sends back a REQUEST\_RESPONSE message with the same requestId that we}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00826}00826 \textcolor{comment}{ * used. This function matches the response to the pending request, populates}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00827}00827 \textcolor{comment}{ * the response data, and wakes up the waiting thread.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00828}00828 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00829}00829 \textcolor{comment}{ * The async request/response pattern allows the application to send multiple}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00830}00830 \textcolor{comment}{ * requests without waiting for each response. The flow is:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00831}00831 \textcolor{comment}{ * 1. Application calls obsws\_send\_request("{}GetScenes"{}, ...) -\/> returns immediately}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00832}00832 \textcolor{comment}{ * 2. The request is created with a unique UUID and added to pending\_requests list}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00833}00833 \textcolor{comment}{ * 3. Background thread sends the request to OBS}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00834}00834 \textcolor{comment}{ * 4. Background thread waits for response (on condition variable, not busy-\/polling)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00835}00835 \textcolor{comment}{ * 5. OBS responds with REQUEST\_RESPONSE containing the requestId}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00836}00836 \textcolor{comment}{ * 6. This function matches it to the pending request}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00837}00837 \textcolor{comment}{ * 7. Function sets response-\/>success, response-\/>status\_code, response-\/>response\_data}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00838}00838 \textcolor{comment}{ * 8. Function signals the condition variable to wake the waiting thread}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00839}00839 \textcolor{comment}{ * 9. Application thread wakes up with the response ready}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00840}00840 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00841}00841 \textcolor{comment}{ * This is far more efficient than synchronous request/response because:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00842}00842 \textcolor{comment}{ * -\/ No blocking wait in the background thread}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00843}00843 \textcolor{comment}{ * -\/ Multiple requests can be in-\/flight simultaneously}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00844}00844 \textcolor{comment}{ * -\/ Doesn't freeze the application while waiting for OBS}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00845}00845 \textcolor{comment}{ * -\/ Condition variables are more efficient than polling}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00846}00846 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00847}00847 \textcolor{comment}{ * Response structure contains:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00848}00848 \textcolor{comment}{ * -\/ success: Did the operation succeed? (not the HTTP status, but "{}was it valid?"{})}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00849}00849 \textcolor{comment}{ * -\/ status\_code: The OBS response code (0 = success, >0 = error)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00850}00850 \textcolor{comment}{ * -\/ response\_data: JSON string with the actual result (e.g., scene list)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00851}00851 \textcolor{comment}{ * -\/ error\_message: If something failed, what was the reason?}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00852}00852 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00853}00853 \textcolor{comment}{ * @param conn The connection that received the response}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00854}00854 \textcolor{comment}{ * @param data The parsed JSON "{}d"{} field containing requestId, requestStatus, etc.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00855}00855 \textcolor{comment}{ * @return 0 on success, -\/1 if the response is malformed (e.g., missing requestId)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00856}00856 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00857}00857 \textcolor{comment}{ * @internal}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00858}00858 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00859}\mbox{\hyperlink{library_8c_a046a86e7ba13a054663021594755d54b}{00859}} \textcolor{keyword}{static} \textcolor{keywordtype}{int} \mbox{\hyperlink{library_8c_a046a86e7ba13a054663021594755d54b}{handle\_request\_response\_message}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, cJSON *data) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00860}00860     cJSON *request\_id = cJSON\_GetObjectItem(data, \textcolor{stringliteral}{"{}requestId"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00861}00861     \textcolor{keywordflow}{if} (!request\_id) \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00862}00862     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00863}00863     \textcolor{comment}{/* DEBUG\_MEDIUM: Show request ID being processed */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00864}00864     \mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{obsws\_debug}}(conn, \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668aa6c8d9d070b4d69beeadf605bc03eee1}{OBSWS\_DEBUG\_MEDIUM}}, \textcolor{stringliteral}{"{}Response received for request: \%s"{}}, request\_id-\/>valuestring);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00865}00865     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00866}00866     \mbox{\hyperlink{structpending__request}{pending\_request\_t}} *req = \mbox{\hyperlink{library_8c_a6f7f5f47389b537c9dce9f1b328b7f06}{find\_pending\_request}}(conn, request\_id-\/>valuestring);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00867}00867     \textcolor{keywordflow}{if} (!req) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00868}00868         \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9a7db7d387859c4786d8eb303e5bbafef7}{OBSWS\_LOG\_WARNING}}, \textcolor{stringliteral}{"{}Received response for unknown request: \%s"{}}, request\_id-\/>valuestring);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00869}00869         \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00870}00870     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00871}00871     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00872}00872     pthread\_mutex\_lock(\&req-\/>\mbox{\hyperlink{structpending__request_a30b4636ccd06e4f775ee0dcc29ba3a69}{mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00873}00873     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00874}00874     cJSON *request\_status = cJSON\_GetObjectItem(data, \textcolor{stringliteral}{"{}requestStatus"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00875}00875     \textcolor{keywordflow}{if} (request\_status) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00876}00876         cJSON *result = cJSON\_GetObjectItem(request\_status, \textcolor{stringliteral}{"{}result"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00877}00877         cJSON *code = cJSON\_GetObjectItem(request\_status, \textcolor{stringliteral}{"{}code"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00878}00878         cJSON *comment = cJSON\_GetObjectItem(request\_status, \textcolor{stringliteral}{"{}comment"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00879}00879         }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00880}00880         req-\/>\mbox{\hyperlink{structpending__request_a4b37104673cb81e3f2825c8f6df372ba}{response}}-\/>\mbox{\hyperlink{structobsws__response__t_abbf2e99faa8fdef1c94bbd174470c821}{success}} = result ? result-\/>valueint : \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00881}00881         req-\/>\mbox{\hyperlink{structpending__request_a4b37104673cb81e3f2825c8f6df372ba}{response}}-\/>\mbox{\hyperlink{structobsws__response__t_a1221f1002dd30535f6d4fdda1ba6abd0}{status\_code}} = code ? code-\/>valueint : -\/1;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00882}00882         }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00883}00883         \textcolor{keywordflow}{if} (comment) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00884}00884             req-\/>\mbox{\hyperlink{structpending__request_a4b37104673cb81e3f2825c8f6df372ba}{response}}-\/>\mbox{\hyperlink{structobsws__response__t_ab2b3055a84989889d3de28c2ccfd0dac}{error\_message}} = strdup(comment-\/>valuestring);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00885}00885         \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00886}00886     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00887}00887     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00888}00888     cJSON *response\_data = cJSON\_GetObjectItem(data, \textcolor{stringliteral}{"{}responseData"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00889}00889     \textcolor{keywordflow}{if} (response\_data) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00890}00890         req-\/>\mbox{\hyperlink{structpending__request_a4b37104673cb81e3f2825c8f6df372ba}{response}}-\/>\mbox{\hyperlink{structobsws__response__t_a696a1179e1d40c6c31136999846d5902}{response\_data}} = cJSON\_PrintUnformatted(response\_data);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00891}00891     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00892}00892     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00893}00893     req-\/>\mbox{\hyperlink{structpending__request_af74dd3c97a064175b9dcf3dbfe3665cc}{completed}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00894}00894     pthread\_cond\_broadcast(\&req-\/>\mbox{\hyperlink{structpending__request_a619500d05293ec1f654ea803139941de}{cond}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00895}00895     pthread\_mutex\_unlock(\&req-\/>\mbox{\hyperlink{structpending__request_a30b4636ccd06e4f775ee0dcc29ba3a69}{mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00896}00896     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00897}00897     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00898}00898 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00899}00899 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00900}00900 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00901}00901 \textcolor{comment}{ * @brief Route incoming WebSocket messages to appropriate handlers based on opcode.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00902}00902 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00903}00903 \textcolor{comment}{ * Every message from OBS contains an "{}op"{} field (opcode) that identifies the}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00904}00904 \textcolor{comment}{ * message type. This function:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00905}00905 \textcolor{comment}{ * 1. Parses the JSON to extract the opcode and data}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00906}00906 \textcolor{comment}{ * 2. Routes to the appropriate handler function based on the opcode}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00907}00907 \textcolor{comment}{ * 3. Updates statistics (messages\_received, bytes\_received)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00908}00908 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00909}00909 \textcolor{comment}{ * The OBS WebSocket protocol uses these opcodes:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00910}00910 \textcolor{comment}{ * -\/ HELLO (0): Server greeting with auth info -\/ handled by handle\_hello\_message}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00911}00911 \textcolor{comment}{ * -\/ IDENTIFY (1): Client auth -\/ we send this, don't receive it}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00912}00912 \textcolor{comment}{ * -\/ IDENTIFIED (2): Auth success -\/ handled by handle\_identified\_message}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00913}00913 \textcolor{comment}{ * -\/ EVENT (5): Real-\/time notifications -\/ handled by handle\_event\_message}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00914}00914 \textcolor{comment}{ * -\/ REQUEST\_RESPONSE (7): Command responses -\/ handled by handle\_request\_response\_message}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00915}00915 \textcolor{comment}{ * -\/ Other opcodes like REIDENTIFY, batch operations: not currently handled}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00916}00916 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00917}00917 \textcolor{comment}{ * This is one of the most critical functions in the library because it's in}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00918}00918 \textcolor{comment}{ * the hot path of message processing. Performance matters here. We keep it}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00919}00919 \textcolor{comment}{ * lightweight and defer heavy processing to the specific handlers.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00920}00920 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00921}00921 \textcolor{comment}{ * Error handling is conservative: malformed JSON or missing opcode doesn't}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00922}00922 \textcolor{comment}{ * crash the connection, it just logs and continues. This allows us to be}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00923}00923 \textcolor{comment}{ * resilient to protocol variations or corruption.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00924}00924 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00925}00925 \textcolor{comment}{ * @param conn The connection that received the message}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00926}00926 \textcolor{comment}{ * @param message Pointer to the raw message data (not null-\/terminated)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00927}00927 \textcolor{comment}{ * @param len Number of bytes in the message}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00928}00928 \textcolor{comment}{ * @return 0 on success, -\/1 on parse error (does not disconnect)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00929}00929 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00930}00930 \textcolor{comment}{ * @internal}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00931}00931 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00932}\mbox{\hyperlink{library_8c_a0672da971c7e38224df11c34ef612f02}{00932}} \textcolor{keyword}{static} \textcolor{keywordtype}{int} \mbox{\hyperlink{library_8c_a0672da971c7e38224df11c34ef612f02}{handle\_websocket\_message}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *message, \textcolor{keywordtype}{size\_t} len) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00933}00933     \textcolor{comment}{/* DEBUG\_HIGH: Show full message content */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00934}00934     \mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{obsws\_debug}}(conn, \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668aceb0431d743cdecf0848564f388d51bd}{OBSWS\_DEBUG\_HIGH}}, \textcolor{stringliteral}{"{}Received message (\%zu bytes): \%.*s"{}}, len, (\textcolor{keywordtype}{int})len, message);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00935}00935     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00936}00936     cJSON *json = cJSON\_ParseWithLength(message, len);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00937}00937     \textcolor{keywordflow}{if} (!json) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00938}00938         \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9a6a2a374e4af0446011df30bfd09e329e}{OBSWS\_LOG\_ERROR}}, \textcolor{stringliteral}{"{}Failed to parse JSON message"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00939}00939         \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00940}00940     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00941}00941     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00942}00942     cJSON *op = cJSON\_GetObjectItem(json, \textcolor{stringliteral}{"{}op"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00943}00943     cJSON *data = cJSON\_GetObjectItem(json, \textcolor{stringliteral}{"{}d"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00944}00944     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00945}00945     \textcolor{keywordflow}{if} (!op) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00946}00946         \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9a6a2a374e4af0446011df30bfd09e329e}{OBSWS\_LOG\_ERROR}}, \textcolor{stringliteral}{"{}Message missing 'op' field"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00947}00947         cJSON\_Delete(json);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00948}00948         \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00949}00949     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00950}00950     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00951}00951     \textcolor{comment}{/* DEBUG\_MEDIUM: Show opcode being processed */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00952}00952     \mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{obsws\_debug}}(conn, \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668aa6c8d9d070b4d69beeadf605bc03eee1}{OBSWS\_DEBUG\_MEDIUM}}, \textcolor{stringliteral}{"{}Processing opcode: \%d"{}}, op-\/>valueint);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00953}00953     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00954}00954     \textcolor{keywordtype}{int} result = 0;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00955}00955     \textcolor{keywordflow}{switch} (op-\/>valueint) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00956}00956         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8c_a28228f50fc25972b87ebb3c5ca36104a}{OBSWS\_OPCODE\_HELLO}}:}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00957}00957             result = \mbox{\hyperlink{library_8c_af183411517ec69b1d59f875fbb0245bd}{handle\_hello\_message}}(conn, data);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00958}00958             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00959}00959         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8c_a35815ef87e52f4956dcc02be7a3a7d95}{OBSWS\_OPCODE\_IDENTIFIED}}:}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00960}00960             result = \mbox{\hyperlink{library_8c_aad4174fe2c4665d21ae49896fc25be9e}{handle\_identified\_message}}(conn, data);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00961}00961             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00962}00962         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8c_a60741575bd0daca62cfc088a7d3908c6}{OBSWS\_OPCODE\_EVENT}}:}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00963}00963             result = \mbox{\hyperlink{library_8c_ac7c18bfa245d7a8582c6e5536cf46532}{handle\_event\_message}}(conn, data);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00964}00964             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00965}00965         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8c_ae6ce9e236045c545c7786292abb8bed2}{OBSWS\_OPCODE\_REQUEST\_RESPONSE}}:}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00966}00966             result = \mbox{\hyperlink{library_8c_a046a86e7ba13a054663021594755d54b}{handle\_request\_response\_message}}(conn, data);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00967}00967             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00968}00968         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00969}00969             \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9aa69cfac4b3acbd5968bfab9ef5759cd2}{OBSWS\_LOG\_DEBUG}}, \textcolor{stringliteral}{"{}Unhandled opcode: \%d"{}}, op-\/>valueint);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00970}00970             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00971}00971     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00972}00972     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00973}00973     cJSON\_Delete(json);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00974}00974     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00975}00975     pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_ab29e2a357e95b536a2c79b0990614bc5}{stats\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00976}00976     conn-\/>\mbox{\hyperlink{structobsws__connection_a10b9da03b3a1cb3a6ee0e72387915740}{stats}}.\mbox{\hyperlink{structobsws__stats__t_acbd2023849f8049c705c4cbff567119b}{messages\_received}}++;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00977}00977     conn-\/>\mbox{\hyperlink{structobsws__connection_a10b9da03b3a1cb3a6ee0e72387915740}{stats}}.\mbox{\hyperlink{structobsws__stats__t_ae29f4f06b24960c6802aefd3f1627b4f}{bytes\_received}} += len;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00978}00978     pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_ab29e2a357e95b536a2c79b0990614bc5}{stats\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00979}00979     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00980}00980     \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00981}00981 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00982}00982 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l00983}00983 \textcolor{comment}{/* ============================================================================}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00984}00984 \textcolor{comment}{ * libwebsockets Callbacks}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00985}00985 \textcolor{comment}{ * ============================================================================ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00986}00986 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00987}00987 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00988}00988 \textcolor{comment}{ * @brief libwebsockets callback -\/ routes WebSocket events to our handlers.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00989}00989 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00990}00990 \textcolor{comment}{ * libwebsockets is an event-\/driven WebSocket library. It calls this callback}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00991}00991 \textcolor{comment}{ * function whenever something happens (connection established, data received,}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00992}00992 \textcolor{comment}{ * connection closed, etc.). The "{}reason"{} parameter identifies what happened.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00993}00993 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00994}00994 \textcolor{comment}{ * We handle these key reasons:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00995}00995 \textcolor{comment}{ * -\/ LWS\_CALLBACK\_CLIENT\_ESTABLISHED: TCP/WebSocket handshake complete, ready for messages}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00996}00996 \textcolor{comment}{ * -\/ LWS\_CALLBACK\_CLIENT\_RECEIVE: Data arrived from OBS}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00997}00997 \textcolor{comment}{ * -\/ LWS\_CALLBACK\_CLIENT\_WRITEABLE: Socket is writable (less common with our design)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00998}00998 \textcolor{comment}{ * -\/ LWS\_CALLBACK\_CLIENT\_CONNECTION\_ERROR: Connection failed (network error, bad host, etc.)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l00999}00999 \textcolor{comment}{ * -\/ LWS\_CALLBACK\_CLIENT\_CLOSED: Connection closed normally}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01000}01000 \textcolor{comment}{ * -\/ LWS\_CALLBACK\_WSI\_DESTROY: Cleanup callback}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01001}01001 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01002}01002 \textcolor{comment}{ * Important: This callback is called from the background event\_thread, not}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01003}01003 \textcolor{comment}{ * the main application thread. So it must be thread-\/safe and not block.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01004}01004 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01005}01005 \textcolor{comment}{ * Message assembly: OBS WebSocket messages might arrive fragmented (multiple}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01006}01006 \textcolor{comment}{ * packets). We accumulate them in recv\_buffer and check lws\_is\_final\_fragment()}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01007}01007 \textcolor{comment}{ * to know when a complete message has arrived. Only then do we parse it.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01008}01008 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01009}01009 \textcolor{comment}{ * Error handling: Connection errors and receive buffer overflows are logged}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01010}01010 \textcolor{comment}{ * but don't crash. We just transition to ERROR state and let the connection}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01011}01011 \textcolor{comment}{ * cleanup/reconnection logic handle recovery.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01012}01012 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01013}01013 \textcolor{comment}{ * @param wsi The WebSocket instance (provided by libwebsockets)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01014}01014 \textcolor{comment}{ * @param reason The callback reason (LWS\_CALLBACK\_*)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01015}01015 \textcolor{comment}{ * @param user Our connection pointer (registered at context creation)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01016}01016 \textcolor{comment}{ * @param in Incoming data (for LWS\_CALLBACK\_CLIENT\_RECEIVE)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01017}01017 \textcolor{comment}{ * @param len Size of incoming data}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01018}01018 \textcolor{comment}{ * @return 0 for success, -\/1 for error (affects connection handling)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01019}01019 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01020}01020 \textcolor{comment}{ * @internal}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01021}01021 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01022}\mbox{\hyperlink{library_8c_ac5c31c457dc3042f85a620d7998ebeee}{01022}} \textcolor{keyword}{static} \textcolor{keywordtype}{int} \mbox{\hyperlink{library_8c_ac5c31c457dc3042f85a620d7998ebeee}{lws\_callback}}(\textcolor{keyword}{struct} lws *wsi, \textcolor{keyword}{enum} lws\_callback\_reasons reason,}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01023}01023                        \textcolor{keywordtype}{void} *user, \textcolor{keywordtype}{void} *in, \textcolor{keywordtype}{size\_t} len) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01024}01024     \mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn = (\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *)user;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01025}01025     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01026}01026     \textcolor{keywordflow}{switch} (reason) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01027}01027         \textcolor{keywordflow}{case} LWS\_CALLBACK\_CLIENT\_ESTABLISHED:}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01028}01028             \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9ae48017bf78390a3df8cd87a24782c421}{OBSWS\_LOG\_INFO}}, \textcolor{stringliteral}{"{}WebSocket connection established"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01029}01029             \mbox{\hyperlink{library_8c_a2f13308e49322d01e479cbe14da7b575}{set\_connection\_state}}(conn, \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991a88276a1a9f595735a2b242f0eab1524a}{OBSWS\_STATE\_CONNECTING}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01030}01030             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01031}01031             }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01032}01032         \textcolor{keywordflow}{case} LWS\_CALLBACK\_CLIENT\_RECEIVE:}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01033}01033             \textcolor{keywordflow}{if} (conn-\/>\mbox{\hyperlink{structobsws__connection_a74838edd16f7d8d3d75c772f85d9f7df}{recv\_buffer\_used}} + len < conn-\/>recv\_buffer\_size) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01034}01034                 memcpy(conn-\/>\mbox{\hyperlink{structobsws__connection_a89f2bbc96729ab308290da8959534d18}{recv\_buffer}} + conn-\/>\mbox{\hyperlink{structobsws__connection_a74838edd16f7d8d3d75c772f85d9f7df}{recv\_buffer\_used}}, in, len);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01035}01035                 conn-\/>\mbox{\hyperlink{structobsws__connection_a74838edd16f7d8d3d75c772f85d9f7df}{recv\_buffer\_used}} += len;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01036}01036                 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01037}01037                 \textcolor{keywordflow}{if} (lws\_is\_final\_fragment(wsi)) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01038}01038                     \mbox{\hyperlink{library_8c_a0672da971c7e38224df11c34ef612f02}{handle\_websocket\_message}}(conn, conn-\/>\mbox{\hyperlink{structobsws__connection_a89f2bbc96729ab308290da8959534d18}{recv\_buffer}}, conn-\/>\mbox{\hyperlink{structobsws__connection_a74838edd16f7d8d3d75c772f85d9f7df}{recv\_buffer\_used}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01039}01039                     conn-\/>\mbox{\hyperlink{structobsws__connection_a74838edd16f7d8d3d75c772f85d9f7df}{recv\_buffer\_used}} = 0;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01040}01040                 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01041}01041             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01042}01042                 \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9a6a2a374e4af0446011df30bfd09e329e}{OBSWS\_LOG\_ERROR}}, \textcolor{stringliteral}{"{}Receive buffer overflow"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01043}01043                 conn-\/>\mbox{\hyperlink{structobsws__connection_a74838edd16f7d8d3d75c772f85d9f7df}{recv\_buffer\_used}} = 0;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01044}01044             \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01045}01045             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01046}01046             }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01047}01047         \textcolor{keywordflow}{case} LWS\_CALLBACK\_CLIENT\_WRITEABLE:}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01048}01048             \textcolor{comment}{/* Handle queued sends if needed */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01049}01049             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01050}01050             }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01051}01051         \textcolor{keywordflow}{case} LWS\_CALLBACK\_CLIENT\_CONNECTION\_ERROR:}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01052}01052             \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9a6a2a374e4af0446011df30bfd09e329e}{OBSWS\_LOG\_ERROR}}, \textcolor{stringliteral}{"{}Connection error: \%s"{}}, in ? (\textcolor{keywordtype}{char} *)in : \textcolor{stringliteral}{"{}unknown"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01053}01053             \mbox{\hyperlink{library_8c_a2f13308e49322d01e479cbe14da7b575}{set\_connection\_state}}(conn, \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991ae13bce21841139a7510b1c8b10a694ac}{OBSWS\_STATE\_ERROR}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01054}01054             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01055}01055             }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01056}01056         \textcolor{keywordflow}{case} LWS\_CALLBACK\_CLIENT\_CLOSED:}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01057}01057             \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9ae48017bf78390a3df8cd87a24782c421}{OBSWS\_LOG\_INFO}}, \textcolor{stringliteral}{"{}WebSocket connection closed (reason in 'in' param)"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01058}01058             \textcolor{keywordflow}{if} (in \&\& len > 0) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01059}01059                 \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9ae48017bf78390a3df8cd87a24782c421}{OBSWS\_LOG\_INFO}}, \textcolor{stringliteral}{"{}Close reason: \%.*s"{}}, (\textcolor{keywordtype}{int})len, (\textcolor{keywordtype}{char}*)in);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01060}01060             \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01061}01061             \mbox{\hyperlink{library_8c_a2f13308e49322d01e479cbe14da7b575}{set\_connection\_state}}(conn, \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991af973d2b8b0a498d0bbffb40ccab1ef2d}{OBSWS\_STATE\_DISCONNECTED}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01062}01062             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01063}01063             }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01064}01064         \textcolor{keywordflow}{case} LWS\_CALLBACK\_WSI\_DESTROY:}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01065}01065             conn-\/>\mbox{\hyperlink{structobsws__connection_aaf49ac1578fc794ee4b01ccbf9edc35a}{wsi}} = NULL;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01066}01066             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01067}01067             }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01068}01068         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01069}01069             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01070}01070     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01071}01071     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01072}01072     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01073}01073 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01074}01074 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01075}\mbox{\hyperlink{library_8c_ad34f3c7a416fe0d9311efdc5715410e1}{01075}} \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keyword}{struct }lws\_protocols \mbox{\hyperlink{library_8c_ad34f3c7a416fe0d9311efdc5715410e1}{protocols}}[] = \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01076}01076     \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01077}01077         \textcolor{stringliteral}{"{}obs-\/websocket"{}},}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01078}01078         \mbox{\hyperlink{library_8c_ac5c31c457dc3042f85a620d7998ebeee}{lws\_callback}},}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01079}01079         0,}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01080}01080         \mbox{\hyperlink{library_8c_a665c5272405e81329a26d2db1a7d5d97}{OBSWS\_DEFAULT\_BUFFER\_SIZE}},}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01081}01081         0, \textcolor{comment}{/* id */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01082}01082         NULL, \textcolor{comment}{/* user */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01083}01083         0 \textcolor{comment}{/* tx\_packet\_size */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01084}01084     \},}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01085}01085     \{ NULL, NULL, 0, 0, 0, NULL, 0 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01086}01086 \};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01087}01087 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01088}01088 \textcolor{comment}{/* ============================================================================}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01089}01089 \textcolor{comment}{ * Event Thread}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01090}01090 \textcolor{comment}{ * ============================================================================ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01091}01091 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01092}01092 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01093}01093 \textcolor{comment}{ * @brief Background thread function that continuously processes WebSocket events.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01094}01094 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01095}01095 \textcolor{comment}{ * Each connection has one background thread dedicated to processing WebSocket}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01096}01096 \textcolor{comment}{ * messages and timers. The main application thread remains free to make requests}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01097}01097 \textcolor{comment}{ * and do application work without blocking.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01098}01098 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01099}01099 \textcolor{comment}{ * This thread:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01100}01100 \textcolor{comment}{ * 1. Calls lws\_service() to pump the libwebsockets event loop (typically blocks}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01101}01101 \textcolor{comment}{ *    for 50ms waiting for events, then processes them and returns)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01102}01102 \textcolor{comment}{ * 2. Periodically cleans up old/timed-\/out requests}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01103}01103 \textcolor{comment}{ * 3. Sends keep-\/alive pings if configured (to detect dead connections)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01104}01104 \textcolor{comment}{ * 4. Exits gracefully when should\_exit flag is set}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01105}01105 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01106}01106 \textcolor{comment}{ * Lifetime: This thread is created in obsws\_connect() and destroyed in}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01107}01107 \textcolor{comment}{ * obsws\_disconnect() using pthread\_join(). The should\_exit flag is used to}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01108}01108 \textcolor{comment}{ * signal the thread to stop, which it checks at the start of each loop.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01109}01109 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01110}01110 \textcolor{comment}{ * The lws\_service() call is the core of this loop. It:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01111}01111 \textcolor{comment}{ * -\/ Waits up to 50ms for data from the network using select/poll}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01112}01112 \textcolor{comment}{ * -\/ If data arrives, invokes lws\_callback to notify us}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01113}01113 \textcolor{comment}{ * -\/ Returns after \string~50ms even if no data (so we stay responsive to should\_exit)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01114}01114 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01115}01115 \textcolor{comment}{ * This asynchronous design has several advantages:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01116}01116 \textcolor{comment}{ * -\/ App thread isn't blocked waiting for responses}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01117}01117 \textcolor{comment}{ * -\/ Multiple requests can be in-\/flight simultaneously}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01118}01118 \textcolor{comment}{ * -\/ Events can be delivered to callbacks instantly (no polling delay)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01119}01119 \textcolor{comment}{ * -\/ Automatic keep-\/alive pings keep the connection alive through firewalls}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01120}01120 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01121}01121 \textcolor{comment}{ * Memory note: Callbacks invoked from this thread have access to the same}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01122}01122 \textcolor{comment}{ * connection object as the main thread, hence all the mutexes protecting}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01123}01123 \textcolor{comment}{ * critical sections. The pending\_request\_t condition variables synchronize}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01124}01124 \textcolor{comment}{ * request responses between this thread and application threads.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01125}01125 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01126}01126 \textcolor{comment}{ * @param arg The obsws\_connection\_t* that this thread services}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01127}01127 \textcolor{comment}{ * @return Always NULL (threads don't return values)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01128}01128 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01129}01129 \textcolor{comment}{ * @internal}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01130}01130 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01131}\mbox{\hyperlink{library_8c_a27739efcea1287611c82ff3e8c88d7b7}{01131}} \textcolor{keyword}{static} \textcolor{keywordtype}{void}* \mbox{\hyperlink{library_8c_a27739efcea1287611c82ff3e8c88d7b7}{event\_thread\_func}}(\textcolor{keywordtype}{void} *arg) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01132}01132     \mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn = (\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *)arg;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01133}01133     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01134}01134     \textcolor{keywordtype}{bool} should\_continue = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01135}01135     \textcolor{keywordflow}{while} (should\_continue) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01136}01136         \textcolor{comment}{/* Check exit flag with mutex protection */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01137}01137         pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_aa2752abaf5b201277fae73b42c78c8e6}{state\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01138}01138         should\_continue = !conn-\/>\mbox{\hyperlink{structobsws__connection_a6aa5a0ce7b42fc1cd72385181ca43454}{should\_exit}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01139}01139         pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_aa2752abaf5b201277fae73b42c78c8e6}{state\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01140}01140         }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01141}01141         \textcolor{keywordflow}{if} (!should\_continue) \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01142}01142         }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01143}01143         \textcolor{keywordflow}{if} (conn-\/>\mbox{\hyperlink{structobsws__connection_a2f876a0ab0ad0e5e012444a806aa3490}{lws\_context}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01144}01144             lws\_service(conn-\/>\mbox{\hyperlink{structobsws__connection_a2f876a0ab0ad0e5e012444a806aa3490}{lws\_context}}, 50);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01145}01145             }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01146}01146             \textcolor{comment}{/* Cleanup old requests periodically */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01147}01147             \mbox{\hyperlink{library_8c_a885f22656ee8ca3170a50df0e0d85a4d}{cleanup\_old\_requests}}(conn);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01148}01148             }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01149}01149             \textcolor{comment}{/* Handle keep-\/alive pings */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01150}01150             \textcolor{keywordflow}{if} (conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a74ee702373489ff1ea1289e87d50e469}{ping\_interval\_ms}} > 0 \&\& conn-\/>\mbox{\hyperlink{structobsws__connection_adad7d0fb4880543b1f5b5e897010d814}{state}} == \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991adbaae08035175b470fb9f543414672b8}{OBSWS\_STATE\_CONNECTED}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01151}01151                 time\_t now = time(NULL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01152}01152                 \textcolor{keywordflow}{if} (now -\/ conn-\/>\mbox{\hyperlink{structobsws__connection_a940373a69db859ebc424eb555c86a24c}{last\_ping\_sent}} >= conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a74ee702373489ff1ea1289e87d50e469}{ping\_interval\_ms}} / 1000) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01153}01153                     \textcolor{keywordflow}{if} (conn-\/>\mbox{\hyperlink{structobsws__connection_aaf49ac1578fc794ee4b01ccbf9edc35a}{wsi}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01154}01154                         lws\_callback\_on\_writable(conn-\/>\mbox{\hyperlink{structobsws__connection_aaf49ac1578fc794ee4b01ccbf9edc35a}{wsi}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01155}01155                     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01156}01156                     conn-\/>\mbox{\hyperlink{structobsws__connection_a940373a69db859ebc424eb555c86a24c}{last\_ping\_sent}} = now;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01157}01157                 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01158}01158             \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01159}01159         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01160}01160             \textcolor{keyword}{struct }timespec ts = \{0, 50000000\};  \textcolor{comment}{/* 50ms = 50,000,000 nanoseconds */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01161}01161             nanosleep(\&ts, NULL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01162}01162         \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01163}01163     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01164}01164     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01165}01165     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01166}01166 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01167}01167 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01168}01168 \textcolor{comment}{/* ============================================================================}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01169}01169 \textcolor{comment}{ * Public API Implementation}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01170}01170 \textcolor{comment}{ * ============================================================================ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01171}01171 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01172}01172 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01173}01173 \textcolor{comment}{ * @brief Initialize the libwsv5 library.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01174}01174 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01175}01175 \textcolor{comment}{ * This function must be called before creating any connections. It:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01176}01176 \textcolor{comment}{ * 1. Initializes OpenSSL (EVP library for hashing)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01177}01177 \textcolor{comment}{ * 2. Seeds the random number generator for UUID generation}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01178}01178 \textcolor{comment}{ * 3. Sets the global g\_library\_initialized flag}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01179}01179 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01180}01180 \textcolor{comment}{ * Thread safety: This function is thread-\/safe. Multiple threads can call it}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01181}01181 \textcolor{comment}{ * simultaneously, and only one will actually do the initialization (protected}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01182}01182 \textcolor{comment}{ * by g\_init\_mutex). Subsequent calls are no-\/ops.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01183}01183 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01184}01184 \textcolor{comment}{ * Note: obsws\_connect() will call this automatically if you forget, so you}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01185}01185 \textcolor{comment}{ * don't *have* to call it explicitly. But doing so allows you to initialize}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01186}01186 \textcolor{comment}{ * in a controlled way, separate from connection creation.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01187}01187 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01188}01188 \textcolor{comment}{ * Cleanup: When you're done with the library, call obsws\_cleanup() to}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01189}01189 \textcolor{comment}{ * deallocate resources. This is technically optional on program exit (the OS}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01190}01190 \textcolor{comment}{ * cleans up anyway), but good practice for testing and library shutdown.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01191}01191 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01192}01192 \textcolor{comment}{ * @return OBSWS\_OK always (initialization cannot fail in the current design)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01193}01193 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01194}01194 \textcolor{comment}{ * @see obsws\_cleanup, obsws\_connect}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01195}01195 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01196}\mbox{\hyperlink{library_8h_aff3d6c035330741df84552800c0d0124}{01196}} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6}{obsws\_error\_t}} \mbox{\hyperlink{library_8c_aff3d6c035330741df84552800c0d0124}{obsws\_init}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01197}01197     pthread\_mutex\_lock(\&\mbox{\hyperlink{library_8c_ad5f633670e2eea3285c1867570a33cbc}{g\_init\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01198}01198     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01199}01199     \textcolor{keywordflow}{if} (\mbox{\hyperlink{library_8c_a5c573cf80a65ed908b966420c4a5d7d2}{g\_library\_initialized}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01200}01200         pthread\_mutex\_unlock(\&\mbox{\hyperlink{library_8c_ad5f633670e2eea3285c1867570a33cbc}{g\_init\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01201}01201         \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6aa43b9a59f39db094a477cb25a638e5a1}{OBSWS\_OK}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01202}01202     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01203}01203     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01204}01204     \textcolor{comment}{/* Initialize OpenSSL */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01205}01205     OpenSSL\_add\_all\_algorithms();}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01206}01206     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01207}01207     \textcolor{comment}{/* Seed random number generator */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01208}01208     srand(time(NULL));}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01209}01209     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01210}01210     \mbox{\hyperlink{library_8c_a5c573cf80a65ed908b966420c4a5d7d2}{g\_library\_initialized}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01211}01211     pthread\_mutex\_unlock(\&\mbox{\hyperlink{library_8c_ad5f633670e2eea3285c1867570a33cbc}{g\_init\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01212}01212     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01213}01213     \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6aa43b9a59f39db094a477cb25a638e5a1}{OBSWS\_OK}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01214}01214 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01215}01215 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01216}01216 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01217}01217 \textcolor{comment}{ * @brief Clean up library resources.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01218}01218 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01219}01219 \textcolor{comment}{ * Call this when you're done with the library to deallocate OpenSSL resources.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01220}01220 \textcolor{comment}{ * This is a counterpart to obsws\_init().}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01221}01221 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01222}01222 \textcolor{comment}{ * Important: Make sure all obsws\_connection\_t objects have been disconnected}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01223}01223 \textcolor{comment}{ * and freed via obsws\_disconnect() before calling this. If not, you might have}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01224}01224 \textcolor{comment}{ * dangling references and resource leaks.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01225}01225 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01226}01226 \textcolor{comment}{ * Thread safety: This function is thread-\/safe and idempotent (safe to call}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01227}01227 \textcolor{comment}{ * multiple times). It checks g\_library\_initialized before doing anything.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01228}01228 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01229}01229 \textcolor{comment}{ * Note: This is optional on program exit because the OS will clean up memory}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01230}01230 \textcolor{comment}{ * anyway. But it's good practice for:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01231}01231 \textcolor{comment}{ * -\/ Library consumers that need clean shutdown}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01232}01232 \textcolor{comment}{ * -\/ Memory leak detectors / Valgrind tests}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01233}01233 \textcolor{comment}{ * -\/ Programs that unload the library}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01234}01234 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01235}01235 \textcolor{comment}{ * @see obsws\_init}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01236}01236 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01237}\mbox{\hyperlink{library_8h_ad3afe1c77e8b8f26a8281186379790a1}{01237}} \textcolor{keywordtype}{void} \mbox{\hyperlink{library_8c_ad3afe1c77e8b8f26a8281186379790a1}{obsws\_cleanup}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01238}01238     pthread\_mutex\_lock(\&\mbox{\hyperlink{library_8c_ad5f633670e2eea3285c1867570a33cbc}{g\_init\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01239}01239     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01240}01240     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{library_8c_a5c573cf80a65ed908b966420c4a5d7d2}{g\_library\_initialized}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01241}01241         pthread\_mutex\_unlock(\&\mbox{\hyperlink{library_8c_ad5f633670e2eea3285c1867570a33cbc}{g\_init\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01242}01242         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01243}01243     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01244}01244     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01245}01245     EVP\_cleanup();}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01246}01246     \mbox{\hyperlink{library_8c_a5c573cf80a65ed908b966420c4a5d7d2}{g\_library\_initialized}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01247}01247     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01248}01248     pthread\_mutex\_unlock(\&\mbox{\hyperlink{library_8c_ad5f633670e2eea3285c1867570a33cbc}{g\_init\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01249}01249 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01250}01250 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01251}01251 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01252}01252 \textcolor{comment}{ * @brief Get the library version string.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01253}01253 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01254}01254 \textcolor{comment}{ * Returns a semantic version string like "{}1.0.0"{} that identifies which}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01255}01255 \textcolor{comment}{ * version of libwsv5 is being used. Useful for debugging and logging.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01256}01256 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01257}01257 \textcolor{comment}{ * @return Pointer to static version string (don't free)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01258}01258 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01259}\mbox{\hyperlink{library_8h_af3afc203f99395c187faf3fba0477bf9}{01259}} \textcolor{keyword}{const} \textcolor{keywordtype}{char}* \mbox{\hyperlink{library_8c_af3afc203f99395c187faf3fba0477bf9}{obsws\_version}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01260}01260     \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8c_ad27c3919151c76f6e69c502c7ece4065}{OBSWS\_VERSION}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01261}01261 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01262}01262 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01263}01263 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01264}01264 \textcolor{comment}{ * @brief Set the global log level threshold.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01265}01265 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01266}01266 \textcolor{comment}{ * The library logs various messages during operation. This function sets which}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01267}01267 \textcolor{comment}{ * messages are displayed. All messages at the specified level and higher}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01268}01268 \textcolor{comment}{ * severity are shown; lower severity messages are hidden.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01269}01269 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01270}01270 \textcolor{comment}{ * Levels in increasing severity:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01271}01271 \textcolor{comment}{ * -\/ OBSWS\_LOG\_DEBUG: Low-\/level diagnostic info (too verbose for production)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01272}01272 \textcolor{comment}{ * -\/ OBSWS\_LOG\_INFO: General informational messages (usual choice)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01273}01273 \textcolor{comment}{ * -\/ OBSWS\_LOG\_WARNING: Potentially problematic situations (degraded but working)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01274}01274 \textcolor{comment}{ * -\/ OBSWS\_LOG\_ERROR: Error conditions that need attention}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01275}01275 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01276}01276 \textcolor{comment}{ * Example: If you call obsws\_set\_log\_level(OBSWS\_LOG\_WARNING), you'll see}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01277}01277 \textcolor{comment}{ * only WARNING and ERROR messages, but not INFO or DEBUG messages.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01278}01278 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01279}01279 \textcolor{comment}{ * Thread safety: This modifies a global variable without locking, so if you}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01280}01280 \textcolor{comment}{ * might call this from multiple threads, use synchronization externally.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01281}01281 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01282}01282 \textcolor{comment}{ * @param level The minimum severity level to display}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01283}01283 \textcolor{comment}{ * @see obsws\_set\_debug\_level}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01284}01284 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01285}\mbox{\hyperlink{library_8h_a6720460e577d2afe3c0691a2d6e055e9}{01285}} \textcolor{keywordtype}{void} \mbox{\hyperlink{library_8c_a6720460e577d2afe3c0691a2d6e055e9}{obsws\_set\_log\_level}}(\mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9}{obsws\_log\_level\_t}} level) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01286}01286     \mbox{\hyperlink{library_8c_abaccf3944be55af2f72ebbb713c77706}{g\_log\_level}} = level;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01287}01287 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01288}01288 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01289}01289 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01290}01290 \textcolor{comment}{ * @brief Set the global debug level.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01291}01291 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01292}01292 \textcolor{comment}{ * Debug logging is separate from regular logging. It provides extremely}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01293}01293 \textcolor{comment}{ * detailed trace information about the WebSocket protocol, message parsing,}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01294}01294 \textcolor{comment}{ * authentication, etc. This is useful during development and troubleshooting.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01295}01295 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01296}01296 \textcolor{comment}{ * Debug levels:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01297}01297 \textcolor{comment}{ * -\/ OBSWS\_DEBUG\_NONE: No debug output (fastest)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01298}01298 \textcolor{comment}{ * -\/ OBSWS\_DEBUG\_LOW: Major state transitions and connection events}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01299}01299 \textcolor{comment}{ * -\/ OBSWS\_DEBUG\_MEDIUM: Message types and handlers invoked}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01300}01300 \textcolor{comment}{ * -\/ OBSWS\_DEBUG\_HIGH: Full message content and every operation}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01301}01301 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01302}01302 \textcolor{comment}{ * Debug logging is independent of log level. You can have OBSWS\_LOG\_ERROR}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01303}01303 \textcolor{comment}{ * set (hide non-\/error logs) but still see OBSWS\_DEBUG\_HIGH output.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01304}01304 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01305}01305 \textcolor{comment}{ * Performance warning: OBSWS\_DEBUG\_HIGH produces enormous output and will}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01306}01306 \textcolor{comment}{ * slow down the library significantly. Only use during debugging!}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01307}01307 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01308}01308 \textcolor{comment}{ * Thread safety: Same as obsws\_set\_log\_level (modifies global without locking).}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01309}01309 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01310}01310 \textcolor{comment}{ * @param level The debug verbosity level}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01311}01311 \textcolor{comment}{ * @see obsws\_set\_log\_level, obsws\_get\_debug\_level}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01312}01312 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01313}\mbox{\hyperlink{library_8h_adde8bcb270d34f560ae99047e0524a1d}{01313}} \textcolor{keywordtype}{void} \mbox{\hyperlink{library_8c_adde8bcb270d34f560ae99047e0524a1d}{obsws\_set\_debug\_level}}(\mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668}{obsws\_debug\_level\_t}} level) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01314}01314     \mbox{\hyperlink{library_8c_abf3a9f2c8c4082f1e6b67daddd8a5931}{g\_debug\_level}} = level;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01315}01315 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01316}01316 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01317}01317 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01318}01318 \textcolor{comment}{ * @brief Get the current debug level.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01319}01319 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01320}01320 \textcolor{comment}{ * This is a read-\/only query -\/ it doesn't change anything, just returns the}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01321}01321 \textcolor{comment}{ * current global debug level that was set by obsws\_set\_debug\_level().}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01322}01322 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01323}01323 \textcolor{comment}{ * Useful for conditional logging in your application, e.g.:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01324}01324 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01325}01325 \textcolor{comment}{ * if (obsws\_get\_debug\_level() >= OBSWS\_DEBUG\_MEDIUM) \{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01326}01326 \textcolor{comment}{ *     // do expensive trace operation}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01327}01327 \textcolor{comment}{ * \}}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01328}01328 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01329}01329 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01330}01330 \textcolor{comment}{ * @return The currently active debug level}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01331}01331 \textcolor{comment}{ * @see obsws\_set\_debug\_level}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01332}01332 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01333}\mbox{\hyperlink{library_8h_a17d68299d8070c22f5cb04e2c4af28a1}{01333}} \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668}{obsws\_debug\_level\_t}} \mbox{\hyperlink{library_8c_a17d68299d8070c22f5cb04e2c4af28a1}{obsws\_get\_debug\_level}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01334}01334     \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8c_abf3a9f2c8c4082f1e6b67daddd8a5931}{g\_debug\_level}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01335}01335 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01336}01336 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01337}01337 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01338}01338 \textcolor{comment}{ * @brief Initialize a connection configuration structure with safe defaults.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01339}01339 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01340}01340 \textcolor{comment}{ * Before calling obsws\_connect(), you create an obsws\_config\_t structure}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01341}01341 \textcolor{comment}{ * with the connection parameters. This function initializes that structure}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01342}01342 \textcolor{comment}{ * with sensible defaults so you only need to change what's different for}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01343}01343 \textcolor{comment}{ * your use case.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01344}01344 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01345}01345 \textcolor{comment}{ * Default values set:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01346}01346 \textcolor{comment}{ * -\/ port: 4455 (OBS WebSocket v5 default port)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01347}01347 \textcolor{comment}{ * -\/ use\_ssl: false (OBS uses ws://, not wss://)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01348}01348 \textcolor{comment}{ * -\/ connect\_timeout\_ms: 5000 (5 seconds to connect)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01349}01349 \textcolor{comment}{ * -\/ recv\_timeout\_ms: 5000 (5 seconds to receive each message)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01350}01350 \textcolor{comment}{ * -\/ send\_timeout\_ms: 5000 (5 seconds to send each message)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01351}01351 \textcolor{comment}{ * -\/ ping\_interval\_ms: 10000 (send ping every 10 seconds)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01352}01352 \textcolor{comment}{ * -\/ ping\_timeout\_ms: 5000 (expect pong within 5 seconds)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01353}01353 \textcolor{comment}{ * -\/ auto\_reconnect: true (reconnect automatically if connection drops)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01354}01354 \textcolor{comment}{ * -\/ reconnect\_delay\_ms: 1000 (start with 1 second delay)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01355}01355 \textcolor{comment}{ * -\/ max\_reconnect\_delay\_ms: 30000 (max wait is 30 seconds)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01356}01356 \textcolor{comment}{ * -\/ max\_reconnect\_attempts: 0 (infinite attempts)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01357}01357 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01358}01358 \textcolor{comment}{ * After calling this, you typically set:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01359}01359 \textcolor{comment}{ * -\/ config.host = "{}localhost"{} (where OBS is running)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01360}01360 \textcolor{comment}{ * -\/ config.password = "{}your\_password"{} (if OBS has auth enabled)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01361}01361 \textcolor{comment}{ * -\/ config.event\_callback = your\_callback\_func (to receive events)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01362}01362 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01363}01363 \textcolor{comment}{ * @param config Pointer to structure to initialize (must not be NULL)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01364}01364 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01365}01365 \textcolor{comment}{ * @see obsws\_connect}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01366}01366 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01367}\mbox{\hyperlink{library_8h_a1f1c69172bbf706ac225b718797d30c6}{01367}} \textcolor{keywordtype}{void} \mbox{\hyperlink{library_8c_a1f1c69172bbf706ac225b718797d30c6}{obsws\_config\_init}}(\mbox{\hyperlink{structobsws__config__t}{obsws\_config\_t}} *config) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01368}01368     memset(config, 0, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structobsws__config__t}{obsws\_config\_t}}));}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01369}01369     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01370}01370     config-\/>\mbox{\hyperlink{structobsws__config__t_a7355cf2fb949f6d4391b6c2c605c9073}{port}} = 4455;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01371}01371     config-\/>\mbox{\hyperlink{structobsws__config__t_a1070992d75f19a3fd4567754d37b9290}{use\_ssl}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01372}01372     config-\/>\mbox{\hyperlink{structobsws__config__t_ab7ca748ce58419a7c8b6b6dc440d3387}{connect\_timeout\_ms}} = 5000;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01373}01373     config-\/>\mbox{\hyperlink{structobsws__config__t_a6439a4274026273ba5fb9786c90daa93}{recv\_timeout\_ms}} = 5000;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01374}01374     config-\/>\mbox{\hyperlink{structobsws__config__t_a5e99af1526aaa66f76b71c3948b5b294}{send\_timeout\_ms}} = 5000;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01375}01375     config-\/>\mbox{\hyperlink{structobsws__config__t_a74ee702373489ff1ea1289e87d50e469}{ping\_interval\_ms}} = 10000;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01376}01376     config-\/>\mbox{\hyperlink{structobsws__config__t_a806599d35ea8d3fc9c7140e76adf1c1a}{ping\_timeout\_ms}} = 5000;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01377}01377     config-\/>\mbox{\hyperlink{structobsws__config__t_a5be1729ffbc28b3e036315f06e80a7a8}{auto\_reconnect}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01378}01378     config-\/>\mbox{\hyperlink{structobsws__config__t_a5ccd3a828a3fcad6d6ebedc0324c4aee}{reconnect\_delay\_ms}} = 1000;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01379}01379     config-\/>\mbox{\hyperlink{structobsws__config__t_ae4f46d4b683af271b1ba69e335fb7e3c}{max\_reconnect\_delay\_ms}} = 30000;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01380}01380     config-\/>\mbox{\hyperlink{structobsws__config__t_a1aff4f0ff9ac25c5d63772eb91d443ac}{max\_reconnect\_attempts}} = 0; \textcolor{comment}{/* Infinite */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01381}01381 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01382}01382 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01383}01383 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01384}01384 \textcolor{comment}{ * @brief Establish a connection to OBS.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01385}01385 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01386}01386 \textcolor{comment}{ * This is the main entry point for using the library. You provide a configuration}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01387}01387 \textcolor{comment}{ * structure (initialized with obsws\_config\_init and then customized), and this}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01388}01388 \textcolor{comment}{ * function connects to OBS, authenticates if needed, and spawns a background}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01389}01389 \textcolor{comment}{ * thread to handle incoming messages and events.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01390}01390 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01391}01391 \textcolor{comment}{ * The function returns immediately -\/ it doesn't wait for the connection to}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01392}01392 \textcolor{comment}{ * complete. Instead, it:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01393}01393 \textcolor{comment}{ * 1. Creates a connection structure with the provided config}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01394}01394 \textcolor{comment}{ * 2. Allocates buffers for sending and receiving messages}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01395}01395 \textcolor{comment}{ * 3. Creates a libwebsockets context and connects to OBS}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01396}01396 \textcolor{comment}{ * 4. Spawns a background event\_thread to process WebSocket messages}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01397}01397 \textcolor{comment}{ * 5. Returns the connection handle}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01398}01398 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01399}01399 \textcolor{comment}{ * Connection states: The connection progresses through states:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01400}01400 \textcolor{comment}{ * -\/ DISCONNECTED -\/> CONNECTING (TCP handshake, WebSocket upgrade)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01401}01401 \textcolor{comment}{ * -\/ CONNECTING -\/> AUTHENTICATING (receive HELLO, send IDENTIFY)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01402}01402 \textcolor{comment}{ * -\/ AUTHENTICATING -\/> CONNECTED (receive IDENTIFIED)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01403}01403 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01404}01404 \textcolor{comment}{ * You don't have to wait for CONNECTED state before calling obsws\_send\_request,}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01405}01405 \textcolor{comment}{ * but requests sent while not connected will return OBSWS\_ERROR\_NOT\_CONNECTED.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01406}01406 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01407}01407 \textcolor{comment}{ * Memory ownership: The connection structure is allocated and owned by this}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01408}01408 \textcolor{comment}{ * function. You must free it by calling obsws\_disconnect(). Don't free it directly}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01409}01409 \textcolor{comment}{ * with free() -\/ that will cause memory leaks (threads won't be cleaned up properly).}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01410}01410 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01411}01411 \textcolor{comment}{ * Error cases:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01412}01412 \textcolor{comment}{ * -\/ NULL config or config-\/>host: Returns NULL}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01413}01413 \textcolor{comment}{ * -\/ libwebsockets context creation fails: Returns NULL and logs error}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01414}01414 \textcolor{comment}{ * -\/ Network connection fails: Returns valid pointer but connection stays in ERROR state}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01415}01415 \textcolor{comment}{ * -\/ Bad password: Returns valid pointer but stays in AUTHENTICATING (never reaches CONNECTED)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01416}01416 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01417}01417 \textcolor{comment}{ * Note: This function calls obsws\_init() automatically if the library isn't}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01418}01418 \textcolor{comment}{ * already initialized.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01419}01419 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01420}01420 \textcolor{comment}{ * @param config Pointer to initialized obsws\_config\_t with connection parameters}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01421}01421 \textcolor{comment}{ * @return Pointer to new connection handle, or NULL if creation failed}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01422}01422 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01423}01423 \textcolor{comment}{ * @see obsws\_disconnect, obsws\_get\_state, obsws\_send\_request}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01424}01424 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01425}\mbox{\hyperlink{library_8h_a7ed7225961f0989acb31ebbd9c099626}{01425}} \mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}}* \mbox{\hyperlink{library_8c_a7ed7225961f0989acb31ebbd9c099626}{obsws\_connect}}(\textcolor{keyword}{const} \mbox{\hyperlink{structobsws__config__t}{obsws\_config\_t}} *config) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01426}01426     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{library_8c_a5c573cf80a65ed908b966420c4a5d7d2}{g\_library\_initialized}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01427}01427         \mbox{\hyperlink{library_8c_aff3d6c035330741df84552800c0d0124}{obsws\_init}}();}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01428}01428     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01429}01429     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01430}01430     \textcolor{keywordflow}{if} (!config || !config-\/>\mbox{\hyperlink{structobsws__config__t_af632161e8b6cf2d7c1baf7fc80859d48}{host}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01431}01431         \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01432}01432     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01433}01433     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01434}01434     \mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn = calloc(1, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}}));}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01435}01435     \textcolor{keywordflow}{if} (!conn) \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01436}01436     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01437}01437     \textcolor{comment}{/* Copy configuration */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01438}01438     memcpy(\&conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}, config, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structobsws__config__t}{obsws\_config\_t}}));}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01439}01439     \textcolor{keywordflow}{if} (config-\/>\mbox{\hyperlink{structobsws__config__t_af632161e8b6cf2d7c1baf7fc80859d48}{host}}) conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_af632161e8b6cf2d7c1baf7fc80859d48}{host}} = strdup(config-\/>\mbox{\hyperlink{structobsws__config__t_af632161e8b6cf2d7c1baf7fc80859d48}{host}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01440}01440     \textcolor{keywordflow}{if} (config-\/>\mbox{\hyperlink{structobsws__config__t_a53ed762a113bb2a27b3ffab06a5c02ee}{password}}) conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a53ed762a113bb2a27b3ffab06a5c02ee}{password}} = strdup(config-\/>\mbox{\hyperlink{structobsws__config__t_a53ed762a113bb2a27b3ffab06a5c02ee}{password}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01441}01441     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01442}01442     \textcolor{comment}{/* Initialize mutexes */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01443}01443     pthread\_mutex\_init(\&conn-\/>\mbox{\hyperlink{structobsws__connection_aa2752abaf5b201277fae73b42c78c8e6}{state\_mutex}}, NULL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01444}01444     pthread\_mutex\_init(\&conn-\/>\mbox{\hyperlink{structobsws__connection_afc665d5d6864f038f551e4e7d4aae679}{send\_mutex}}, NULL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01445}01445     pthread\_mutex\_init(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a5be49ce76c72f09948fdf9c520eb133c}{requests\_mutex}}, NULL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01446}01446     pthread\_mutex\_init(\&conn-\/>\mbox{\hyperlink{structobsws__connection_ab29e2a357e95b536a2c79b0990614bc5}{stats\_mutex}}, NULL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01447}01447     pthread\_mutex\_init(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a4343875c5de5530580e13fb1b528cf35}{scene\_mutex}}, NULL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01448}01448     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01449}01449     \textcolor{comment}{/* Allocate buffers */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01450}01450     conn-\/>\mbox{\hyperlink{structobsws__connection_ac3cdc6c4de9ae6aed16d3aac13effe78}{recv\_buffer\_size}} = \mbox{\hyperlink{library_8c_a665c5272405e81329a26d2db1a7d5d97}{OBSWS\_DEFAULT\_BUFFER\_SIZE}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01451}01451     conn-\/>\mbox{\hyperlink{structobsws__connection_a89f2bbc96729ab308290da8959534d18}{recv\_buffer}} = malloc(conn-\/>\mbox{\hyperlink{structobsws__connection_ac3cdc6c4de9ae6aed16d3aac13effe78}{recv\_buffer\_size}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01452}01452     conn-\/>\mbox{\hyperlink{structobsws__connection_a60f4507eac7295e16ece7c2a97c910d6}{send\_buffer\_size}} = \mbox{\hyperlink{library_8c_a665c5272405e81329a26d2db1a7d5d97}{OBSWS\_DEFAULT\_BUFFER\_SIZE}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01453}01453     conn-\/>\mbox{\hyperlink{structobsws__connection_a14a61d0e27a8cac772ce173dd31d4fb7}{send\_buffer}} = malloc(conn-\/>\mbox{\hyperlink{structobsws__connection_a60f4507eac7295e16ece7c2a97c910d6}{send\_buffer\_size}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01454}01454     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01455}01455     conn-\/>\mbox{\hyperlink{structobsws__connection_adad7d0fb4880543b1f5b5e897010d814}{state}} = \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991af973d2b8b0a498d0bbffb40ccab1ef2d}{OBSWS\_STATE\_DISCONNECTED}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01456}01456     conn-\/>\mbox{\hyperlink{structobsws__connection_a32b971d76cdd4c2b166ff19135601776}{current\_reconnect\_delay}} = config-\/>\mbox{\hyperlink{structobsws__config__t_a5ccd3a828a3fcad6d6ebedc0324c4aee}{reconnect\_delay\_ms}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01457}01457     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01458}01458     \textcolor{comment}{/* Create libwebsockets context */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01459}01459     \textcolor{keyword}{struct }lws\_context\_creation\_info info;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01460}01460     memset(\&info, 0, \textcolor{keyword}{sizeof}(info));}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01461}01461     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01462}01462     info.port = CONTEXT\_PORT\_NO\_LISTEN;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01463}01463     info.protocols = \mbox{\hyperlink{library_8c_ad34f3c7a416fe0d9311efdc5715410e1}{protocols}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01464}01464     info.gid = -\/1;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01465}01465     info.uid = -\/1;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01466}01466     info.options = LWS\_SERVER\_OPTION\_DO\_SSL\_GLOBAL\_INIT;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01467}01467     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01468}01468     conn-\/>\mbox{\hyperlink{structobsws__connection_a2f876a0ab0ad0e5e012444a806aa3490}{lws\_context}} = lws\_create\_context(\&info);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01469}01469     \textcolor{keywordflow}{if} (!conn-\/>\mbox{\hyperlink{structobsws__connection_a2f876a0ab0ad0e5e012444a806aa3490}{lws\_context}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01470}01470         \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9a6a2a374e4af0446011df30bfd09e329e}{OBSWS\_LOG\_ERROR}}, \textcolor{stringliteral}{"{}Failed to create libwebsockets context"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01471}01471         free(conn-\/>\mbox{\hyperlink{structobsws__connection_a89f2bbc96729ab308290da8959534d18}{recv\_buffer}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01472}01472         free(conn-\/>\mbox{\hyperlink{structobsws__connection_a14a61d0e27a8cac772ce173dd31d4fb7}{send\_buffer}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01473}01473         free(conn);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01474}01474         \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01475}01475     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01476}01476     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01477}01477     \textcolor{comment}{/* Connect to OBS */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01478}01478     \textcolor{keyword}{struct }lws\_client\_connect\_info ccinfo;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01479}01479     memset(\&ccinfo, 0, \textcolor{keyword}{sizeof}(ccinfo));}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01480}01480     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01481}01481     ccinfo.context = conn-\/>\mbox{\hyperlink{structobsws__connection_a2f876a0ab0ad0e5e012444a806aa3490}{lws\_context}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01482}01482     ccinfo.address = conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_af632161e8b6cf2d7c1baf7fc80859d48}{host}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01483}01483     ccinfo.port = conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a7355cf2fb949f6d4391b6c2c605c9073}{port}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01484}01484     ccinfo.path = \textcolor{stringliteral}{"{}/"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01485}01485     ccinfo.host = ccinfo.address;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01486}01486     ccinfo.origin = ccinfo.address;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01487}01487     ccinfo.protocol = \mbox{\hyperlink{library_8c_ad34f3c7a416fe0d9311efdc5715410e1}{protocols}}[0].name;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01488}01488     ccinfo.userdata = conn;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01489}01489     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01490}01490     \textcolor{keywordflow}{if} (config-\/>\mbox{\hyperlink{structobsws__config__t_a1070992d75f19a3fd4567754d37b9290}{use\_ssl}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01491}01491         ccinfo.ssl\_connection = LCCSCF\_USE\_SSL;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01492}01492     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01493}01493     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01494}01494     conn-\/>\mbox{\hyperlink{structobsws__connection_aaf49ac1578fc794ee4b01ccbf9edc35a}{wsi}} = lws\_client\_connect\_via\_info(\&ccinfo);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01495}01495     \textcolor{keywordflow}{if} (!conn-\/>\mbox{\hyperlink{structobsws__connection_aaf49ac1578fc794ee4b01ccbf9edc35a}{wsi}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01496}01496         \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9a6a2a374e4af0446011df30bfd09e329e}{OBSWS\_LOG\_ERROR}}, \textcolor{stringliteral}{"{}Failed to initiate connection"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01497}01497         lws\_context\_destroy(conn-\/>\mbox{\hyperlink{structobsws__connection_a2f876a0ab0ad0e5e012444a806aa3490}{lws\_context}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01498}01498         free(conn-\/>\mbox{\hyperlink{structobsws__connection_a89f2bbc96729ab308290da8959534d18}{recv\_buffer}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01499}01499         free(conn-\/>\mbox{\hyperlink{structobsws__connection_a14a61d0e27a8cac772ce173dd31d4fb7}{send\_buffer}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01500}01500         free(conn);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01501}01501         \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01502}01502     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01503}01503     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01504}01504     \textcolor{comment}{/* Start event thread -\/ protect flags with mutex */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01505}01505     pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_aa2752abaf5b201277fae73b42c78c8e6}{state\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01506}01506     conn-\/>\mbox{\hyperlink{structobsws__connection_afbc2be09cbcbbe17561e400babd084e2}{thread\_running}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01507}01507     conn-\/>\mbox{\hyperlink{structobsws__connection_a6aa5a0ce7b42fc1cd72385181ca43454}{should\_exit}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01508}01508     pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_aa2752abaf5b201277fae73b42c78c8e6}{state\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01509}01509     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01510}01510     pthread\_create(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a160a7f93e6caf0da1bc2f4dbe48fbb41}{event\_thread}}, NULL, \mbox{\hyperlink{library_8c_a27739efcea1287611c82ff3e8c88d7b7}{event\_thread\_func}}, conn);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01511}01511     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01512}01512     \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9ae48017bf78390a3df8cd87a24782c421}{OBSWS\_LOG\_INFO}}, \textcolor{stringliteral}{"{}Connecting to OBS at \%s:\%d"{}}, config-\/>\mbox{\hyperlink{structobsws__config__t_af632161e8b6cf2d7c1baf7fc80859d48}{host}}, config-\/>\mbox{\hyperlink{structobsws__config__t_a7355cf2fb949f6d4391b6c2c605c9073}{port}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01513}01513     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01514}01514     \textcolor{keywordflow}{return} conn;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01515}01515 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01516}01516 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01517}01517 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01518}01518 \textcolor{comment}{ * @brief Disconnect from OBS and clean up connection resources.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01519}01519 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01520}01520 \textcolor{comment}{ * This is the counterpart to obsws\_connect(). It cleanly shuts down the connection,}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01521}01521 \textcolor{comment}{ * stops the background event thread, and frees all allocated resources.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01522}01522 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01523}01523 \textcolor{comment}{ * The function performs these steps:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01524}01524 \textcolor{comment}{ * 1. Signal the event\_thread to stop by setting should\_exit flag}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01525}01525 \textcolor{comment}{ * 2. Wait for the event\_thread to actually exit using pthread\_join()}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01526}01526 \textcolor{comment}{ * 3. Send a normal WebSocket close frame to OBS (if connected)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01527}01527 \textcolor{comment}{ * 4. Destroy the libwebsockets context}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01528}01528 \textcolor{comment}{ * 5. Free all pending requests (they won't get responses now, but don't leak memory)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01529}01529 \textcolor{comment}{ * 6. Free buffers, config, authentication data}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01530}01530 \textcolor{comment}{ * 7. Destroy all mutexes and condition variables}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01531}01531 \textcolor{comment}{ * 8. Free the connection structure}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01532}01532 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01533}01533 \textcolor{comment}{ * After calling this, the connection pointer is invalid. Don't use it again.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01534}01534 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01535}01535 \textcolor{comment}{ * Safe to call multiple times: If you call it twice, the second call will be}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01536}01536 \textcolor{comment}{ * a no-\/op (because conn will be NULL).}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01537}01537 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01538}01538 \textcolor{comment}{ * Safe to call even if connection never fully established: If you disconnect}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01539}01539 \textcolor{comment}{ * while in CONNECTING or AUTHENTICATING state, everything is still cleaned up.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01540}01540 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01541}01541 \textcolor{comment}{ * Important: This function blocks until the event\_thread exits. If you have}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01542}01542 \textcolor{comment}{ * a callback that's blocked, this will deadlock. Make sure your callbacks}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01543}01543 \textcolor{comment}{ * don't block!}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01544}01544 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01545}01545 \textcolor{comment}{ * @param conn The connection to close (can be NULL -\/ safe to call)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01546}01546 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01547}01547 \textcolor{comment}{ * @see obsws\_connect}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01548}01548 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01549}\mbox{\hyperlink{library_8h_aa8389ba6731e01a9426bd921180b7195}{01549}} \textcolor{keywordtype}{void} \mbox{\hyperlink{library_8c_aa8389ba6731e01a9426bd921180b7195}{obsws\_disconnect}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01550}01550     \textcolor{keywordflow}{if} (!conn) \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01551}01551     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01552}01552     \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9ae48017bf78390a3df8cd87a24782c421}{OBSWS\_LOG\_INFO}}, \textcolor{stringliteral}{"{}Disconnecting from OBS"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01553}01553     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01554}01554     \textcolor{comment}{/* Stop event thread -\/ protect flag with mutex */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01555}01555     pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_aa2752abaf5b201277fae73b42c78c8e6}{state\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01556}01556     conn-\/>\mbox{\hyperlink{structobsws__connection_a6aa5a0ce7b42fc1cd72385181ca43454}{should\_exit}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01557}01557     \textcolor{keywordtype}{bool} thread\_was\_running = conn-\/>\mbox{\hyperlink{structobsws__connection_afbc2be09cbcbbe17561e400babd084e2}{thread\_running}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01558}01558     pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_aa2752abaf5b201277fae73b42c78c8e6}{state\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01559}01559     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01560}01560     \textcolor{keywordflow}{if} (thread\_was\_running) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01561}01561         pthread\_join(conn-\/>\mbox{\hyperlink{structobsws__connection_a160a7f93e6caf0da1bc2f4dbe48fbb41}{event\_thread}}, NULL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01562}01562     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01563}01563     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01564}01564     \textcolor{comment}{/* Close WebSocket -\/ only if connected */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01565}01565     \textcolor{keywordflow}{if} (conn-\/>\mbox{\hyperlink{structobsws__connection_aaf49ac1578fc794ee4b01ccbf9edc35a}{wsi}} \&\& conn-\/>\mbox{\hyperlink{structobsws__connection_adad7d0fb4880543b1f5b5e897010d814}{state}} == \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991adbaae08035175b470fb9f543414672b8}{OBSWS\_STATE\_CONNECTED}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01566}01566         lws\_close\_reason(conn-\/>\mbox{\hyperlink{structobsws__connection_aaf49ac1578fc794ee4b01ccbf9edc35a}{wsi}}, LWS\_CLOSE\_STATUS\_NORMAL, NULL, 0);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01567}01567     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01568}01568     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01569}01569     \textcolor{comment}{/* Cleanup libwebsockets */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01570}01570     \textcolor{keywordflow}{if} (conn-\/>\mbox{\hyperlink{structobsws__connection_a2f876a0ab0ad0e5e012444a806aa3490}{lws\_context}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01571}01571         lws\_context\_destroy(conn-\/>\mbox{\hyperlink{structobsws__connection_a2f876a0ab0ad0e5e012444a806aa3490}{lws\_context}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01572}01572     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01573}01573     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01574}01574     \textcolor{comment}{/* Free pending requests */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01575}01575     pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a5be49ce76c72f09948fdf9c520eb133c}{requests\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01576}01576     \mbox{\hyperlink{structpending__request}{pending\_request\_t}} *req = conn-\/>\mbox{\hyperlink{structobsws__connection_acc0664cafa773ffe211ffe993c6ac8af}{pending\_requests}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01577}01577     \textcolor{keywordflow}{while} (req) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01578}01578         \mbox{\hyperlink{structpending__request}{pending\_request\_t}} *next = req-\/>\mbox{\hyperlink{structpending__request_a49161e43ef29129c11fe643e85338df2}{next}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01579}01579         \textcolor{keywordflow}{if} (req-\/>\mbox{\hyperlink{structpending__request_a4b37104673cb81e3f2825c8f6df372ba}{response}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01580}01580             \mbox{\hyperlink{library_8c_a53067e61dc0ddcf1134d46b275d7ce6b}{obsws\_response\_free}}(req-\/>\mbox{\hyperlink{structpending__request_a4b37104673cb81e3f2825c8f6df372ba}{response}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01581}01581         \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01582}01582         pthread\_mutex\_destroy(\&req-\/>\mbox{\hyperlink{structpending__request_a30b4636ccd06e4f775ee0dcc29ba3a69}{mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01583}01583         pthread\_cond\_destroy(\&req-\/>\mbox{\hyperlink{structpending__request_a619500d05293ec1f654ea803139941de}{cond}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01584}01584         free(req);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01585}01585         req = next;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01586}01586     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01587}01587     pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a5be49ce76c72f09948fdf9c520eb133c}{requests\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01588}01588     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01589}01589     \textcolor{comment}{/* Free resources */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01590}01590     free(conn-\/>\mbox{\hyperlink{structobsws__connection_a89f2bbc96729ab308290da8959534d18}{recv\_buffer}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01591}01591     free(conn-\/>\mbox{\hyperlink{structobsws__connection_a14a61d0e27a8cac772ce173dd31d4fb7}{send\_buffer}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01592}01592     free((\textcolor{keywordtype}{char} *)conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_af632161e8b6cf2d7c1baf7fc80859d48}{host}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01593}01593     free((\textcolor{keywordtype}{char} *)conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a53ed762a113bb2a27b3ffab06a5c02ee}{password}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01594}01594     free(conn-\/>\mbox{\hyperlink{structobsws__connection_a99dd8596f842d976297c91a7e101b9f4}{challenge}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01595}01595     free(conn-\/>\mbox{\hyperlink{structobsws__connection_a172b9304975dc52f9c962e0592f20330}{salt}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01596}01596     free(conn-\/>\mbox{\hyperlink{structobsws__connection_a887874891a0026e6ad2a2ee2c3c7390a}{current\_scene}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01597}01597     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01598}01598     \textcolor{comment}{/* Destroy mutexes */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01599}01599     pthread\_mutex\_destroy(\&conn-\/>\mbox{\hyperlink{structobsws__connection_aa2752abaf5b201277fae73b42c78c8e6}{state\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01600}01600     pthread\_mutex\_destroy(\&conn-\/>\mbox{\hyperlink{structobsws__connection_afc665d5d6864f038f551e4e7d4aae679}{send\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01601}01601     pthread\_mutex\_destroy(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a5be49ce76c72f09948fdf9c520eb133c}{requests\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01602}01602     pthread\_mutex\_destroy(\&conn-\/>\mbox{\hyperlink{structobsws__connection_ab29e2a357e95b536a2c79b0990614bc5}{stats\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01603}01603     pthread\_mutex\_destroy(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a4343875c5de5530580e13fb1b528cf35}{scene\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01604}01604     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01605}01605     free(conn);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01606}01606 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01607}01607 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01608}01608 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01609}01609 \textcolor{comment}{ * @brief Check if a connection is actively connected to OBS.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01610}01610 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01611}01611 \textcolor{comment}{ * Convenience function that returns true if the connection is in CONNECTED state}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01612}01612 \textcolor{comment}{ * and false otherwise. Useful for checking before sending requests.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01613}01613 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01614}01614 \textcolor{comment}{ * Thread-\/safe: This function locks the state\_mutex before checking, so it's}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01615}01615 \textcolor{comment}{ * safe to call from any thread.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01616}01616 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01617}01617 \textcolor{comment}{ * Return value: The connection must be in OBSWS\_STATE\_CONNECTED to return true.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01618}01618 \textcolor{comment}{ * If it's CONNECTING, AUTHENTICATING, ERROR, or DISCONNECTED, this returns false.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01619}01619 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01620}01620 \textcolor{comment}{ * @param conn The connection to check (NULL is safe -\/ returns false)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01621}01621 \textcolor{comment}{ * @return true if connected, false otherwise}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01622}01622 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01623}01623 \textcolor{comment}{ * @see obsws\_get\_state}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01624}01624 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01625}\mbox{\hyperlink{library_8h_ad9894e72ee8510f4eaf7d42feaf0cf9a}{01625}} \textcolor{keywordtype}{bool} \mbox{\hyperlink{library_8c_ad9894e72ee8510f4eaf7d42feaf0cf9a}{obsws\_is\_connected}}(\textcolor{keyword}{const} \mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01626}01626     \textcolor{keywordflow}{if} (!conn) \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01627}01627     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01628}01628     \textcolor{comment}{/* Thread-\/safe state check */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01629}01629     pthread\_mutex\_lock((pthread\_mutex\_t *)\&conn-\/>\mbox{\hyperlink{structobsws__connection_aa2752abaf5b201277fae73b42c78c8e6}{state\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01630}01630     \textcolor{keywordtype}{bool} connected = (conn-\/>\mbox{\hyperlink{structobsws__connection_adad7d0fb4880543b1f5b5e897010d814}{state}} == \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991adbaae08035175b470fb9f543414672b8}{OBSWS\_STATE\_CONNECTED}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01631}01631     pthread\_mutex\_unlock((pthread\_mutex\_t *)\&conn-\/>\mbox{\hyperlink{structobsws__connection_aa2752abaf5b201277fae73b42c78c8e6}{state\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01632}01632     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01633}01633     \textcolor{keywordflow}{return} connected;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01634}01634 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01635}01635 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01636}01636 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01637}01637 \textcolor{comment}{ * @brief Get the current connection state.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01638}01638 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01639}01639 \textcolor{comment}{ * Returns one of the connection states:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01640}01640 \textcolor{comment}{ * -\/ OBSWS\_STATE\_DISCONNECTED: Not connected, idle}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01641}01641 \textcolor{comment}{ * -\/ OBSWS\_STATE\_CONNECTING: TCP connection established, waiting for WebSocket handshake}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01642}01642 \textcolor{comment}{ * -\/ OBSWS\_STATE\_AUTHENTICATING: WebSocket established, waiting for auth response}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01643}01643 \textcolor{comment}{ * -\/ OBSWS\_STATE\_CONNECTED: Connected and ready for requests}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01644}01644 \textcolor{comment}{ * -\/ OBSWS\_STATE\_ERROR: Connection encountered an error}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01645}01645 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01646}01646 \textcolor{comment}{ * State transitions normally follow this flow:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01647}01647 \textcolor{comment}{ * DISCONNECTED -\/> CONNECTING -\/> AUTHENTICATING -\/> CONNECTED}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01648}01648 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01649}01649 \textcolor{comment}{ * But with errors, you can also have:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01650}01650 \textcolor{comment}{ * (any state) -\/> ERROR}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01651}01651 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01652}01652 \textcolor{comment}{ * You don't usually need to call this -\/ just try to send requests and check}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01653}01653 \textcolor{comment}{ * the error code. But it's useful for monitoring and debugging.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01654}01654 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01655}01655 \textcolor{comment}{ * Thread-\/safe: This function locks the state\_mutex, so it's safe to call}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01656}01656 \textcolor{comment}{ * from any thread.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01657}01657 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01658}01658 \textcolor{comment}{ * @param conn The connection to check (NULL is safe -\/ returns DISCONNECTED)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01659}01659 \textcolor{comment}{ * @return The current connection state}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01660}01660 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01661}01661 \textcolor{comment}{ * @see obsws\_is\_connected}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01662}01662 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01663}\mbox{\hyperlink{library_8h_a61a10e31041532a9da0c1c1993f84a79}{01663}} \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991}{obsws\_state\_t}} \mbox{\hyperlink{library_8c_a61a10e31041532a9da0c1c1993f84a79}{obsws\_get\_state}}(\textcolor{keyword}{const} \mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01664}01664     \textcolor{keywordflow}{if} (!conn) \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991af973d2b8b0a498d0bbffb40ccab1ef2d}{OBSWS\_STATE\_DISCONNECTED}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01665}01665     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01666}01666     pthread\_mutex\_lock((pthread\_mutex\_t *)\&conn-\/>\mbox{\hyperlink{structobsws__connection_aa2752abaf5b201277fae73b42c78c8e6}{state\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01667}01667     \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991}{obsws\_state\_t}} state = conn-\/>\mbox{\hyperlink{structobsws__connection_adad7d0fb4880543b1f5b5e897010d814}{state}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01668}01668     pthread\_mutex\_unlock((pthread\_mutex\_t *)\&conn-\/>\mbox{\hyperlink{structobsws__connection_aa2752abaf5b201277fae73b42c78c8e6}{state\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01669}01669     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01670}01670     \textcolor{keywordflow}{return} state;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01671}01671 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01672}01672 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01673}01673 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01674}01674 \textcolor{comment}{ * @brief Retrieve performance and connectivity statistics.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01675}01675 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01676}01676 \textcolor{comment}{ * The library maintains statistics about the connection:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01677}01677 \textcolor{comment}{ * -\/ messages\_sent / messages\_received: Count of WebSocket messages}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01678}01678 \textcolor{comment}{ * -\/ bytes\_sent / bytes\_received: Total bytes transmitted/received}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01679}01679 \textcolor{comment}{ * -\/ connected\_since: Timestamp of when we reached CONNECTED state}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01680}01680 \textcolor{comment}{ * -\/ reconnect\_count: How many times we've reconnected (0 if never disconnected)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01681}01681 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01682}01682 \textcolor{comment}{ * These can be useful for:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01683}01683 \textcolor{comment}{ * -\/ Monitoring connection health}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01684}01684 \textcolor{comment}{ * -\/ Detecting stalled connections (if bytes\_received stops increasing)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01685}01685 \textcolor{comment}{ * -\/ Debugging and performance profiling}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01686}01686 \textcolor{comment}{ * -\/ Health dashboards or logging}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01687}01687 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01688}01688 \textcolor{comment}{ * Thread-\/safe: This function acquires stats\_mutex and copies the entire}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01689}01689 \textcolor{comment}{ * stats structure, so it's safe to call from any thread. The copy operation}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01690}01690 \textcolor{comment}{ * is atomic from the caller's perspective.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01691}01691 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01692}01692 \textcolor{comment}{ * Example usage:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01693}01693 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01694}01694 \textcolor{comment}{ * obsws\_stats\_t stats;}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01695}01695 \textcolor{comment}{ * obsws\_get\_stats(conn, \&stats);}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01696}01696 \textcolor{comment}{ * printf("{}Received \%zu messages, \%zu bytes\(\backslash\)\(\backslash\)n"{}, }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01697}01697 \textcolor{comment}{ *        stats.messages\_received, stats.bytes\_received);}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01698}01698 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01699}01699 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01700}01700 \textcolor{comment}{ * @param conn The connection to query (NULL returns error)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01701}01701 \textcolor{comment}{ * @param stats Pointer to stats structure to fill (must not be NULL)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01702}01702 \textcolor{comment}{ * @return OBSWS\_OK on success, OBSWS\_ERROR\_INVALID\_PARAM if conn or stats is NULL}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01703}01703 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01704}01704 \textcolor{comment}{ * @see obsws\_stats\_t}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01705}01705 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01706}\mbox{\hyperlink{library_8h_a5cce41cb6c70229eaab8b1b3afba57a9}{01706}} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6}{obsws\_error\_t}} \mbox{\hyperlink{library_8c_a5cce41cb6c70229eaab8b1b3afba57a9}{obsws\_get\_stats}}(\textcolor{keyword}{const} \mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, \mbox{\hyperlink{structobsws__stats__t}{obsws\_stats\_t}} *stats) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01707}01707     \textcolor{keywordflow}{if} (!conn || !stats) \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6a8944fe1379e71d22a82399c21107ebf6}{OBSWS\_ERROR\_INVALID\_PARAM}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01708}01708     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01709}01709     pthread\_mutex\_lock((pthread\_mutex\_t *)\&conn-\/>\mbox{\hyperlink{structobsws__connection_ab29e2a357e95b536a2c79b0990614bc5}{stats\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01710}01710     memcpy(stats, \&conn-\/>\mbox{\hyperlink{structobsws__connection_a10b9da03b3a1cb3a6ee0e72387915740}{stats}}, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structobsws__stats__t}{obsws\_stats\_t}}));}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01711}01711     pthread\_mutex\_unlock((pthread\_mutex\_t *)\&conn-\/>\mbox{\hyperlink{structobsws__connection_ab29e2a357e95b536a2c79b0990614bc5}{stats\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01712}01712     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01713}01713     \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6aa43b9a59f39db094a477cb25a638e5a1}{OBSWS\_OK}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01714}01714 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01715}01715 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01716}01716 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01717}01717 \textcolor{comment}{ * @brief Send a synchronous request to OBS and wait for the response.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01718}01718 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01719}01719 \textcolor{comment}{ * This is the core function for all OBS operations. It implements the asynchronous}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01720}01720 \textcolor{comment}{ * request-\/response pattern of the OBS WebSocket v5 protocol:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01721}01721 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01722}01722 \textcolor{comment}{ * **Protocol Flow:**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01723}01723 \textcolor{comment}{ * 1. Generate a unique UUID for this request (used to match responses)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01724}01724 \textcolor{comment}{ * 2. Create a pending\_request\_t to track the in-\/flight operation}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01725}01725 \textcolor{comment}{ * 3. Build the request JSON with opcode 6 (REQUEST)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01726}01726 \textcolor{comment}{ * 4. Send the message via lws\_write()}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01727}01727 \textcolor{comment}{ * 5. Block the caller with pthread\_cond\_timedwait() until response arrives}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01728}01728 \textcolor{comment}{ * 6. Return the response to caller (who owns it and must free with obsws\_response\_free)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01729}01729 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01730}01730 \textcolor{comment}{ * **Why synchronous from caller's perspective?**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01731}01731 \textcolor{comment}{ * Although WebSocket messages are async at the protocol level, we provide a}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01732}01732 \textcolor{comment}{ * synchronous API -\/ the caller sends a request and blocks until the response}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01733}01733 \textcolor{comment}{ * arrives. This is simpler for application code than callback-\/based async APIs.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01734}01734 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01735}01735 \textcolor{comment}{ * Behind the scenes, the background event\_thread continuously processes WebSocket}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01736}01736 \textcolor{comment}{ * messages. When a REQUEST\_RESPONSE (opcode 7) arrives matching a pending request}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01737}01737 \textcolor{comment}{ * ID, it signals the waiting condition variable, waking up the blocked caller.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01738}01738 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01739}01739 \textcolor{comment}{ * **Performance implications:**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01740}01740 \textcolor{comment}{ * -\/ Thread-\/safe: The main app thread can be blocked in obsws\_send\_request() while}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01741}01741 \textcolor{comment}{ *   the background event\_thread processes other messages}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01742}01742 \textcolor{comment}{ * -\/ No polling: Uses condition variables, not CPU-\/wasting polling loops}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01743}01743 \textcolor{comment}{ * -\/ Can make multiple simultaneous requests from different threads (up to}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01744}01744 \textcolor{comment}{ *   OBSWS\_MAX\_PENDING\_REQUESTS = 256)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01745}01745 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01746}01746 \textcolor{comment}{ * **Example usage:**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01747}01747 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01748}01748 \textcolor{comment}{ * obsws\_response\_t *response = NULL;}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01749}01749 \textcolor{comment}{ * obsws\_error\_t err = obsws\_send\_request(conn, "{}SetCurrentProgramScene"{},}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01750}01750 \textcolor{comment}{ *                                        "{}\{\(\backslash\)"{}sceneName\(\backslash\)"{}: \(\backslash\)"{}Scene1\(\backslash\)"{}\}"{}, }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01751}01751 \textcolor{comment}{ *                                        \&response, 0);}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01752}01752 \textcolor{comment}{ * if (err == OBSWS\_OK \&\& response \&\& response-\/>success) \{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01753}01753 \textcolor{comment}{ *     printf("{}Scene switched successfully\(\backslash\)\(\backslash\)n"{});}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01754}01754 \textcolor{comment}{ * \}}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01755}01755 \textcolor{comment}{ * obsws\_response\_free(response);}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01756}01756 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01757}01757 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01758}01758 \textcolor{comment}{ * @param conn Connection object (must be in CONNECTED state)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01759}01759 \textcolor{comment}{ * @param request\_type OBS request type like "{}GetCurrentProgramScene"{}, "{}SetCurrentProgramScene"{}, etc.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01760}01760 \textcolor{comment}{ * @param request\_data Optional JSON string with request parameters. NULL for no parameters.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01761}01761 \textcolor{comment}{ *                     Example: "{}\{\(\backslash\)"{}sceneName\(\backslash\)"{}: \(\backslash\)"{}Scene1\(\backslash\)"{}\}"{}}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01762}01762 \textcolor{comment}{ * @param response Output pointer for the response. Will be allocated by this function.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01763}01763 \textcolor{comment}{ *                 Caller must free with obsws\_response\_free(). Can be NULL if caller doesn't}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01764}01764 \textcolor{comment}{ *                 need the response (but response is still consumed from server).}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01765}01765 \textcolor{comment}{ * @param timeout\_ms Timeout in milliseconds (0 = use config-\/>recv\_timeout\_ms, typically 30000ms)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01766}01766 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01767}01767 \textcolor{comment}{ * @return OBSWS\_OK if response received (check response-\/>success for operation success)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01768}01768 \textcolor{comment}{ * @return OBSWS\_ERROR\_INVALID\_PARAM if conn, request\_type, or response pointer is NULL}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01769}01769 \textcolor{comment}{ * @return OBSWS\_ERROR\_NOT\_CONNECTED if connection is not in CONNECTED state}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01770}01770 \textcolor{comment}{ * @return OBSWS\_ERROR\_OUT\_OF\_MEMORY if pending request allocation fails}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01771}01771 \textcolor{comment}{ * @return OBSWS\_ERROR\_SEND\_FAILED if message send fails (buffer too small, invalid wsi, etc)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01772}01772 \textcolor{comment}{ * @return OBSWS\_ERROR\_TIMEOUT if no response received within timeout\_ms}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01773}01773 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01774}01774 \textcolor{comment}{ * @see obsws\_response\_t, obsws\_response\_free, obsws\_error\_string}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01775}01775 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01776}\mbox{\hyperlink{library_8h_af2fd7f8dd928e03b38a3e2c5b5745417}{01776}} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6}{obsws\_error\_t}} \mbox{\hyperlink{library_8c_af2fd7f8dd928e03b38a3e2c5b5745417}{obsws\_send\_request}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *request\_type,}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01777}01777                                  \textcolor{keyword}{const} \textcolor{keywordtype}{char} *request\_data, \mbox{\hyperlink{structobsws__response__t}{obsws\_response\_t}} **response, uint32\_t timeout\_ms) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01778}01778     \textcolor{keywordflow}{if} (!conn || !request\_type || !response) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01779}01779         \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6a8944fe1379e71d22a82399c21107ebf6}{OBSWS\_ERROR\_INVALID\_PARAM}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01780}01780     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01781}01781     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01782}01782     \textcolor{keywordflow}{if} (conn-\/>\mbox{\hyperlink{structobsws__connection_adad7d0fb4880543b1f5b5e897010d814}{state}} != \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991adbaae08035175b470fb9f543414672b8}{OBSWS\_STATE\_CONNECTED}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01783}01783         \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6ace2eb9908cf7d65109788a2593582982}{OBSWS\_ERROR\_NOT\_CONNECTED}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01784}01784     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01785}01785     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01786}01786     \textcolor{comment}{/* Generate request ID */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01787}01787     \textcolor{keywordtype}{char} request\_id[\mbox{\hyperlink{library_8c_a25b13264018fd1dc7b1f2bbd93bdc7cc}{OBSWS\_UUID\_LENGTH}}];}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01788}01788     \mbox{\hyperlink{library_8c_af79be0fed07182761c923170f4211089}{generate\_uuid}}(request\_id);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01789}01789     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01790}01790     \textcolor{comment}{/* Create pending request */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01791}01791     \mbox{\hyperlink{structpending__request}{pending\_request\_t}} *req = \mbox{\hyperlink{library_8c_aafc3d1ce3debddcb8e3888c9806e044a}{create\_pending\_request}}(conn, request\_id);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01792}01792     \textcolor{keywordflow}{if} (!req) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01793}01793         \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6a976f03f9cfc1de7d7172732454829e15}{OBSWS\_ERROR\_OUT\_OF\_MEMORY}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01794}01794     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01795}01795     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01796}01796     \textcolor{comment}{/* Build request JSON */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01797}01797     cJSON *request = cJSON\_CreateObject();}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01798}01798     cJSON\_AddNumberToObject(request, \textcolor{stringliteral}{"{}op"{}}, \mbox{\hyperlink{library_8c_a6c2c324c3b2c49b7febe0b376d6c1045}{OBSWS\_OPCODE\_REQUEST}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01799}01799     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01800}01800     cJSON *d = cJSON\_CreateObject();}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01801}01801     cJSON\_AddStringToObject(d, \textcolor{stringliteral}{"{}requestType"{}}, request\_type);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01802}01802     cJSON\_AddStringToObject(d, \textcolor{stringliteral}{"{}requestId"{}}, request\_id);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01803}01803     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01804}01804     \textcolor{keywordflow}{if} (request\_data) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01805}01805         cJSON *data = cJSON\_Parse(request\_data);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01806}01806         \textcolor{keywordflow}{if} (data) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01807}01807             cJSON\_AddItemToObject(d, \textcolor{stringliteral}{"{}requestData"{}}, data);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01808}01808         \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01809}01809     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01810}01810     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01811}01811     cJSON\_AddItemToObject(request, \textcolor{stringliteral}{"{}d"{}}, d);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01812}01812     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01813}01813     \textcolor{keywordtype}{char} *message = cJSON\_PrintUnformatted(request);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01814}01814     cJSON\_Delete(request);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01815}01815     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01816}01816     \textcolor{comment}{/* DEBUG\_HIGH: Show request being sent */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01817}01817     \mbox{\hyperlink{library_8c_a3682ffd7f6175dbc796f5750172c99bf}{obsws\_debug}}(conn, \mbox{\hyperlink{library_8h_a1997a985daa6bfb4117e885d9bb81668aceb0431d743cdecf0848564f388d51bd}{OBSWS\_DEBUG\_HIGH}}, \textcolor{stringliteral}{"{}Sending request (ID: \%s): \%s"{}}, request\_id, message);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01818}01818     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01819}01819     \textcolor{comment}{/* Send request */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01820}01820     pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_afc665d5d6864f038f551e4e7d4aae679}{send\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01821}01821     \textcolor{keywordtype}{size\_t} len = strlen(message);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01822}01822     \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6}{obsws\_error\_t}} result = \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6aa43b9a59f39db094a477cb25a638e5a1}{OBSWS\_OK}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01823}01823     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01824}01824     \textcolor{keywordflow}{if} (len < conn-\/>send\_buffer\_size -\/ LWS\_PRE \&\& conn-\/>\mbox{\hyperlink{structobsws__connection_aaf49ac1578fc794ee4b01ccbf9edc35a}{wsi}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01825}01825         memcpy(conn-\/>\mbox{\hyperlink{structobsws__connection_a14a61d0e27a8cac772ce173dd31d4fb7}{send\_buffer}} + LWS\_PRE, message, len);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01826}01826         \textcolor{keywordtype}{int} written = lws\_write(conn-\/>\mbox{\hyperlink{structobsws__connection_aaf49ac1578fc794ee4b01ccbf9edc35a}{wsi}}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *)(conn-\/>\mbox{\hyperlink{structobsws__connection_a14a61d0e27a8cac772ce173dd31d4fb7}{send\_buffer}} + LWS\_PRE), len, LWS\_WRITE\_TEXT);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01827}01827         }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01828}01828         \textcolor{keywordflow}{if} (written < 0) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01829}01829             result = \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6abab3c6691cc119a7b875d967f0fc565f}{OBSWS\_ERROR\_SEND\_FAILED}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01830}01830         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01831}01831             pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_ab29e2a357e95b536a2c79b0990614bc5}{stats\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01832}01832             conn-\/>\mbox{\hyperlink{structobsws__connection_a10b9da03b3a1cb3a6ee0e72387915740}{stats}}.\mbox{\hyperlink{structobsws__stats__t_a8fcaddd7c5934bcf0a44225bc9a23fa5}{messages\_sent}}++;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01833}01833             conn-\/>\mbox{\hyperlink{structobsws__connection_a10b9da03b3a1cb3a6ee0e72387915740}{stats}}.\mbox{\hyperlink{structobsws__stats__t_a79582a623821723ea9bf86930eb32db2}{bytes\_sent}} += len;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01834}01834             pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_ab29e2a357e95b536a2c79b0990614bc5}{stats\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01835}01835         \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01836}01836     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01837}01837         result = \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6abab3c6691cc119a7b875d967f0fc565f}{OBSWS\_ERROR\_SEND\_FAILED}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01838}01838     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01839}01839     pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_afc665d5d6864f038f551e4e7d4aae679}{send\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01840}01840     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01841}01841     free(message);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01842}01842     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01843}01843     \textcolor{keywordflow}{if} (result != \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6aa43b9a59f39db094a477cb25a638e5a1}{OBSWS\_OK}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01844}01844         \mbox{\hyperlink{library_8c_a700c8a9baa87a3827b399776e811f328}{remove\_pending\_request}}(conn, req);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01845}01845         \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01846}01846     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01847}01847     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01848}01848     \textcolor{comment}{/* Wait for response */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01849}01849     \textcolor{keywordflow}{if} (timeout\_ms == 0) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01850}01850         timeout\_ms = conn-\/>\mbox{\hyperlink{structobsws__connection_aaa5cf000b991e623632977c379314d89}{config}}.\mbox{\hyperlink{structobsws__config__t_a6439a4274026273ba5fb9786c90daa93}{recv\_timeout\_ms}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01851}01851     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01852}01852     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01853}01853     \textcolor{keyword}{struct }timespec ts;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01854}01854     clock\_gettime(CLOCK\_REALTIME, \&ts);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01855}01855     ts.tv\_sec += timeout\_ms / 1000;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01856}01856     ts.tv\_nsec += (timeout\_ms \% 1000) * 1000000;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01857}01857     \textcolor{keywordflow}{if} (ts.tv\_nsec >= 1000000000) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01858}01858         ts.tv\_sec++;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01859}01859         ts.tv\_nsec -\/= 1000000000;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01860}01860     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01861}01861     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01862}01862     pthread\_mutex\_lock(\&req-\/>\mbox{\hyperlink{structpending__request_a30b4636ccd06e4f775ee0dcc29ba3a69}{mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01863}01863     \textcolor{keywordflow}{while} (!req-\/>\mbox{\hyperlink{structpending__request_af74dd3c97a064175b9dcf3dbfe3665cc}{completed}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01864}01864         \textcolor{keywordtype}{int} wait\_result = pthread\_cond\_timedwait(\&req-\/>\mbox{\hyperlink{structpending__request_a619500d05293ec1f654ea803139941de}{cond}}, \&req-\/>\mbox{\hyperlink{structpending__request_a30b4636ccd06e4f775ee0dcc29ba3a69}{mutex}}, \&ts);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01865}01865         \textcolor{keywordflow}{if} (wait\_result == ETIMEDOUT) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01866}01866             pthread\_mutex\_unlock(\&req-\/>\mbox{\hyperlink{structpending__request_a30b4636ccd06e4f775ee0dcc29ba3a69}{mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01867}01867             \mbox{\hyperlink{library_8c_a700c8a9baa87a3827b399776e811f328}{remove\_pending\_request}}(conn, req);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01868}01868             \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6a852a5a13d07531a60aedc6e3cc1ae86d}{OBSWS\_ERROR\_TIMEOUT}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01869}01869         \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01870}01870     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01871}01871     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01872}01872     *response = req-\/>\mbox{\hyperlink{structpending__request_a4b37104673cb81e3f2825c8f6df372ba}{response}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01873}01873     req-\/>\mbox{\hyperlink{structpending__request_a4b37104673cb81e3f2825c8f6df372ba}{response}} = NULL; \textcolor{comment}{/* Transfer ownership */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01874}01874     pthread\_mutex\_unlock(\&req-\/>\mbox{\hyperlink{structpending__request_a30b4636ccd06e4f775ee0dcc29ba3a69}{mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01875}01875     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01876}01876     \mbox{\hyperlink{library_8c_a700c8a9baa87a3827b399776e811f328}{remove\_pending\_request}}(conn, req);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01877}01877     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01878}01878     \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6aa43b9a59f39db094a477cb25a638e5a1}{OBSWS\_OK}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01879}01879 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01880}01880 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01881}01881 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01882}01882 \textcolor{comment}{ * @brief Switch OBS to a specific scene.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01883}01883 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01884}01884 \textcolor{comment}{ * This is a high-\/level convenience function for scene switching. It demonstrates several}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01885}01885 \textcolor{comment}{ * important design patterns in the library:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01886}01886 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01887}01887 \textcolor{comment}{ * **Optimization: Scene Cache**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01888}01888 \textcolor{comment}{ * Before sending a request to OBS, this function checks the cached current scene. If the}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01889}01889 \textcolor{comment}{ * requested scene is already active, it returns immediately without network overhead.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01890}01890 \textcolor{comment}{ * The cache is maintained by the event thread when SceneChanged events arrive.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01891}01891 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01892}01892 \textcolor{comment}{ * **Memory Ownership**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01893}01893 \textcolor{comment}{ * If the caller provides response pointer, they receive ownership and must call}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01894}01894 \textcolor{comment}{ * obsws\_response\_free(). If response is NULL, the function frees the response internally.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01895}01895 \textcolor{comment}{ * This flexibility allows three usage patterns:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01896}01896 \textcolor{comment}{ * 1. Check response: `obsws\_set\_current\_scene(conn, name, \&resp); if (resp-\/>success) ...`}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01897}01897 \textcolor{comment}{ * 2. Ignore response: `obsws\_set\_current\_scene(conn, name, NULL);` (response is freed internally)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01898}01898 \textcolor{comment}{ * 3. Just check error: `if (obsws\_send\_request(...) != OBSWS\_OK) ...`}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01899}01899 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01900}01900 \textcolor{comment}{ * **Example usage:**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01901}01901 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01902}01902 \textcolor{comment}{ * // Pattern 1: Check response details}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01903}01903 \textcolor{comment}{ * obsws\_response\_t *response = NULL;}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01904}01904 \textcolor{comment}{ * if (obsws\_set\_current\_scene(conn, "{}Scene1"{}, \&response) == OBSWS\_OK \&\&}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01905}01905 \textcolor{comment}{ *     response \&\& response-\/>success) \{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01906}01906 \textcolor{comment}{ *     printf("{}Switched successfully\(\backslash\)\(\backslash\)n"{});}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01907}01907 \textcolor{comment}{ * \} else \{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01908}01908 \textcolor{comment}{ *     printf("{}Switch failed: \%s\(\backslash\)\(\backslash\)n"{}, response ? response-\/>error\_message : "{}unknown"{});}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01909}01909 \textcolor{comment}{ * \}}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01910}01910 \textcolor{comment}{ * obsws\_response\_free(response);}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01911}01911 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01912}01912 \textcolor{comment}{ * // Pattern 2: Ignore response (simpler)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01913}01913 \textcolor{comment}{ * obsws\_set\_current\_scene(conn, "{}Scene1"{}, NULL);}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01914}01914 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01915}01915 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01916}01916 \textcolor{comment}{ * **Thread-\/safety:**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01917}01917 \textcolor{comment}{ * -\/ Scene cache is protected by scene\_mutex}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01918}01918 \textcolor{comment}{ * -\/ Safe to call from any thread}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01919}01919 \textcolor{comment}{ * -\/ Multiple calls can happen simultaneously (each uses send\_mutex)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01920}01920 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01921}01921 \textcolor{comment}{ * @param conn Connection object (must be in CONNECTED state)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01922}01922 \textcolor{comment}{ * @param scene\_name Name of the scene to switch to. Must not be NULL.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01923}01923 \textcolor{comment}{ * @param response Optional output for response details. If provided, caller owns it}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01924}01924 \textcolor{comment}{ *                 and must free with obsws\_response\_free(). If NULL, response is}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01925}01925 \textcolor{comment}{ *                 freed internally.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01926}01926 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01927}01927 \textcolor{comment}{ * @return OBSWS\_OK if request sent and response received (check response-\/>success}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01928}01928 \textcolor{comment}{ *         for whether the scene switch actually succeeded in OBS)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01929}01929 \textcolor{comment}{ * @return OBSWS\_ERROR\_INVALID\_PARAM if conn or scene\_name is NULL}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01930}01930 \textcolor{comment}{ * @return OBSWS\_ERROR\_NOT\_CONNECTED if connection not ready}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01931}01931 \textcolor{comment}{ * @return OBSWS\_ERROR\_TIMEOUT if no response from OBS}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01932}01932 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01933}01933 \textcolor{comment}{ * @see obsws\_get\_current\_scene, obsws\_response\_t, obsws\_response\_free}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01934}01934 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01935}\mbox{\hyperlink{library_8h_a7cb91bbce42b458f267f79b9a7b293bf}{01935}} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6}{obsws\_error\_t}} \mbox{\hyperlink{library_8c_a7cb91bbce42b458f267f79b9a7b293bf}{obsws\_set\_current\_scene}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *scene\_name, \mbox{\hyperlink{structobsws__response__t}{obsws\_response\_t}} **response) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01936}01936     \textcolor{keywordflow}{if} (!conn || !scene\_name) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01937}01937         \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6a8944fe1379e71d22a82399c21107ebf6}{OBSWS\_ERROR\_INVALID\_PARAM}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01938}01938     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01939}01939     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01940}01940     \textcolor{comment}{/* Check cache to avoid redundant switches */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01941}01941     pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a4343875c5de5530580e13fb1b528cf35}{scene\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01942}01942     \textcolor{keywordtype}{bool} already\_current = (conn-\/>\mbox{\hyperlink{structobsws__connection_a887874891a0026e6ad2a2ee2c3c7390a}{current\_scene}} \&\& strcmp(conn-\/>\mbox{\hyperlink{structobsws__connection_a887874891a0026e6ad2a2ee2c3c7390a}{current\_scene}}, scene\_name) == 0);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01943}01943     pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a4343875c5de5530580e13fb1b528cf35}{scene\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01944}01944     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01945}01945     \textcolor{keywordflow}{if} (already\_current) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01946}01946         \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9aa69cfac4b3acbd5968bfab9ef5759cd2}{OBSWS\_LOG\_DEBUG}}, \textcolor{stringliteral}{"{}Already on scene: \%s"{}}, scene\_name);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01947}01947         \textcolor{keywordflow}{if} (response) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01948}01948             *response = calloc(1, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structobsws__response__t}{obsws\_response\_t}}));}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01949}01949             (*response)-\/>success = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01950}01950         \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01951}01951         \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6aa43b9a59f39db094a477cb25a638e5a1}{OBSWS\_OK}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01952}01952     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01953}01953     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01954}01954     cJSON *request\_data = cJSON\_CreateObject();}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01955}01955     cJSON\_AddStringToObject(request\_data, \textcolor{stringliteral}{"{}sceneName"{}}, scene\_name);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01956}01956     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01957}01957     \textcolor{keywordtype}{char} *data\_str = cJSON\_PrintUnformatted(request\_data);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01958}01958     cJSON\_Delete(request\_data);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01959}01959     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01960}01960     \mbox{\hyperlink{structobsws__response__t}{obsws\_response\_t}} *resp = NULL;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01961}01961     \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6}{obsws\_error\_t}} result = \mbox{\hyperlink{library_8c_af2fd7f8dd928e03b38a3e2c5b5745417}{obsws\_send\_request}}(conn, \textcolor{stringliteral}{"{}SetCurrentProgramScene"{}}, data\_str, \&resp, 0);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01962}01962     free(data\_str);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01963}01963     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01964}01964     \textcolor{keywordflow}{if} (result == \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6aa43b9a59f39db094a477cb25a638e5a1}{OBSWS\_OK}} \&\& resp \&\& resp-\/>\mbox{\hyperlink{structobsws__response__t_abbf2e99faa8fdef1c94bbd174470c821}{success}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01965}01965         pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a4343875c5de5530580e13fb1b528cf35}{scene\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01966}01966         free(conn-\/>\mbox{\hyperlink{structobsws__connection_a887874891a0026e6ad2a2ee2c3c7390a}{current\_scene}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01967}01967         conn-\/>\mbox{\hyperlink{structobsws__connection_a887874891a0026e6ad2a2ee2c3c7390a}{current\_scene}} = strdup(scene\_name);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01968}01968         pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a4343875c5de5530580e13fb1b528cf35}{scene\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01969}01969         }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01970}01970         \mbox{\hyperlink{library_8c_a1d8529feb33753ebb45d896c4c125642}{obsws\_log}}(conn, \mbox{\hyperlink{library_8h_afbee3b6b991e705309ea19fd5fb0bff9ae48017bf78390a3df8cd87a24782c421}{OBSWS\_LOG\_INFO}}, \textcolor{stringliteral}{"{}Switched to scene: \%s"{}}, scene\_name);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01971}01971     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01972}01972     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01973}01973     \textcolor{keywordflow}{if} (response) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01974}01974         *response = resp;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01975}01975     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (resp) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01976}01976         \mbox{\hyperlink{library_8c_a53067e61dc0ddcf1134d46b275d7ce6b}{obsws\_response\_free}}(resp);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01977}01977     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01978}01978     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l01979}01979     \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01980}01980 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01981}01981 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01982}01982 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01983}01983 \textcolor{comment}{ * @brief Query the currently active scene in OBS.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01984}01984 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01985}01985 \textcolor{comment}{ * This function queries OBS for the active scene name and returns it in the provided}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01986}01986 \textcolor{comment}{ * buffer. It also updates the local scene cache to keep it synchronized.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01987}01987 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01988}01988 \textcolor{comment}{ * **Cache Synchronization**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01989}01989 \textcolor{comment}{ * This function always queries the OBS server (doesn't use cached value). When the}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01990}01990 \textcolor{comment}{ * response arrives, it updates the cache. This ensures the library's cached scene}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01991}01991 \textcolor{comment}{ * name stays in sync with the actual OBS state.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01992}01992 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01993}01993 \textcolor{comment}{ * **Buffer Management**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01994}01994 \textcolor{comment}{ * The caller provides a buffer. If the scene name is longer than buffer\_size-\/1,}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01995}01995 \textcolor{comment}{ * it will be truncated and null-\/terminated. Always check the returned buffer length}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01996}01996 \textcolor{comment}{ * if you need the full name.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01997}01997 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01998}01998 \textcolor{comment}{ * **Thread-\/safety**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l01999}01999 \textcolor{comment}{ * The scene\_mutex protects the cache update, so this is safe to call from any thread.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02000}02000 \textcolor{comment}{ * Multiple concurrent calls are safe but will all query OBS (no deduplication).}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02001}02001 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02002}02002 \textcolor{comment}{ * **Example usage:**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02003}02003 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02004}02004 \textcolor{comment}{ * char scene[256];}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02005}02005 \textcolor{comment}{ * if (obsws\_get\_current\_scene(conn, scene, sizeof(scene)) == OBSWS\_OK) \{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02006}02006 \textcolor{comment}{ *     printf("{}Current scene: \%s\(\backslash\)\(\backslash\)n"{}, scene);}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02007}02007 \textcolor{comment}{ * \}}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02008}02008 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02009}02009 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02010}02010 \textcolor{comment}{ * @param conn Connection object (must be in CONNECTED state)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02011}02011 \textcolor{comment}{ * @param scene\_name Buffer to receive the scene name (must not be NULL)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02012}02012 \textcolor{comment}{ * @param buffer\_size Size of scene\_name buffer (must be > 0)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02013}02013 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02014}02014 \textcolor{comment}{ * @return OBSWS\_OK if scene name retrieved successfully}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02015}02015 \textcolor{comment}{ * @return OBSWS\_ERROR\_INVALID\_PARAM if conn, scene\_name is NULL or buffer\_size is 0}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02016}02016 \textcolor{comment}{ * @return OBSWS\_ERROR\_NOT\_CONNECTED if connection not ready}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02017}02017 \textcolor{comment}{ * @return OBSWS\_ERROR\_TIMEOUT if OBS doesn't respond}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02018}02018 \textcolor{comment}{ * @return OBSWS\_ERROR\_PARSE\_FAILED if response can't be parsed}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02019}02019 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02020}02020 \textcolor{comment}{ * @see obsws\_set\_current\_scene}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02021}02021 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02022}\mbox{\hyperlink{library_8h_a91bd5ceb5878431131513cb4624e935a}{02022}} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6}{obsws\_error\_t}} \mbox{\hyperlink{library_8c_a91bd5ceb5878431131513cb4624e935a}{obsws\_get\_current\_scene}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, \textcolor{keywordtype}{char} *scene\_name, \textcolor{keywordtype}{size\_t} buffer\_size) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02023}02023     \textcolor{keywordflow}{if} (!conn || !scene\_name || buffer\_size == 0) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02024}02024         \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6a8944fe1379e71d22a82399c21107ebf6}{OBSWS\_ERROR\_INVALID\_PARAM}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02025}02025     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02026}02026     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l02027}02027     \mbox{\hyperlink{structobsws__response__t}{obsws\_response\_t}} *response = NULL;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02028}02028     \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6}{obsws\_error\_t}} result = \mbox{\hyperlink{library_8c_af2fd7f8dd928e03b38a3e2c5b5745417}{obsws\_send\_request}}(conn, \textcolor{stringliteral}{"{}GetCurrentProgramScene"{}}, NULL, \&response, 0);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02029}02029     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l02030}02030     \textcolor{keywordflow}{if} (result == \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6aa43b9a59f39db094a477cb25a638e5a1}{OBSWS\_OK}} \&\& response \&\& response-\/>\mbox{\hyperlink{structobsws__response__t_abbf2e99faa8fdef1c94bbd174470c821}{success}} \&\& response-\/>\mbox{\hyperlink{structobsws__response__t_a696a1179e1d40c6c31136999846d5902}{response\_data}}) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02031}02031         cJSON *data = cJSON\_Parse(response-\/>\mbox{\hyperlink{structobsws__response__t_a696a1179e1d40c6c31136999846d5902}{response\_data}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02032}02032         \textcolor{keywordflow}{if} (data) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02033}02033             cJSON *name = cJSON\_GetObjectItem(data, \textcolor{stringliteral}{"{}currentProgramSceneName"{}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02034}02034             \textcolor{keywordflow}{if} (name \&\& name-\/>valuestring) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02035}02035                 strncpy(scene\_name, name-\/>valuestring, buffer\_size -\/ 1);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02036}02036                 scene\_name[buffer\_size -\/ 1] = \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02037}02037                 }
\DoxyCodeLine{\Hypertarget{library_8c_source_l02038}02038                 \textcolor{comment}{/* Update cache */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02039}02039                 pthread\_mutex\_lock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a4343875c5de5530580e13fb1b528cf35}{scene\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02040}02040                 free(conn-\/>\mbox{\hyperlink{structobsws__connection_a887874891a0026e6ad2a2ee2c3c7390a}{current\_scene}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02041}02041                 conn-\/>\mbox{\hyperlink{structobsws__connection_a887874891a0026e6ad2a2ee2c3c7390a}{current\_scene}} = strdup(name-\/>valuestring);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02042}02042                 pthread\_mutex\_unlock(\&conn-\/>\mbox{\hyperlink{structobsws__connection_a4343875c5de5530580e13fb1b528cf35}{scene\_mutex}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02043}02043             \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02044}02044             cJSON\_Delete(data);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02045}02045         \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02046}02046     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02047}02047     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l02048}02048     \textcolor{keywordflow}{if} (response) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02049}02049         \mbox{\hyperlink{library_8c_a53067e61dc0ddcf1134d46b275d7ce6b}{obsws\_response\_free}}(response);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02050}02050     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02051}02051     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l02052}02052     \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02053}02053 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02054}02054 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02055}02055 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02056}02056 \textcolor{comment}{ * @brief Start recording in OBS.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02057}02057 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02058}02058 \textcolor{comment}{ * Tells OBS to begin recording the current scene composition to disk. The recording}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02059}02059 \textcolor{comment}{ * path and format are determined by OBS settings, not by this library.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02060}02060 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02061}02061 \textcolor{comment}{ * This is a convenience wrapper around obsws\_send\_request() using the OBS}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02062}02062 \textcolor{comment}{ * "{}StartRecord"{} request type.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02063}02063 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02064}02064 \textcolor{comment}{ * **Return value interpretation:**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02065}02065 \textcolor{comment}{ * -\/ OBSWS\_OK: Request was sent and OBS responded (check response-\/>success)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02066}02066 \textcolor{comment}{ * -\/ Other errors: Network/connection problem}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02067}02067 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02068}02068 \textcolor{comment}{ * **Example usage:**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02069}02069 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02070}02070 \textcolor{comment}{ * obsws\_response\_t *resp = NULL;}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02071}02071 \textcolor{comment}{ * if (obsws\_start\_recording(conn, \&resp) == OBSWS\_OK \&\& resp \&\& resp-\/>success) \{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02072}02072 \textcolor{comment}{ *     printf("{}Recording started\(\backslash\)\(\backslash\)n"{});}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02073}02073 \textcolor{comment}{ * \}}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02074}02074 \textcolor{comment}{ * obsws\_response\_free(resp);}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02075}02075 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02076}02076 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02077}02077 \textcolor{comment}{ * @param conn Connection object (must be in CONNECTED state)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02078}02078 \textcolor{comment}{ * @param response Optional output for response. Caller owns if provided, must free.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02079}02079 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02080}02080 \textcolor{comment}{ * @return OBSWS\_OK if response received (check response-\/>success for success)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02081}02081 \textcolor{comment}{ * @return OBSWS\_ERROR\_NOT\_CONNECTED if connection not ready}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02082}02082 \textcolor{comment}{ * @return OBSWS\_ERROR\_TIMEOUT if OBS doesn't respond}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02083}02083 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02084}02084 \textcolor{comment}{ * @see obsws\_stop\_recording, obsws\_send\_request, obsws\_response\_free}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02085}02085 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02086}\mbox{\hyperlink{library_8h_a8643e2027afb1907122ce4d3bfe65c6e}{02086}} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6}{obsws\_error\_t}} \mbox{\hyperlink{library_8c_a8643e2027afb1907122ce4d3bfe65c6e}{obsws\_start\_recording}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, \mbox{\hyperlink{structobsws__response__t}{obsws\_response\_t}} **response) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02087}02087     \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8c_af2fd7f8dd928e03b38a3e2c5b5745417}{obsws\_send\_request}}(conn, \textcolor{stringliteral}{"{}StartRecord"{}}, NULL, response, 0);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02088}02088 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02089}02089 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02090}02090 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02091}02091 \textcolor{comment}{ * @brief Stop recording in OBS.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02092}02092 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02093}02093 \textcolor{comment}{ * Tells OBS to stop the currently active recording. If no recording is in progress,}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02094}02094 \textcolor{comment}{ * OBS returns success anyway (idempotent operation).}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02095}02095 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02096}02096 \textcolor{comment}{ * This is a convenience wrapper around obsws\_send\_request() using the OBS}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02097}02097 \textcolor{comment}{ * "{}StopRecord"{} request type.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02098}02098 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02099}02099 \textcolor{comment}{ * **Example usage:**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02100}02100 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02101}02101 \textcolor{comment}{ * if (obsws\_stop\_recording(conn, NULL) != OBSWS\_OK) \{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02102}02102 \textcolor{comment}{ *     fprintf(stderr, "{}Failed to stop recording\(\backslash\)\(\backslash\)n"{});}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02103}02103 \textcolor{comment}{ * \}}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02104}02104 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02105}02105 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02106}02106 \textcolor{comment}{ * @param conn Connection object (must be in CONNECTED state)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02107}02107 \textcolor{comment}{ * @param response Optional output for response. Caller owns if provided, must free.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02108}02108 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02109}02109 \textcolor{comment}{ * @return OBSWS\_OK if response received (check response-\/>success for success)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02110}02110 \textcolor{comment}{ * @return OBSWS\_ERROR\_NOT\_CONNECTED if connection not ready}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02111}02111 \textcolor{comment}{ * @return OBSWS\_ERROR\_TIMEOUT if OBS doesn't respond}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02112}02112 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02113}02113 \textcolor{comment}{ * @see obsws\_start\_recording, obsws\_send\_request, obsws\_response\_free}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02114}02114 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02115}\mbox{\hyperlink{library_8h_a30001811f4cf8501e006ca46bcb8b329}{02115}} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6}{obsws\_error\_t}} \mbox{\hyperlink{library_8c_a30001811f4cf8501e006ca46bcb8b329}{obsws\_stop\_recording}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, \mbox{\hyperlink{structobsws__response__t}{obsws\_response\_t}} **response) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02116}02116     \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8c_af2fd7f8dd928e03b38a3e2c5b5745417}{obsws\_send\_request}}(conn, \textcolor{stringliteral}{"{}StopRecord"{}}, NULL, response, 0);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02117}02117 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02118}02118 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02119}02119 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02120}02120 \textcolor{comment}{ * @brief Start streaming in OBS.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02121}02121 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02122}02122 \textcolor{comment}{ * Tells OBS to begin streaming to the configured destination (Twitch, YouTube, etc).}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02123}02123 \textcolor{comment}{ * The stream settings (URL, key, bitrate, etc) are determined by OBS settings.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02124}02124 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02125}02125 \textcolor{comment}{ * This is a convenience wrapper around obsws\_send\_request() using the OBS}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02126}02126 \textcolor{comment}{ * "{}StartStream"{} request type.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02127}02127 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02128}02128 \textcolor{comment}{ * **Thread-\/safe:** Safe to call from any thread while connected.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02129}02129 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02130}02130 \textcolor{comment}{ * @param conn Connection object (must be in CONNECTED state)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02131}02131 \textcolor{comment}{ * @param response Optional output for response. Caller owns if provided, must free.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02132}02132 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02133}02133 \textcolor{comment}{ * @return OBSWS\_OK if response received (check response-\/>success for success)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02134}02134 \textcolor{comment}{ * @return OBSWS\_ERROR\_NOT\_CONNECTED if connection not ready}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02135}02135 \textcolor{comment}{ * @return OBSWS\_ERROR\_TIMEOUT if OBS doesn't respond}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02136}02136 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02137}02137 \textcolor{comment}{ * @see obsws\_stop\_streaming, obsws\_send\_request, obsws\_response\_free}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02138}02138 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02139}\mbox{\hyperlink{library_8h_a86a35ee2d7aef7a0569b4111bd663d22}{02139}} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6}{obsws\_error\_t}} \mbox{\hyperlink{library_8c_a86a35ee2d7aef7a0569b4111bd663d22}{obsws\_start\_streaming}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, \mbox{\hyperlink{structobsws__response__t}{obsws\_response\_t}} **response) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02140}02140     \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8c_af2fd7f8dd928e03b38a3e2c5b5745417}{obsws\_send\_request}}(conn, \textcolor{stringliteral}{"{}StartStream"{}}, NULL, response, 0);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02141}02141 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02142}02142 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02143}02143 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02144}02144 \textcolor{comment}{ * @brief Stop streaming in OBS.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02145}02145 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02146}02146 \textcolor{comment}{ * Tells OBS to stop the active stream. If not currently streaming, OBS returns}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02147}02147 \textcolor{comment}{ * success anyway (idempotent operation).}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02148}02148 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02149}02149 \textcolor{comment}{ * This is a convenience wrapper around obsws\_send\_request() using the OBS}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02150}02150 \textcolor{comment}{ * "{}StopStream"{} request type.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02151}02151 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02152}02152 \textcolor{comment}{ * @param conn Connection object (must be in CONNECTED state)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02153}02153 \textcolor{comment}{ * @param response Optional output for response. Caller owns if provided, must free.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02154}02154 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02155}02155 \textcolor{comment}{ * @return OBSWS\_OK if response received (check response-\/>success for success)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02156}02156 \textcolor{comment}{ * @return OBSWS\_ERROR\_NOT\_CONNECTED if connection not ready}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02157}02157 \textcolor{comment}{ * @return OBSWS\_ERROR\_TIMEOUT if OBS doesn't respond}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02158}02158 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02159}02159 \textcolor{comment}{ * @see obsws\_start\_streaming, obsws\_send\_request, obsws\_response\_free}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02160}02160 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02161}\mbox{\hyperlink{library_8h_a2cfe9b46f435aa7986b5e772b99c464e}{02161}} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6}{obsws\_error\_t}} \mbox{\hyperlink{library_8c_a2cfe9b46f435aa7986b5e772b99c464e}{obsws\_stop\_streaming}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, \mbox{\hyperlink{structobsws__response__t}{obsws\_response\_t}} **response) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02162}02162     \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8c_af2fd7f8dd928e03b38a3e2c5b5745417}{obsws\_send\_request}}(conn, \textcolor{stringliteral}{"{}StopStream"{}}, NULL, response, 0);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02163}02163 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02164}02164 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02165}02165 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02166}02166 \textcolor{comment}{ * @brief Free a response object previously allocated by obsws\_send\_request().}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02167}02167 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02168}02168 \textcolor{comment}{ * This function safely deallocates all memory associated with a response:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02169}02169 \textcolor{comment}{ * -\/ The error\_message string (if present)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02170}02170 \textcolor{comment}{ * -\/ The response\_data JSON string (if present)  }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02171}02171 \textcolor{comment}{ * -\/ The response structure itself}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02172}02172 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02173}02173 \textcolor{comment}{ * **Safe to call with NULL**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02174}02174 \textcolor{comment}{ * Calling with NULL is safe and does nothing -\/ no crash or error.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02175}02175 \textcolor{comment}{ * This allows for simpler cleanup:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02176}02176 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02177}02177 \textcolor{comment}{ * obsws\_response\_t *resp = NULL;}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02178}02178 \textcolor{comment}{ * obsws\_send\_request(..., \&resp, ...);}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02179}02179 \textcolor{comment}{ * obsws\_response\_free(resp);  // Safe even if send\_request failed}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02180}02180 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02181}02181 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02182}02182 \textcolor{comment}{ * **Memory ownership**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02183}02183 \textcolor{comment}{ * -\/ obsws\_send\_request() allocates the response -\/ you must free it}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02184}02184 \textcolor{comment}{ * -\/ High-\/level functions like obsws\_set\_current\_scene() can optionally take}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02185}02185 \textcolor{comment}{ *   response ownership or free internally based on parameters}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02186}02186 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02187}02187 \textcolor{comment}{ * **NOT thread-\/safe**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02188}02188 \textcolor{comment}{ * Each response should only be accessed/freed by one thread. If multiple threads}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02189}02189 \textcolor{comment}{ * need the response, use higher-\/level synchronization.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02190}02190 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02191}02191 \textcolor{comment}{ * @param response Response to free. Can be NULL (does nothing if so).}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02192}02192 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02193}02193 \textcolor{comment}{ * @see obsws\_send\_request, obsws\_response\_t}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02194}02194 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02195}\mbox{\hyperlink{library_8h_a53067e61dc0ddcf1134d46b275d7ce6b}{02195}} \textcolor{keywordtype}{void} \mbox{\hyperlink{library_8c_a53067e61dc0ddcf1134d46b275d7ce6b}{obsws\_response\_free}}(\mbox{\hyperlink{structobsws__response__t}{obsws\_response\_t}} *response) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02196}02196     \textcolor{keywordflow}{if} (!response) \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02197}02197     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l02198}02198     free(response-\/>\mbox{\hyperlink{structobsws__response__t_ab2b3055a84989889d3de28c2ccfd0dac}{error\_message}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02199}02199     free(response-\/>\mbox{\hyperlink{structobsws__response__t_a696a1179e1d40c6c31136999846d5902}{response\_data}});}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02200}02200     free(response);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02201}02201 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02202}02202 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02203}02203 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02204}02204 \textcolor{comment}{ * @brief Convert an error code to a human-\/readable string.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02205}02205 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02206}02206 \textcolor{comment}{ * Utility function for error reporting and logging. Returns a brief English}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02207}02207 \textcolor{comment}{ * description of each error code.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02208}02208 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02209}02209 \textcolor{comment}{ * **Never returns NULL**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02210}02210 \textcolor{comment}{ * Unknown error codes return "{}Unknown error"{}, so it's always safe to use}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02211}02211 \textcolor{comment}{ * the returned pointer without NULL checks.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02212}02212 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02213}02213 \textcolor{comment}{ * **Example usage:**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02214}02214 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02215}02215 \textcolor{comment}{ * obsws\_error\_t err = obsws\_send\_request(...);}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02216}02216 \textcolor{comment}{ * if (err != OBSWS\_OK) \{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02217}02217 \textcolor{comment}{ *     fprintf(stderr, "{}Error: \%s\(\backslash\)\(\backslash\)n"{}, obsws\_error\_string(err));}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02218}02218 \textcolor{comment}{ * \}}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02219}02219 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02220}02220 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02221}02221 \textcolor{comment}{ * **Strings are constants**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02222}02222 \textcolor{comment}{ * Returned strings are statically allocated -\/ do not modify or free them.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02223}02223 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02224}02224 \textcolor{comment}{ * @param error The error code to describe}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02225}02225 \textcolor{comment}{ * @return Pointer to a static string describing the error}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02226}02226 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02227}02227 \textcolor{comment}{ * @see obsws\_error\_t}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02228}02228 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02229}\mbox{\hyperlink{library_8h_a39534944f30eaed9a0f2d7de19be0c3e}{02229}} \textcolor{keyword}{const} \textcolor{keywordtype}{char}* \mbox{\hyperlink{library_8c_a39534944f30eaed9a0f2d7de19be0c3e}{obsws\_error\_string}}(\mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6}{obsws\_error\_t}} error) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02230}02230     \textcolor{keywordflow}{switch} (error) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02231}02231         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6aa43b9a59f39db094a477cb25a638e5a1}{OBSWS\_OK}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Success"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02232}02232         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6a8944fe1379e71d22a82399c21107ebf6}{OBSWS\_ERROR\_INVALID\_PARAM}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Invalid parameter"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02233}02233         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6aa99054291b32e3476d521ea9efeb83a2}{OBSWS\_ERROR\_CONNECTION\_FAILED}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Connection failed"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02234}02234         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6a3132520f4e5efcd0e07668b4afcd5c4c}{OBSWS\_ERROR\_AUTH\_FAILED}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Authentication failed"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02235}02235         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6a852a5a13d07531a60aedc6e3cc1ae86d}{OBSWS\_ERROR\_TIMEOUT}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Timeout"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02236}02236         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6abab3c6691cc119a7b875d967f0fc565f}{OBSWS\_ERROR\_SEND\_FAILED}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Send failed"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02237}02237         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6a312613cd84331a653e2c1de24b94c52b}{OBSWS\_ERROR\_RECV\_FAILED}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Receive failed"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02238}02238         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6a72ca999664bea413857d7901acf2d598}{OBSWS\_ERROR\_PARSE\_FAILED}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Parse failed"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02239}02239         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6ace2eb9908cf7d65109788a2593582982}{OBSWS\_ERROR\_NOT\_CONNECTED}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Not connected"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02240}02240         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6a6b4348384a97af637d6361e38a5de052}{OBSWS\_ERROR\_ALREADY\_CONNECTED}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Already connected"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02241}02241         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6a976f03f9cfc1de7d7172732454829e15}{OBSWS\_ERROR\_OUT\_OF\_MEMORY}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Out of memory"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02242}02242         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6aea7cb95255efa1d01e6761d676ab599c}{OBSWS\_ERROR\_SSL\_FAILED}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}SSL failed"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02243}02243         \textcolor{keywordflow}{default}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Unknown error"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02244}02244     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02245}02245 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02246}02246 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02247}02247 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02248}02248 \textcolor{comment}{ * @brief Convert a connection state to a human-\/readable string.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02249}02249 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02250}02250 \textcolor{comment}{ * Utility function for logging and debugging. Returns a brief English description}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02251}02251 \textcolor{comment}{ * of each connection state.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02252}02252 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02253}02253 \textcolor{comment}{ * **State Transitions:**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02254}02254 \textcolor{comment}{ * -\/ DISCONNECTED: Initial state or after disconnect()}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02255}02255 \textcolor{comment}{ * -\/ CONNECTING: connect() called, establishing TCP connection}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02256}02256 \textcolor{comment}{ * -\/ AUTHENTICATING: TCP connected, performing challenge-\/response auth}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02257}02257 \textcolor{comment}{ * -\/ CONNECTED: Auth succeeded, ready for requests}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02258}02258 \textcolor{comment}{ * -\/ ERROR: Network error or protocol failure, should reconnect}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02259}02259 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02260}02260 \textcolor{comment}{ * **Valid transitions:**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02261}02261 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02262}02262 \textcolor{comment}{ * DISCONNECTED -\/> CONNECTING -\/> AUTHENTICATING -\/> CONNECTED}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02263}02263 \textcolor{comment}{ * CONNECTED -\/> DISCONNECTED (on explicit disconnect)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02264}02264 \textcolor{comment}{ * CONNECTED -\/> ERROR (on network failure)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02265}02265 \textcolor{comment}{ * ERROR -\/> CONNECTING (on reconnect attempt)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02266}02266 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02267}02267 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02268}02268 \textcolor{comment}{ * **Example usage:**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02269}02269 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02270}02270 \textcolor{comment}{ * obsws\_state\_t state = obsws\_get\_state(conn);}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02271}02271 \textcolor{comment}{ * printf("{}Connection state: \%s\(\backslash\)\(\backslash\)n"{}, obsws\_state\_string(state));}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02272}02272 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02273}02273 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02274}02274 \textcolor{comment}{ * Never returns NULL -\/ unknown states return "{}Unknown"{}.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02275}02275 \textcolor{comment}{ * Returned strings are static -\/ do not modify or free.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02276}02276 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02277}02277 \textcolor{comment}{ * @param state The connection state to describe}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02278}02278 \textcolor{comment}{ * @return Pointer to a static string describing the state}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02279}02279 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02280}02280 \textcolor{comment}{ * @see obsws\_get\_state, obsws\_state\_t, obsws\_is\_connected}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02281}02281 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02282}\mbox{\hyperlink{library_8h_a69f8fcc1732533a2ebe573ac65effa04}{02282}} \textcolor{keyword}{const} \textcolor{keywordtype}{char}* \mbox{\hyperlink{library_8c_a69f8fcc1732533a2ebe573ac65effa04}{obsws\_state\_string}}(\mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991}{obsws\_state\_t}} state) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02283}02283     \textcolor{keywordflow}{switch} (state) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02284}02284         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991af973d2b8b0a498d0bbffb40ccab1ef2d}{OBSWS\_STATE\_DISCONNECTED}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Disconnected"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02285}02285         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991a88276a1a9f595735a2b242f0eab1524a}{OBSWS\_STATE\_CONNECTING}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Connecting"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02286}02286         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991ac9c5d9c3aab50d7e6d1d38b1bb7d6d0f}{OBSWS\_STATE\_AUTHENTICATING}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Authenticating"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02287}02287         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991adbaae08035175b470fb9f543414672b8}{OBSWS\_STATE\_CONNECTED}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Connected"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02288}02288         \textcolor{keywordflow}{case} \mbox{\hyperlink{library_8h_a2fb4e7d7196f39a5ce0e9c71b2d78991ae13bce21841139a7510b1c8b10a694ac}{OBSWS\_STATE\_ERROR}}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Error"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02289}02289         \textcolor{keywordflow}{default}: \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}Unknown"{}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02290}02290     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02291}02291 \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02292}02292 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02293}02293 \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02294}02294 \textcolor{comment}{ * @brief Process pending WebSocket events (compatibility function).}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02295}02295 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02296}02296 \textcolor{comment}{ * This function is provided for API compatibility with single-\/threaded applications.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02297}02297 \textcolor{comment}{ * However, the libwsv5 library uses a background event\_thread by default, so this}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02298}02298 \textcolor{comment}{ * function is usually not needed -\/ events are processed automatically in the background.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02299}02299 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02300}02300 \textcolor{comment}{ * **Background Event Processing:**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02301}02301 \textcolor{comment}{ * By design, all WebSocket messages (events, responses, etc.) are processed by the}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02302}02302 \textcolor{comment}{ * background event\_thread. This thread:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02303}02303 \textcolor{comment}{ * -\/ Continuously calls lws\_service() to pump WebSocket events}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02304}02304 \textcolor{comment}{ * -\/ Receives incoming messages from OBS}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02305}02305 \textcolor{comment}{ * -\/ Routes responses to waiting callers via condition variables}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02306}02306 \textcolor{comment}{ * -\/ Calls event callbacks for real-\/time events}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02307}02307 \textcolor{comment}{ * -\/ Maintains keep-\/alive pings}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02308}02308 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02309}02309 \textcolor{comment}{ * Applications don't need to call this function -\/ the thread handles everything.}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02310}02310 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02311}02311 \textcolor{comment}{ * **What this function does:**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02312}02312 \textcolor{comment}{ * Currently, this is mainly for API compatibility. It:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02313}02313 \textcolor{comment}{ * -\/ Validates the connection object}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02314}02314 \textcolor{comment}{ * -\/ If timeout\_ms > 0, sleeps for that duration}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02315}02315 \textcolor{comment}{ * -\/ Returns 0 (success)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02316}02316 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02317}02317 \textcolor{comment}{ * **When to use:**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02318}02318 \textcolor{comment}{ * -\/ Most applications: Don't call this -\/ use background thread}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02319}02319 \textcolor{comment}{ * -\/ If you disable background thread: Call this in your main loop}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02320}02320 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02321}02321 \textcolor{comment}{ * **Example (not typical -\/ background thread is recommended):**}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02322}02322 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02323}02323 \textcolor{comment}{ * // Not recommended -\/ background thread is better}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02324}02324 \textcolor{comment}{ * while (app\_running) \{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02325}02325 \textcolor{comment}{ *     obsws\_process\_events(conn, 100);  // Check every 100ms}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02326}02326 \textcolor{comment}{ * \}}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02327}02327 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02328}02328 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02329}02329 \textcolor{comment}{ * Better approach -\/ let background thread handle it:}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02330}02330 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02331}02331 \textcolor{comment}{ * obsws\_connect(conn, "{}localhost"{}, 4455, "{}password"{});}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02332}02332 \textcolor{comment}{ * // Background thread processes events automatically}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02333}02333 \textcolor{comment}{ * while (app\_running) \{}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02334}02334 \textcolor{comment}{ *     // Your application code -\/ no need to call process\_events}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02335}02335 \textcolor{comment}{ * \}}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02336}02336 \textcolor{comment}{ * obsws\_disconnect(conn);}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02337}02337 \textcolor{comment}{ * ```}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02338}02338 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02339}02339 \textcolor{comment}{ * @param conn Connection object (can be NULL -\/ returns error)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02340}02340 \textcolor{comment}{ * @param timeout\_ms Sleep duration in milliseconds (0 = don't sleep)}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02341}02341 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02342}02342 \textcolor{comment}{ * @return 0 on success}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02343}02343 \textcolor{comment}{ * @return OBSWS\_ERROR\_INVALID\_PARAM if conn is NULL}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02344}02344 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02345}02345 \textcolor{comment}{ * @see obsws\_connect, obsws\_disconnect, event\_thread\_func}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02346}02346 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02347}\mbox{\hyperlink{library_8h_abe53062a781ca1cd537f799c075b3e2e}{02347}} \textcolor{keywordtype}{int} \mbox{\hyperlink{library_8c_abe53062a781ca1cd537f799c075b3e2e}{obsws\_process\_events}}(\mbox{\hyperlink{structobsws__connection}{obsws\_connection\_t}} *conn, uint32\_t timeout\_ms) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02348}02348     \textcolor{keywordflow}{if} (!conn) \textcolor{keywordflow}{return} \mbox{\hyperlink{library_8h_a4820ea98988736a81d6695a51f74acd6a8944fe1379e71d22a82399c21107ebf6}{OBSWS\_ERROR\_INVALID\_PARAM}};}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02349}02349     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l02350}02350     \textcolor{comment}{/* Events are processed in the background thread */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02351}02351     \textcolor{comment}{/* This function is provided for API compatibility */}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02352}02352     \textcolor{keywordflow}{if} (timeout\_ms > 0) \{}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02353}02353         \textcolor{keyword}{struct }timespec ts;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02354}02354         ts.tv\_sec = timeout\_ms / 1000;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02355}02355         ts.tv\_nsec = (timeout\_ms \% 1000) * 1000000;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02356}02356         nanosleep(\&ts, NULL);}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02357}02357     \}}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02358}02358     }
\DoxyCodeLine{\Hypertarget{library_8c_source_l02359}02359     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{library_8c_source_l02360}02360 \}}

\end{DoxyCode}
